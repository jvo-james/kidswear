<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Valentine's Packages</title>

  <!-- Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p8fXwXg6X0wq2b1vKxQk3y2p9CwqQxZl3s2s8xYQ7Kqg0q2QY2KxqQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Paystack & jsPDF (for receipt generation) -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Google Fonts: Raleway & Open Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&family=Open+Sans&display=swap" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Animate.css for animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
 
<style>
/* =========================
   April Blossoms — Premium Mobile-First Styles
   (Built to make every feature look great on phones)
   ========================= */

/* --- Design Tokens --- */
:root{
  --bg: #fffdfb;
  --muted-bg: #fff7fb;
  --surface: rgba(255,255,255,.82);
  --card: #ffffff;
  --text: #15151b;
  --muted: rgba(21,21,27,.66);
  --muted-2: rgba(21,21,27,.52);
  --line: rgba(21,21,27,.08);

  --accent: #ff3b7a;     /* blossom pink */
  --accent-2: #ff8bb3;   /* soft rose */
  --accent-3: #7c5cff;   /* lavender pop */
  --success: #0bb27a;
  --danger: #ff2d55;
  --warning: #ffb020;

  --shadow-sm: 0 8px 24px rgba(18,18,30,.08);
  --shadow-md: 0 16px 46px rgba(18,18,30,.12);
  --shadow-lg: 0 28px 88px rgba(18,18,30,.18);

  --radius-xl: 22px;
  --radius-lg: 18px;
  --radius-md: 14px;
  --radius-sm: 10px;

  --container: 1120px;
  --pad: 16px;

  --blur: 14px;

  --tap: 44px; /* minimum tap target */

  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

/* Dark theme hook (toggle sets data-theme="dark") */
html[data-theme="dark"]{
  --bg: #0b0b11;
  --muted-bg: #0f0f16;
  --surface: rgba(20,20,28,.72);
  --card: rgba(20,20,28,.92);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.66);
  --muted-2: rgba(255,255,255,.55);
  --line: rgba(255,255,255,.12);

  --shadow-sm: 0 10px 24px rgba(0,0,0,.28);
  --shadow-md: 0 20px 54px rgba(0,0,0,.38);
  --shadow-lg: 0 34px 110px rgba(0,0,0,.50);
}

/* --- Reset --- */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--text);
  background:
    radial-gradient(900px 600px at 20% 10%, rgba(255,59,122,.10), transparent 60%),
    radial-gradient(900px 600px at 80% 0%, rgba(124,92,255,.10), transparent 65%),
    linear-gradient(180deg, var(--muted-bg), var(--bg));
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
}
img{max-width:100%;display:block}
a{color:inherit}
button, input, select, textarea{font:inherit}
::selection{background: rgba(255,59,122,.22)}
.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

/* Body lock when modal/drawer open */
body.modal-open{
  overflow:hidden;
  touch-action: none;
}

/* --- App Container Helpers --- */
.container{
  width:min(100%, var(--container));
  margin-inline:auto;
  padding-inline: calc(var(--pad) + var(--safe-left));
  padding-inline-end: calc(var(--pad) + var(--safe-right));
}
.section{
  padding: 18px 0;
}

/* =========================
   Top progress bar
   ========================= */
#topProgress{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:3px;
  transform-origin: left;
  transform: scaleX(0);
  background: linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
  z-index: 100000;
}

/* =========================
   Header (Mobile-first sticky)
   ========================= */
.site-header{
  position: sticky;
  top: 0;
  z-index: 9000;
  padding-top: calc(10px + var(--safe-top));
  padding-bottom: 10px;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.55));
  border-bottom: 1px solid var(--line);
}
html[data-theme="dark"] .site-header{
  background: linear-gradient(180deg, rgba(20,20,28,.75), rgba(20,20,28,.55));
}

.header-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
}

.brand{
  display:flex;
  align-items:center;
  gap: 10px;
  min-width: 0;
}
.brand .logo-wrap{
  width: 44px; height: 44px;
  border-radius: 14px;
  overflow:hidden;
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(255,255,255,.55);
  flex-shrink:0;
}
.brand .logo-wrap img{
  width:100%; height:100%; object-fit:cover;
}
.brand .brand-text{
  min-width:0;
}
.brand .brand-name{
  margin:0;
  font-weight: 900;
  letter-spacing: .2px;
  font-size: 15px;
  line-height: 1.05;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}
.brand .brand-tag{
  margin: 3px 0 0;
  font-size: 12px;
  color: var(--muted);
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}

/* Header actions */
.header-actions{
  display:flex;
  align-items:center;
  gap: 8px;
  flex-shrink:0;
}
.icon-btn{
  height: var(--tap);
  width: var(--tap);
  border-radius: 14px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.70);
  box-shadow: 0 10px 26px rgba(18,18,30,.06);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  position:relative;
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
  -webkit-tap-highlight-color: transparent;
}
html[data-theme="dark"] .icon-btn{
  background: rgba(20,20,28,.75);
  box-shadow: 0 12px 26px rgba(0,0,0,.32);
}
.icon-btn:hover{transform: translateY(-1px)}
.icon-btn:active{transform: translateY(0px) scale(.98)}
.icon-btn:focus-visible{
  outline: 3px solid rgba(255,59,122,.24);
  outline-offset: 2px;
}

.badge{
  position:absolute;
  top: -7px;
  right: -7px;
  min-width: 20px;
  height: 20px;
  padding: 0 6px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 11px;
  font-weight: 900;
  color: #fff;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  box-shadow: 0 10px 24px rgba(255,59,122,.18);
  border: 2px solid rgba(255,255,255,.85);
}
html[data-theme="dark"] .badge{border-color: rgba(20,20,28,.92)}

/* Quick search line under header (optional) */
.header-search{
  margin-top: 10px;
  display:grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items:center;
}
.search{
  position:relative;
  display:flex;
  align-items:center;
  gap: 8px;
  border: 1px solid var(--line);
  border-radius: 16px;
  background: rgba(255,255,255,.72);
  padding: 10px 12px;
  box-shadow: 0 14px 40px rgba(18,18,30,.08);
}
html[data-theme="dark"] .search{background: rgba(20,20,28,.75)}
.search i{color: var(--muted); font-size: 14px}
.search input{
  border:0;
  background: transparent;
  outline:none;
  width:100%;
  color: var(--text);
  font-size: 14px;
}
.search .clear{
  height: 30px;
  width: 30px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.6);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
html[data-theme="dark"] .search .clear{background: rgba(20,20,28,.7)}
.search .clear:active{transform: scale(.98)}

/* =========================
   Hero slider
   ========================= */
.hero{
  padding: 12px 0 18px;
}
.hero-card{
  position:relative;
  border-radius: var(--radius-xl);
  overflow:hidden;
  border: 1px solid var(--line);
  box-shadow: var(--shadow-lg);
  background: #000;
}

#heroSlider{
  position:relative;
  height: 58vh;
  min-height: 420px;
  max-height: 620px;
}

.hero-slide{
  position:absolute;
  inset:0;
  opacity:0;
  transform: scale(1.02);
  transition: opacity .6s ease, transform .9s cubic-bezier(.2,.9,.2,1);
}
.hero-slide.is-active{
  opacity:1;
  transform: scale(1);
}
.hero-slide img{
  width:100%;
  height:100%;
  object-fit: cover;
  filter: saturate(1.06) contrast(1.05);
}

/* gradient overlay */
.hero-overlay{
  position:absolute;
  inset:0;
  background:
    linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.20) 35%, rgba(0,0,0,.68));
  pointer-events:none;
}

.hero-content{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  padding: 16px;
  padding-bottom: calc(16px + var(--safe-bottom));
  color:#fff;
}
.hero-kicker{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  width: fit-content;
  padding: 7px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 900;
  letter-spacing: .2px;
  background: rgba(255,255,255,.16);
  border: 1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
}
.hero-title{
  margin: 12px 0 6px;
  font-size: clamp(22px, 5.7vw, 34px);
  line-height: 1.06;
  font-weight: 950;
  letter-spacing: -.3px;
}
.hero-sub{
  margin: 0;
  max-width: 58ch;
  color: rgba(255,255,255,.86);
  font-size: 14px;
  line-height: 1.45;
}
.hero-cta{
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
  margin-top: 14px;
}

/* Hero metrics (optional section in hero) */
.hero-metrics{
  display:flex;
  gap: 10px;
  margin-top: 14px;
  flex-wrap: wrap;
}
.metric{
  flex: 1 1 120px;
  background: rgba(255,255,255,.14);
  border: 1px solid rgba(255,255,255,.22);
  border-radius: 16px;
  padding: 10px 12px;
  backdrop-filter: blur(10px);
}
.metric .num{
  font-weight: 950;
  font-size: 16px;
}
.metric .lbl{
  margin-top: 2px;
  color: rgba(255,255,255,.82);
  font-size: 12px;
}

/* Slider controls */
.hero-controls{
  position:absolute;
  top: 12px;
  right: 12px;
  display:flex;
  gap: 8px;
}
.hero-controls .icon-btn{
  background: rgba(255,255,255,.18);
  border-color: rgba(255,255,255,.25);
  color: #fff;
  box-shadow: 0 16px 42px rgba(0,0,0,.22);
}

.dots{
  position:absolute;
  left: 0;
  right: 0;
  bottom: 12px;
  display:flex;
  gap: 8px;
  justify-content:center;
  align-items:center;
}
.dot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(255,255,255,.35);
  border: 1px solid rgba(255,255,255,.35);
  cursor:pointer;
  transition: transform .15s ease, width .2s ease, background .2s ease;
}
.dot.is-active{
  width: 22px;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  border-color: rgba(255,255,255,.45);
}

/* =========================
   Buttons / chips
   ========================= */
.btn{
  min-height: var(--tap);
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid var(--line);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  font-weight: 900;
  font-size: 14px;
  text-decoration:none;
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease, opacity .15s ease;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{transform: scale(.99)}
.btn:focus-visible{
  outline: 3px solid rgba(255,59,122,.24);
  outline-offset: 2px;
}

.btn.primary{
  color: #fff;
  border-color: transparent;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  box-shadow: 0 16px 50px rgba(255,59,122,.18);
}
.btn.primary:hover{
  box-shadow: 0 18px 60px rgba(255,59,122,.22);
}
.btn.ghost{
  background: rgba(255,255,255,.74);
}
html[data-theme="dark"] .btn.ghost{
  background: rgba(20,20,28,.75);
}
.btn.ghost:hover{box-shadow: 0 16px 36px rgba(18,18,30,.10)}
.btn.ghost.danger{
  color: var(--danger);
  border-color: rgba(255,45,85,.22);
}
.btn[disabled]{
  opacity: .56;
  cursor:not-allowed;
}

/* Chips row */
.filters{
  display:flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 14px;
}
.chip{
  height: 38px;
  padding: 0 12px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.70);
  display:inline-flex;
  align-items:center;
  gap: 8px;
  font-weight: 900;
  font-size: 13px;
  cursor:pointer;
  transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
}
html[data-theme="dark"] .chip{background: rgba(20,20,28,.75)}
.chip.active{
  background: linear-gradient(90deg, rgba(255,59,122,.16), rgba(255,139,179,.18));
  border-color: rgba(255,59,122,.20);
  box-shadow: 0 14px 36px rgba(255,59,122,.10);
}
.chip:active{transform: scale(.99)}

/* =========================
   Shop controls row
   ========================= */
.shop-head{
  margin-top: 14px;
  display:grid;
  gap: 10px;
}
.shop-title{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap: 12px;
}
.shop-title h2{
  margin: 0;
  font-size: 18px;
  font-weight: 950;
  letter-spacing: -.2px;
}
.shop-title p{
  margin: 2px 0 0;
  color: var(--muted);
  font-size: 13px;
}

.shop-controls{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.select{
  display:flex;
  align-items:center;
  gap: 10px;
  border: 1px solid var(--line);
  border-radius: 16px;
  background: rgba(255,255,255,.72);
  padding: 10px 12px;
  box-shadow: 0 14px 40px rgba(18,18,30,.08);
}
html[data-theme="dark"] .select{background: rgba(20,20,28,.75)}
.select i{color: var(--muted); font-size: 14px}
.select select{
  border:0;
  background: transparent;
  outline:none;
  width:100%;
  color: var(--text);
}

/* =========================
   Product Grid + Cards
   ========================= */
#productGrid{
  margin-top: 14px;
  display:grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

.product-card{
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius-xl);
  overflow:hidden;
  box-shadow: var(--shadow-sm);
  transform: translateZ(0);
  transition: transform .22s ease, box-shadow .22s ease;
}
.product-card:hover{
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}
.pc-media{
  position:relative;
  aspect-ratio: 4 / 3;
  background: rgba(0,0,0,.04);
}
.pc-media img{
  width:100%;
  height:100%;
  object-fit: cover;
  transition: transform .45s cubic-bezier(.2,.9,.2,1);
}
.product-card:hover .pc-media img{transform: scale(1.03)}
.pc-badge{
  position:absolute;
  top: 12px;
  left: 12px;
  padding: 7px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 950;
  color: #fff;
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
}
.pc-badge.sold{
  background: linear-gradient(90deg, rgba(255,45,85,.88), rgba(255,59,122,.88));
}
.pc-wish{
  position:absolute;
  top: 10px;
  right: 10px;
  height: 40px;
  width: 40px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(0,0,0,.30);
  color: #fff;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  backdrop-filter: blur(10px);
  transition: transform .15s ease, background .15s ease;
}
.pc-wish:active{transform: scale(.98)}
.pc-wish:hover{background: rgba(0,0,0,.36)}

.pc-body{
  padding: 12px 12px 14px;
}
.pc-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
}
.pc-title{
  font-weight: 950;
  font-size: 16px;
  letter-spacing: -.2px;
  line-height: 1.15;
}
.pc-price{
  flex-shrink:0;
  font-weight: 950;
  font-size: 14px;
  padding: 7px 10px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,59,122,.12), rgba(255,139,179,.14));
  border: 1px solid rgba(255,59,122,.16);
}
.pc-desc{
  margin-top: 8px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.45;
}
.pc-meta{
  margin-top: 10px;
  display:flex;
  flex-wrap:wrap;
  gap: 8px;
}
.pc-chip{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 900;
  color: var(--muted);
  background: rgba(21,21,27,.03);
  border: 1px solid var(--line);
}
html[data-theme="dark"] .pc-chip{background: rgba(255,255,255,.06)}

.pc-actions{
  margin-top: 12px;
  display:grid;
  grid-template-columns: 1fr 1.1fr;
  gap: 10px;
}
.pc-note{
  margin-top: 10px;
  font-size: 12px;
  color: var(--muted-2);
}

/* Empty state blocks */
.empty-state,
.empty-cart,
.empty-history{
  background: rgba(255,255,255,.74);
  border: 1px solid var(--line);
  border-radius: var(--radius-xl);
  padding: 16px;
  text-align:center;
  box-shadow: var(--shadow-sm);
}
html[data-theme="dark"] .empty-state,
html[data-theme="dark"] .empty-cart,
html[data-theme="dark"] .empty-history{
  background: rgba(20,20,28,.80);
}
.empty-title{font-weight: 950; font-size: 16px}
.empty-sub{margin-top: 6px; color: var(--muted); font-size: 13px}

/* Show more controls */
.show-more-row{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  justify-content:center;
  flex-wrap:wrap;
}

/* =========================
   Overlay + Drawers (Cart/History)
   ========================= */
#overlay{
  position:fixed;
  inset:0;
  background: rgba(10,10,16,.55);
  backdrop-filter: blur(10px);
  z-index: 9500;
  display:none;
}

.drawer{
  position:fixed;
  top:0;
  right:0;
  height: 100vh;
  width: min(100vw, 420px);
  background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.84));
  border-left: 1px solid var(--line);
  box-shadow: var(--shadow-lg);
  z-index: 9600;
  transform: translateX(105%);
  transition: transform .34s cubic-bezier(.2,.9,.2,1);
  display:flex;
  flex-direction:column;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
}
html[data-theme="dark"] .drawer{
  background: linear-gradient(180deg, rgba(20,20,28,.95), rgba(20,20,28,.88));
}
.drawer.open{transform: translateX(0)}
.drawer-head{
  padding: 14px 14px 10px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  border-bottom: 1px solid var(--line);
}
.drawer-head .title{
  display:flex;
  flex-direction:column;
  gap: 3px;
}
.drawer-head h3{
  margin:0;
  font-size: 16px;
  font-weight: 950;
}
.drawer-head .sub{
  margin:0;
  font-size: 12px;
  color: var(--muted);
}
.drawer-body{
  padding: 12px 14px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
.drawer-foot{
  border-top: 1px solid var(--line);
  padding: 12px 14px;
  background: rgba(255,255,255,.60);
}
html[data-theme="dark"] .drawer-foot{background: rgba(20,20,28,.75)}

/* Cart items */
.cart-item{
  display:flex;
  gap: 10px;
  padding: 10px;
  border-radius: var(--radius-lg);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.74);
  box-shadow: 0 10px 26px rgba(18,18,30,.06);
  margin-bottom: 10px;
}
html[data-theme="dark"] .cart-item{background: rgba(255,255,255,.06)}
.ci-img{
  width: 74px;
  height: 74px;
  border-radius: 16px;
  overflow:hidden;
  flex-shrink:0;
  background: rgba(0,0,0,.04);
}
.ci-img img{width:100%;height:100%;object-fit:cover}
.ci-main{flex:1;min-width:0}
.ci-row{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
}
.ci-title{
  font-weight: 950;
  font-size: 14px;
  line-height: 1.15;
  min-width:0;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.ci-price{
  font-weight: 950;
  font-size: 13px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,59,122,.10);
  border: 1px solid rgba(255,59,122,.12);
  flex-shrink:0;
}
.ci-sub{
  margin-top: 5px;
  color: var(--muted);
  font-size: 12px;
}
.ci-actions{
  margin-top: 8px;
  display:flex;
  gap: 8px;
  flex-wrap:wrap;
}
.ci-actions .btn{
  height: 36px;
  min-height: 36px;
  padding: 0 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 950;
}

/* Totals mini block */
.totals{
  background: rgba(255,255,255,.74);
  border: 1px solid var(--line);
  border-radius: var(--radius-xl);
  padding: 12px;
  box-shadow: var(--shadow-sm);
}
html[data-theme="dark"] .totals{background: rgba(255,255,255,.06)}
.totals .row{
  display:flex;
  justify-content:space-between;
  padding: 6px 0;
  font-size: 13px;
  color: var(--muted);
}
.totals .row strong{color: var(--text)}
.totals .row.total{
  border-top: 1px dashed var(--line);
  margin-top: 6px;
  padding-top: 10px;
  font-size: 14px;
  font-weight: 950;
  color: var(--text);
}

/* Drawer footer actions */
.drawer-actions{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 10px;
}
.drawer-actions .btn{width:100%}

/* =========================
   Checkout Modal
   ========================= */
#checkoutModal{
  position:fixed;
  inset:0;
  z-index: 9800;
  display:none;
  align-items:flex-end; /* mobile bottom sheet */
  justify-content:center;
  padding: 0;
  background: rgba(10,10,16,.55);
  backdrop-filter: blur(10px);
}
.checkout-sheet{
  width: 100%;
  max-width: 520px;
  max-height: 92vh;
  border-top-left-radius: 22px;
  border-top-right-radius: 22px;
  border: 1px solid var(--line);
  border-bottom: 0;
  background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
  box-shadow: var(--shadow-lg);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  padding-bottom: var(--safe-bottom);
}
html[data-theme="dark"] .checkout-sheet{
  background: linear-gradient(180deg, rgba(20,20,28,.96), rgba(20,20,28,.88));
}

.checkout-head{
  padding: 12px 14px 10px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: 10px;
  border-bottom: 1px solid var(--line);
}
.checkout-head h3{
  margin:0;
  font-size: 16px;
  font-weight: 950;
}
.checkout-head .sub{
  margin-top: 4px;
  font-size: 12px;
  color: var(--muted);
}
.sheet-grab{
  display:flex;
  justify-content:center;
  padding: 8px 0 2px;
}
.sheet-grab::before{
  content:"";
  width: 48px;
  height: 5px;
  border-radius: 999px;
  background: rgba(21,21,27,.18);
}
html[data-theme="dark"] .sheet-grab::before{background: rgba(255,255,255,.20)}

.checkout-body{
  padding: 10px 14px 14px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
.form-grid{
  display:grid;
  gap: 10px;
}
.field{
  display:flex;
  flex-direction:column;
  gap: 7px;
}
label{
  font-size: 12px;
  color: var(--muted);
  font-weight: 800;
}
.input{
  height: var(--tap);
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  padding: 0 12px;
  outline:none;
  box-shadow: 0 14px 40px rgba(18,18,30,.06);
  color: var(--text);
}
html[data-theme="dark"] .input{background: rgba(255,255,255,.06)}
.textarea{
  min-height: 92px;
  padding: 10px 12px;
  resize: vertical;
}
.input:focus, .textarea:focus{
  border-color: rgba(255,59,122,.30);
  box-shadow: 0 0 0 4px rgba(255,59,122,.14), 0 18px 60px rgba(18,18,30,.10);
}

.hint{
  font-size: 12px;
  color: var(--muted);
  line-height: 1.35;
}

.radio-row{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
}
.radio-pill{
  flex: 1 1 140px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.70);
  cursor:pointer;
  box-shadow: 0 14px 40px rgba(18,18,30,.06);
}
html[data-theme="dark"] .radio-pill{background: rgba(255,255,255,.06)}
.radio-pill input{accent-color: var(--accent)}
.radio-pill strong{font-size: 13px}

.checkout-summary{
  margin-top: 12px;
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.74);
  box-shadow: var(--shadow-sm);
  overflow:hidden;
}
html[data-theme="dark"] .checkout-summary{background: rgba(255,255,255,.06)}
.checkout-summary .head{
  padding: 10px 12px;
  border-bottom: 1px solid var(--line);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.checkout-summary .head strong{font-size: 13px}
#checkoutItems .sum-item{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(21,21,27,.06);
}
#checkoutItems .sum-item:last-child{border-bottom:0}
.sum-title{font-weight: 950; font-size: 13px}
.sum-sub{color: var(--muted); font-size: 12px; margin-top: 2px}

.checkout-summary .tot{
  padding: 10px 12px;
  border-top: 1px dashed var(--line);
}
.checkout-summary .tot .line{
  display:flex;
  justify-content:space-between;
  padding: 6px 0;
  font-size: 13px;
  color: var(--muted);
}
.checkout-summary .tot .line strong{color: var(--text)}
.checkout-summary .tot .line.total{
  color: var(--text);
  font-weight: 950;
  font-size: 14px;
  padding-top: 10px;
}

.checkout-foot{
  border-top: 1px solid var(--line);
  padding: 12px 14px;
  background: rgba(255,255,255,.60);
}
html[data-theme="dark"] .checkout-foot{background: rgba(20,20,28,.78)}
.checkout-foot .actions{
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap: 10px;
}
.checkout-foot .btn{width:100%}

/* =========================
   ModalRoot generic modals (Quick view + Success + History details)
   ========================= */
#abModalRoot, #modalRoot{ /* support either id */
  display:none;
}

/* Backdrop */
.ab-modal-backdrop{
  position:fixed;
  inset:0;
  z-index: 9900;
  background: rgba(10,10,16,.60);
  backdrop-filter: blur(12px);
  display:flex;
  align-items:flex-end; /* mobile: bottom sheet */
  justify-content:center;
  padding: 0;
}

/* Modal */
.ab-modal{
  width: 100%;
  max-width: 560px;
  max-height: 92vh;
  border-top-left-radius: 22px;
  border-top-right-radius: 22px;
  background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
  border: 1px solid var(--line);
  border-bottom: 0;
  box-shadow: var(--shadow-lg);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  padding-bottom: var(--safe-bottom);
}
html[data-theme="dark"] .ab-modal{
  background: linear-gradient(180deg, rgba(20,20,28,.96), rgba(20,20,28,.88));
}

.ab-modal-head{
  padding: 12px 14px 10px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: 10px;
  border-bottom: 1px solid var(--line);
}
.ab-modal-title{
  display:flex;
  flex-direction:column;
  gap: 3px;
}
.ab-modal-h{
  font-size: 16px;
  font-weight: 950;
  letter-spacing: -.2px;
}
.ab-modal-sub{
  font-size: 12px;
  color: var(--muted);
}
.ab-modal-body{
  padding: 12px 14px 14px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}
.ab-modal-foot{
  padding: 12px 14px;
  border-top: 1px solid var(--line);
  background: rgba(255,255,255,.60);
  display:flex;
  flex-wrap:wrap;
  gap: 10px;
}
html[data-theme="dark"] .ab-modal-foot{background: rgba(20,20,28,.78)}
.ab-modal-foot .btn{
  flex: 1 1 160px;
}

/* Quick view layout */
.qv-media{
  border-radius: var(--radius-xl);
  overflow:hidden;
  border: 1px solid var(--line);
  background: rgba(0,0,0,.04);
  box-shadow: var(--shadow-sm);
}
.qv-media img{
  width:100%;
  aspect-ratio: 4 / 3;
  object-fit: cover;
}
.qv-thumbs{
  display:flex;
  gap: 8px;
  padding: 10px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  background: rgba(255,255,255,.60);
  border-top: 1px solid var(--line);
}
html[data-theme="dark"] .qv-thumbs{background: rgba(255,255,255,.06)}
.qv-thumb{
  border: 1px solid var(--line);
  background: rgba(255,255,255,.70);
  border-radius: 14px;
  padding: 0;
  width: 64px;
  height: 48px;
  overflow:hidden;
  cursor:pointer;
  flex-shrink:0;
}
html[data-theme="dark"] .qv-thumb{background: rgba(255,255,255,.06)}
.qv-thumb img{width:100%;height:100%;object-fit:cover}

.qv-info{
  margin-top: 12px;
  display:grid;
  gap: 10px;
}
.qv-price{
  font-weight: 950;
  font-size: 16px;
  width: fit-content;
  padding: 8px 12px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,59,122,.14), rgba(255,139,179,.16));
  border: 1px solid rgba(255,59,122,.18);
}
.qv-desc{
  color: var(--muted);
  font-size: 13px;
  line-height: 1.5;
}
.qv-bullets{
  display:grid;
  gap: 8px;
  padding: 10px 12px;
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  box-shadow: var(--shadow-sm);
}
html[data-theme="dark"] .qv-bullets{background: rgba(255,255,255,.06)}
.qv-bullet{
  display:flex;
  align-items:center;
  gap: 10px;
  font-size: 12px;
  color: var(--muted);
}
.qv-bullet i{color: var(--success)}
.qv-actions{
  display:grid;
  grid-template-columns: 1fr 1.2fr;
  gap: 10px;
}
.qv-mini{
  font-size: 12px;
  color: var(--muted);
}

/* Success modal special */
.ab-modal.ab-success .ab-modal-h{
  background: linear-gradient(90deg, var(--accent), var(--accent-3));
  -webkit-background-clip: text;
  background-clip:text;
  color: transparent;
}
.succ-grid{
  display:grid;
  gap: 10px;
}
.succ-col{
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  border-radius: var(--radius-xl);
  padding: 12px;
  box-shadow: var(--shadow-sm);
}
html[data-theme="dark"] .succ-col{background: rgba(255,255,255,.06)}
.succ-title{font-weight: 950; font-size: 13px; margin-bottom: 8px}
.succ-row{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid rgba(21,21,27,.06);
  color: var(--muted);
  font-size: 12px;
}
.succ-row:last-child{border-bottom:0}
.succ-row strong{color: var(--text); font-weight: 950}

.succ-items{
  margin-top: 10px;
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  box-shadow: var(--shadow-sm);
  overflow:hidden;
}
html[data-theme="dark"] .succ-items{background: rgba(255,255,255,.06)}
.succ-item{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(21,21,27,.06);
}
.succ-item:last-child{border-bottom:0}
.succ-item-title{font-weight: 950; font-size: 13px}
.succ-item-sub{color: var(--muted); font-size: 12px; margin-top: 2px}

.succ-totals{
  margin-top: 10px;
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  box-shadow: var(--shadow-sm);
  padding: 10px 12px;
}
html[data-theme="dark"] .succ-totals{background: rgba(255,255,255,.06)}
.succ-totals .line{
  display:flex;
  justify-content:space-between;
  padding: 6px 0;
  color: var(--muted);
  font-size: 13px;
}
.succ-totals .line strong{color: var(--text)}
.succ-totals .line.total{
  border-top: 1px dashed var(--line);
  padding-top: 10px;
  margin-top: 6px;
  font-weight: 950;
  color: var(--text);
}

/* Receipt pre in history details */
.receipt-pre{
  margin:0;
  white-space: pre-wrap;
  word-wrap: break-word;
  padding: 12px;
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(21,21,27,.03);
  color: var(--text);
  line-height: 1.45;
  font-size: 12px;
}
html[data-theme="dark"] .receipt-pre{background: rgba(255,255,255,.06)}

/* =========================
   History cards
   ========================= */
.history-card{
  border: 1px solid var(--line);
  border-radius: var(--radius-xl);
  background: rgba(255,255,255,.74);
  box-shadow: 0 12px 34px rgba(18,18,30,.08);
  overflow:hidden;
  margin-bottom: 12px;
}
html[data-theme="dark"] .history-card{background: rgba(255,255,255,.06)}
.hc-top{
  padding: 12px;
  border-bottom: 1px solid rgba(21,21,27,.06);
}
.hc-title{
  font-weight: 950;
  font-size: 14px;
}
.hc-meta{
  margin-top: 4px;
  color: var(--muted);
  font-size: 12px;
}
.hc-items{
  padding: 10px 12px;
  display:grid;
  gap: 8px;
}
.hc-item{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  font-size: 12px;
  color: var(--muted);
}
.hc-item strong{color: var(--text)}
.hc-more{
  font-size: 12px;
  color: var(--muted);
}
.hc-bottom{
  padding: 10px 12px 12px;
  border-top: 1px dashed rgba(21,21,27,.10);
}
.hc-total{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  color: var(--muted);
  font-size: 12px;
}
.hc-total strong{color: var(--text); font-size: 14px}
.hc-actions{
  margin-top: 10px;
  display:flex;
  gap: 10px;
  flex-wrap:wrap;
}
.hc-actions .btn{
  height: 38px;
  min-height: 38px;
  font-size: 12px;
  padding: 0 12px;
  border-radius: 14px;
}

/* =========================
   Contact section
   ========================= */
.contact{
  margin-top: 14px;
}
.contact-card{
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.74);
  box-shadow: var(--shadow-sm);
  overflow:hidden;
}
html[data-theme="dark"] .contact-card{background: rgba(255,255,255,.06)}
.contact-card .head{
  padding: 12px;
  border-bottom: 1px solid rgba(21,21,27,.06);
}
.contact-card .head h3{
  margin:0;
  font-size: 16px;
  font-weight: 950;
}
.contact-card .head p{
  margin: 6px 0 0;
  font-size: 13px;
  color: var(--muted);
}
.contact-list{
  list-style:none;
  padding: 12px;
  margin:0;
  display:grid;
  gap: 10px;
}
.contact-list a{
  text-decoration:none;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 12px;
  border-radius: 18px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.70);
  box-shadow: 0 12px 30px rgba(18,18,30,.06);
}
html[data-theme="dark"] .contact-list a{background: rgba(255,255,255,.06)}
.contact-left{
  display:flex;
  align-items:center;
  gap: 12px;
  min-width:0;
}
.contact-ico{
  width: 44px;
  height: 44px;
  border-radius: 16px;
  display:flex;
  align-items:center;
  justify-content:center;
  color: #fff;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  box-shadow: 0 16px 40px rgba(255,59,122,.14);
  flex-shrink:0;
}
.contact-meta{
  min-width:0;
}
.contact-meta strong{
  display:block;
  font-size: 14px;
  font-weight: 950;
}
.contact-meta span{
  display:block;
  margin-top: 3px;
  color: var(--muted);
  font-size: 12px;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}
.contact-arrow{
  color: var(--muted);
}

/* =========================
   Footer (STACKED, premium)
   ========================= */
.site-footer{
  margin-top: 18px;
  padding: 18px 0 calc(18px + var(--safe-bottom));
  border-top: 1px solid var(--line);
  background:
    radial-gradient(700px 400px at 20% 0%, rgba(255,59,122,.10), transparent 60%),
    radial-gradient(700px 400px at 80% 0%, rgba(124,92,255,.10), transparent 65%),
    linear-gradient(180deg, rgba(255,255,255,.74), rgba(255,255,255,.46));
  backdrop-filter: blur(var(--blur));
}
html[data-theme="dark"] .site-footer{
  background:
    radial-gradient(700px 400px at 20% 0%, rgba(255,59,122,.14), transparent 60%),
    radial-gradient(700px 400px at 80% 0%, rgba(124,92,255,.14), transparent 65%),
    linear-gradient(180deg, rgba(20,20,28,.88), rgba(20,20,28,.72));
}

.footer-grid{
  display:grid;
  gap: 14px;
}
.footer-card{
  border-radius: var(--radius-xl);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.74);
  box-shadow: var(--shadow-sm);
  padding: 14px;
}
html[data-theme="dark"] .footer-card{background: rgba(255,255,255,.06)}
.footer-card h4{
  margin:0;
  font-weight: 950;
  font-size: 14px;
}
.footer-card p{
  margin: 8px 0 0;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.45;
}

.footer-actions{
  display:flex;
  flex-wrap:wrap;
  gap: 10px;
  margin-top: 12px;
}
.footer-actions .btn{
  flex: 1 1 160px;
}

.footer-links{
  margin-top: 10px;
  display:grid;
  gap: 10px;
}
.footer-links .btn{
  justify-content:flex-start;
}

/* Newsletter */
#newsletterForm{
  margin-top: 10px;
  display:grid;
  gap: 10px;
}
.news-row{
  display:grid;
  grid-template-columns: 1fr;
  gap: 10px;
}
#newsletterEmail{
  height: var(--tap);
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.72);
  padding: 0 12px;
  outline:none;
}
html[data-theme="dark"] #newsletterEmail{background: rgba(255,255,255,.06)}
#newsletterEmail:focus{
  border-color: rgba(255,59,122,.30);
  box-shadow: 0 0 0 4px rgba(255,59,122,.14), 0 18px 60px rgba(18,18,30,.10);
}
.footer-bottom{
  margin-top: 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  flex-wrap:wrap;
  color: var(--muted);
  font-size: 12px;
}
.footer-mini{
  display:flex;
  gap: 10px;
  align-items:center;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.60);
}
html[data-theme="dark"] .pill{background: rgba(255,255,255,.06)}

/* =========================
   Back to top button
   ========================= */
#backToTopBtn{
  position: fixed;
  right: calc(14px + var(--safe-right));
  bottom: calc(18px + var(--safe-bottom));
  z-index: 9700;
  height: 48px;
  width: 48px;
  border-radius: 18px;
  border: 1px solid var(--line);
  background: rgba(255,255,255,.76);
  box-shadow: var(--shadow-md);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  opacity: 0;
  transform: translateY(10px);
  pointer-events: none;
  transition: opacity .2s ease, transform .2s ease;
}
html[data-theme="dark"] #backToTopBtn{background: rgba(20,20,28,.82)}
#backToTopBtn.show{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
#backToTopBtn:focus-visible{
  outline: 3px solid rgba(255,59,122,.24);
  outline-offset: 2px;
}

/* =========================
   Accessibility / Motion
   ========================= */
@media (prefers-reduced-motion: reduce){
  *{scroll-behavior:auto !important; transition:none !important; animation:none !important}
}

/* =========================
   Responsive Enhancements (Tablet / Desktop)
   ========================= */
@media (min-width: 720px){
  :root{--pad: 18px}

  /* Modals become centered dialogs on larger screens */
  .ab-modal-backdrop,
  #checkoutModal{
    align-items: center;
    padding: 18px;
  }
  .ab-modal,
  .checkout-sheet{
    border-radius: var(--radius-xl);
    border: 1px solid var(--line);
    max-height: min(86vh, 760px);
  }

  /* Product grid 2 columns */
  #productGrid{
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }

  .shop-head{
    grid-template-columns: 1fr;
  }
  .shop-controls{
    grid-template-columns: 1.2fr .8fr;
  }

  /* Hero height */
  #heroSlider{
    height: 56vh;
    min-height: 420px;
    max-height: 680px;
  }

  /* Success grid becomes 2 columns */
  .succ-grid{
    grid-template-columns: 1fr 1fr;
  }

  /* Footer grid can become 2 columns */
  .footer-grid{
    grid-template-columns: 1fr 1fr;
  }
}

@media (min-width: 1024px){
  /* Product grid 3 columns */
  #productGrid{
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }

  /* Drawer slightly wider */
  .drawer{width: 440px}

  /* Footer 3 columns */
  .footer-grid{
    grid-template-columns: 1.2fr 1fr 1fr;
  }
}

/* =========================
   Micro polish: subtle separators
   ========================= */
.hr{
  height: 1px;
  background: var(--line);
  border: 0;
  margin: 12px 0;
}

/* =========================
   Small helper utilities (optional)
   ========================= */
.hidden{display:none !important}
.center{text-align:center}
.muted{color: var(--muted)}
</style>

</head>
<body>
  <!-- Top progress bar (nice touch) -->
  <div id="topProgress" aria-hidden="true"></div>

  <!-- Sticky header -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <a class="brand" href="#top" aria-label="April Blossoms home">
        <img class="brand-logo" src="logo.jpg" alt="April Blossoms logo" />
        <div class="brand-text">
          <div class="brand-name">April Blossoms</div>
          <div class="brand-tagline">One-of-a-kind kidswear • 50 pieces only</div>
        </div>
      </a>

      <nav class="header-actions" aria-label="Header actions">
        <!-- Search (feature: quick filter) -->
        <div class="header-search" role="search">
          <label class="sr-only" for="searchInput">Search products</label>
          <input id="searchInput" type="search" placeholder="Search dresses… (e.g. floral, lace, mint)" autocomplete="off" />
          <button id="clearSearchBtn" type="button" class="icon-btn" aria-label="Clear search">
            <i class="fa-solid fa-xmark" aria-hidden="true"></i>
          </button>
        </div>

        <!-- Wishlist (extra feature) -->
        <button id="wishlistBtn" type="button" class="icon-btn" aria-label="Wishlist">
          <i class="fa-regular fa-heart" aria-hidden="true"></i>
          <span class="badge" id="wishlistCount" aria-label="Wishlist count">0</span>
        </button>

        <!-- History -->
        <button id="historyBtn" type="button" class="icon-btn" aria-label="Purchase history">
          <i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i>
          <span class="badge" id="historyCount" aria-label="Purchased items count">0</span>
        </button>

        <!-- Cart -->
        <button id="cartBtn" type="button" class="icon-btn cart-btn" aria-label="Open cart">
          <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i>
          <span class="badge" id="cartCount" aria-label="Cart item count">0</span>
        </button>
      </nav>
    </div>

    <!-- Secondary bar: filters (no sizes) -->
    <div class="subbar" aria-label="Filters">
      <div class="subbar-inner">
        <div class="chips" role="group" aria-label="Quick filters">
          <button class="chip active" type="button" data-filter="all">All</button>
          <button class="chip" type="button" data-filter="new">New arrivals</button>
          <button class="chip" type="button" data-filter="under40">Under $40</button>
          <button class="chip" type="button" data-filter="premium">Premium</button>
          <button class="chip" type="button" data-filter="available">Available</button>
        </div>

        <div class="sorters">
          <label class="sr-only" for="sortSelect">Sort</label>
          <select id="sortSelect" aria-label="Sort products">
            <option value="newest">Sort: Newest</option>
            <option value="priceLow">Sort: Price (Low → High)</option>
            <option value="priceHigh">Sort: Price (High → Low)</option>
            <option value="title">Sort: Name (A → Z)</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <main id="top" role="main">
    <!-- HERO: slideshow -->
    <section class="hero" aria-label="Featured kidswear slideshow">
      <div class="hero-slider" id="heroSlider" aria-roledescription="carousel" aria-label="April Blossoms featured slides">
        <!-- Slide 1 -->
        <article class="hero-slide is-active" data-slide="1" aria-label="Slide 1 of 3">
          <img src="hero-1.jpg" alt="April Blossoms one-of-a-kind kidswear featured collection" />
          <div class="hero-overlay">
            <div class="hero-copy">
              <div class="hero-eyebrow"><i class="fa-solid fa-sparkles" aria-hidden="true"></i> Limited Drop</div>
              <h1>One dress. One child. One moment.</h1>
              <p>
                April Blossoms is a curated kidswear shop — every piece is <strong>unique</strong>. Once it’s gone, it’s gone.
              </p>
              <div class="hero-cta">
                <a href="#shop" class="btn primary" id="shopNowBtn">
                  <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i> Shop the Collection
                </a>
                <button type="button" class="btn ghost" id="howItWorksBtn">
                  <i class="fa-solid fa-circle-info" aria-hidden="true"></i> How it works
                </button>
              </div>

              <div class="hero-metrics" aria-label="Key shop highlights">
                <div class="metric">
                  <div class="metric-value" id="metricTotal">50</div>
                  <div class="metric-label">Total pieces</div>
                </div>
                <div class="metric">
                  <div class="metric-value" id="metricUnique">100%</div>
                  <div class="metric-label">One-of-a-kind</div>
                </div>
                <div class="metric">
                  <div class="metric-value" id="metricFast">Instant</div>
                  <div class="metric-label">Checkout</div>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 2 -->
        <article class="hero-slide" data-slide="2" aria-label="Slide 2 of 3">
          <img src="hero-2.jpg" alt="A beautiful kids dress collection from April Blossoms" />
          <div class="hero-overlay">
            <div class="hero-copy">
              <div class="hero-eyebrow"><i class="fa-solid fa-heart" aria-hidden="true"></i> Made to be loved</div>
              <h2>Designed for twirls, photos, and playdates.</h2>
              <p>
                No size selection needed — each listing is a single piece. Add to cart before someone else does.
              </p>
              <div class="hero-cta">
                <a href="#shop" class="btn primary">
                  <i class="fa-solid fa-arrow-down" aria-hidden="true"></i> Browse Dresses
                </a>
                <button type="button" class="btn ghost" id="openCartFromHero">
                  <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i> Open Cart
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 3 -->
        <article class="hero-slide" data-slide="3" aria-label="Slide 3 of 3">
          <img src="hero-4.jpg" alt="April Blossoms premium kidswear showcase" />
          <div class="hero-overlay">
            <div class="hero-copy">
              <div class="hero-eyebrow"><i class="fa-solid fa-crown" aria-hidden="true"></i> Premium picks</div>
              <h2>Special occasion pieces that sell fast.</h2>
              <p>
                Secure payments via Paystack, instant receipts, and a purchase history you can revisit anytime.
              </p>
              <div class="hero-cta">
                <button type="button" class="btn primary" id="viewNewArrivalsBtn">
                  <i class="fa-solid fa-bolt" aria-hidden="true"></i> View New Arrivals
                </button>
                <a href="#contact" class="btn ghost">
                  <i class="fa-solid fa-envelope" aria-hidden="true"></i> Contact Us
                </a>
              </div>
            </div>
          </div>
        </article>

        <!-- Slider controls -->
        <div class="hero-controls" aria-label="Slideshow controls">
          <button type="button" class="hero-nav prev" id="heroPrev" aria-label="Previous slide">
            <i class="fa-solid fa-chevron-left" aria-hidden="true"></i>
          </button>

          <div class="hero-dots" role="tablist" aria-label="Choose slide">
            <button type="button" class="dot is-active" aria-label="Go to slide 1" data-go="1"></button>
            <button type="button" class="dot" aria-label="Go to slide 2" data-go="2"></button>
            <button type="button" class="dot" aria-label="Go to slide 3" data-go="3"></button>
          </div>

          <button type="button" class="hero-nav next" id="heroNext" aria-label="Next slide">
            <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      <!-- Trust strip -->
      <div class="trust-strip" aria-label="Shop guarantees">
        <div class="trust-item"><i class="fa-solid fa-circle-check" aria-hidden="true"></i> One piece per listing</div>
        <div class="trust-item"><i class="fa-solid fa-shield-heart" aria-hidden="true"></i> Secure Paystack checkout</div>
        <div class="trust-item"><i class="fa-solid fa-file-invoice" aria-hidden="true"></i> PDF receipts + history</div>
        <div class="trust-item"><i class="fa-solid fa-bolt" aria-hidden="true"></i> Fast confirmation</div>
      </div>
    </section>

    <!-- SHOP -->
    <section class="shop" id="shop" aria-label="Shop kidswear">
      <div class="section-head">
        <div>
          <h2 class="section-title">Shop the Collection</h2>
          <p class="section-subtitle">
            First 12 items are shown. Tap <strong>Show More</strong> to reveal the full 50-piece drop.
          </p>
        </div>

        <div class="section-tools" aria-label="Shop tools">
          <button type="button" class="pill" id="inStockOnlyBtn" aria-pressed="false">
            <i class="fa-solid fa-filter" aria-hidden="true"></i> In stock only
          </button>
          <button type="button" class="pill" id="clearFiltersBtn">
            <i class="fa-solid fa-broom" aria-hidden="true"></i> Clear
          </button>
        </div>
      </div>

      <!-- Product grid injected by JS -->
      <div class="product-grid" id="productGrid" aria-live="polite"></div>

      <!-- Show More / Show Less -->
      <div class="show-controls" aria-label="Show more products controls">
        <button type="button" class="btn primary" id="showMoreBtn">
          <i class="fa-solid fa-plus" aria-hidden="true"></i> Show More
        </button>
        <button type="button" class="btn ghost" id="showLessBtn" style="display:none">
          <i class="fa-solid fa-minus" aria-hidden="true"></i> Show Less
        </button>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="contact" id="contact" aria-label="Contact April Blossoms">
      <div class="section-head">
        <div>
          <h2 class="section-title">Contact</h2>
          <p class="section-subtitle">Questions, custom requests, or help with an order — reach us quickly.</p>
        </div>
      </div>

      <div class="contact-cards" role="list">
        <article class="contact-card" role="listitem">
          <div class="contact-icon"><i class="fa-solid fa-phone" aria-hidden="true"></i></div>
          <div class="contact-info">
            <div class="contact-title">Phone</div>
            <a href="tel:0205237411" class="contact-link">0205237411</a>
          </div>
          <div class="contact-action">
            <a class="btn ghost" href="tel:0205237411"><i class="fa-solid fa-phone" aria-hidden="true"></i> Call</a>
          </div>
        </article>

        <article class="contact-card" role="listitem">
          <div class="contact-icon"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i></div>
          <div class="contact-info">
            <div class="contact-title">WhatsApp</div>
            <a href="https://wa.me/233205237411" target="_blank" rel="noopener" class="contact-link">Chat on WhatsApp</a>
          </div>
          <div class="contact-action">
            <a class="btn ghost" href="https://wa.me/233205237411" target="_blank" rel="noopener">
              <i class="fa-brands fa-whatsapp" aria-hidden="true"></i> Message
            </a>
          </div>
        </article>

        <article class="contact-card" role="listitem">
          <div class="contact-icon"><i class="fa-solid fa-envelope" aria-hidden="true"></i></div>
          <div class="contact-info">
            <div class="contact-title">Email</div>
            <a href="mailto:aprilblossoms@gmail.com" class="contact-link">aprilblossoms@gmail.com</a>
          </div>
          <div class="contact-action">
            <a class="btn ghost" href="mailto:aprilblossoms@gmail.com">
              <i class="fa-solid fa-envelope" aria-hidden="true"></i> Email
            </a>
          </div>
        </article>
      </div>
    </section>
  </main>

  <!-- VERY STACKED FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-top">
      <div class="footer-col brand-col">
        <div class="footer-brand">
          <img src="logo.jpg" alt="April Blossoms logo" class="footer-logo" />
          <div>
            <div class="footer-brand-name">April Blossoms</div>
            <div class="footer-brand-sub">A curated kidswear shop — every item is one-of-one.</div>
          </div>
        </div>

        <div class="footer-badges" aria-label="Footer highlights">
          <div class="footer-badge"><i class="fa-solid fa-star" aria-hidden="true"></i> Unique pieces</div>
          <div class="footer-badge"><i class="fa-solid fa-lock" aria-hidden="true"></i> Secure payments</div>
          <div class="footer-badge"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i> PDF receipts</div>
          <div class="footer-badge"><i class="fa-solid fa-clock" aria-hidden="true"></i> Purchase history</div>
        </div>

        <form class="footer-newsletter" id="newsletterForm" aria-label="Newsletter signup">
          <div class="footer-form-title">Get new drops first</div>
          <div class="footer-form-row">
            <label class="sr-only" for="newsletterEmail">Email</label>
            <input id="newsletterEmail" type="email" placeholder="Enter your email" />
            <button type="submit" class="btn primary">
              <i class="fa-solid fa-paper-plane" aria-hidden="true"></i> Join
            </button>
          </div>
          <small class="footer-note">No spam — only drop alerts and special offers.</small>
        </form>
      </div>

      <div class="footer-col">
        <div class="footer-title">Shop</div>
        <ul class="footer-links">
          <li><a href="#shop">All products</a></li>
          <li><button type="button" class="link-btn" id="footerNewArrivals">New arrivals</button></li>
          <li><button type="button" class="link-btn" id="footerUnder40">Under $40</button></li>
          <li><button type="button" class="link-btn" id="footerPremium">Premium picks</button></li>
          <li><button type="button" class="link-btn" id="footerInStock">In stock</button></li>
        </ul>
      </div>

      <div class="footer-col">
        <div class="footer-title">Customer</div>
        <ul class="footer-links">
          <li><button type="button" class="link-btn" id="openCartFooter">Cart & checkout</button></li>
          <li><button type="button" class="link-btn" id="openHistoryFooter">Purchase history</button></li>
          <li><button type="button" class="link-btn" id="openWishlistFooter">Wishlist</button></li>
          <li><button type="button" class="link-btn" id="openPoliciesBtn">Store policies</button></li>
          <li><button type="button" class="link-btn" id="openFaqBtn">FAQ</button></li>
        </ul>
      </div>

      <div class="footer-col">
        <div class="footer-title">Contact</div>
        <ul class="footer-links">
          <li><a href="tel:0205237411"><i class="fa-solid fa-phone" aria-hidden="true"></i> 0205237411</a></li>
          <li><a href="https://wa.me/233205237411" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i> WhatsApp</a></li>
          <li><a href="mailto:aprilblossoms@gmail.com"><i class="fa-solid fa-envelope" aria-hidden="true"></i> Email us</a></li>
        </ul>

        <div class="footer-social" aria-label="Social links">
          <button type="button" class="icon-btn" aria-label="Copy shop link" id="copyShopLinkBtn">
            <i class="fa-solid fa-link" aria-hidden="true"></i>
          </button>
          <button type="button" class="icon-btn" aria-label="Share shop" id="shareShopBtn">
            <i class="fa-solid fa-share-nodes" aria-hidden="true"></i>
          </button>
          <button type="button" class="icon-btn" aria-label="Theme toggle" id="themeToggleBtn">
            <i class="fa-solid fa-moon" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom-left">
        <small>© <span id="yearNow">2026</span> April Blossoms. All rights reserved.</small>
        <small class="dot-sep">•</small>
        <small><button type="button" class="link-btn" id="openTermsBtn">Terms</button></small>
        <small class="dot-sep">•</small>
        <small><button type="button" class="link-btn" id="openPrivacyBtn">Privacy</button></small>
      </div>

      <div class="footer-bottom-right">
        <div class="payment-row" aria-label="Payment methods">
          <span class="pill small"><i class="fa-solid fa-shield" aria-hidden="true"></i> Paystack</span>
          <span class="pill small"><i class="fa-solid fa-receipt" aria-hidden="true"></i> Instant receipts</span>
          <span class="pill small"><i class="fa-solid fa-box" aria-hidden="true"></i> One-of-one stock</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Back to top (appears after scroll) -->
  <button id="backToTopBtn" type="button" aria-label="Back to top">
    <i class="fa-solid fa-arrow-up" aria-hidden="true"></i>
  </button>

  <!-- MODALS ROOT -->
  <div id="modalRoot" aria-live="polite" style="display:none"></div>

  <!-- CART DRAWER (stacked) -->
  <aside id="cartDrawer" class="drawer" aria-label="Shopping cart" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">
        <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i>
        <div>
          <div class="drawer-h">Your Cart</div>
          <div class="drawer-sub"><span id="cartSubCount">0</span> items • One-of-one stock</div>
        </div>
      </div>
      <button id="closeCartBtn" type="button" class="icon-btn" aria-label="Close cart">
        <i class="fa-solid fa-xmark" aria-hidden="true"></i>
      </button>
    </div>

    <!-- Freebie / promo area -->
    <div class="drawer-banner" role="note" aria-label="Cart perks">
      <div class="banner-badge"><i class="fa-solid fa-gift" aria-hidden="true"></i></div>
      <div class="banner-text">
        <strong>Pro tip:</strong> Items are unique. Checkout quickly to secure them.
        <div class="muted">We save your cart locally so you can continue later.</div>
      </div>
    </div>

    <!-- Cart items injected by JS -->
    <div class="drawer-body" id="cartItems" aria-live="polite"></div>

    <!-- Cart summary -->
    <div class="drawer-summary" aria-label="Cart totals">
      <div class="summary-row">
        <span>Subtotal</span>
        <strong id="cartSubtotal">$0.00</strong>
      </div>

      <div class="summary-row">
        <span>Processing fee</span>
        <strong id="cartFee">$0.00</strong>
      </div>

      <div class="summary-row">
        <span>Delivery</span>
        <strong id="cartDelivery">To be arranged</strong>
      </div>

      <div class="summary-row total">
        <span>Total</span>
        <strong id="cartTotal">$0.00</strong>
      </div>

      <div class="summary-actions">
        <button id="checkoutBtn" type="button" class="btn primary">
          <i class="fa-solid fa-lock" aria-hidden="true"></i> Checkout
        </button>
        <button id="clearCartBtn" type="button" class="btn ghost">
          <i class="fa-solid fa-trash" aria-hidden="true"></i> Clear cart
        </button>
      </div>

      <small class="drawer-note">
        By checking out, you’ll get a PDF receipt + it will be saved in your purchase history.
      </small>
    </div>
  </aside>

  <!-- HISTORY DRAWER -->
  <aside id="historyDrawer" class="drawer" aria-label="Purchase history" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">
        <i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i>
        <div>
          <div class="drawer-h">Purchase History</div>
          <div class="drawer-sub"><span id="historySubCount">0</span> purchases saved</div>
        </div>
      </div>
      <button id="closeHistoryBtn" type="button" class="icon-btn" aria-label="Close history">
        <i class="fa-solid fa-xmark" aria-hidden="true"></i>
      </button>
    </div>

    <div class="drawer-body" id="historyList" aria-live="polite"></div>

    <div class="drawer-summary">
      <div class="summary-actions">
        <button id="exportHistoryBtn" type="button" class="btn ghost">
          <i class="fa-solid fa-file-export" aria-hidden="true"></i> Export
        </button>
        <button id="clearHistoryBtn" type="button" class="btn ghost">
          <i class="fa-solid fa-trash" aria-hidden="true"></i> Clear history
        </button>
      </div>
      <small class="drawer-note">
        Your history stays on this device. PDFs can be downloaded again anytime.
      </small>
    </div>
  </aside>

  <!-- CHECKOUT MODAL (Paystack email required) -->
  <div id="checkoutModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="checkoutTitle">
      <div class="modal-head">
        <div>
          <div class="modal-kicker"><i class="fa-solid fa-shield-heart" aria-hidden="true"></i> Secure Checkout</div>
          <h3 id="checkoutTitle">Checkout</h3>
          <p class="modal-sub">Enter details for receipt + delivery contact. No size selection required.</p>
        </div>
        <button id="closeCheckoutBtn" type="button" class="icon-btn" aria-label="Close checkout">
          <i class="fa-solid fa-xmark" aria-hidden="true"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="checkout-grid">
          <div class="checkout-left" aria-label="Customer details">
            <div class="field">
              <label for="fullName">Full name</label>
              <input id="fullName" type="text" placeholder="Buyer name" autocomplete="name" />
            </div>

            <div class="field">
              <label for="phoneNumber">Phone number</label>
              <input id="phoneNumber" type="tel" placeholder="e.g. 024xxxxxxx" inputmode="tel" autocomplete="tel" />
            </div>

            <div class="field">
              <label for="emailAddress">Email address (Paystack receipt)</label>
              <input id="emailAddress" type="email" placeholder="e.g. name@gmail.com" inputmode="email" autocomplete="email" />
              <small class="hint">A valid email is required so Paystack can send your receipt.</small>
            </div>

            <div class="field">
              <label for="deliveryAddress">Delivery address</label>
              <textarea id="deliveryAddress" rows="3" placeholder="Enter delivery address (delivery fee arranged after payment)"></textarea>
            </div>

            <div class="field">
              <label>Delivery method</label>
              <div class="segmented" role="radiogroup" aria-label="Delivery method">
                <label class="seg">
                  <input type="radio" name="deliveryMethod" value="delivery" checked />
                  <span><i class="fa-solid fa-truck" aria-hidden="true"></i> Delivery</span>
                </label>
                <label class="seg">
                  <input type="radio" name="deliveryMethod" value="pickup" />
                  <span><i class="fa-solid fa-store" aria-hidden="true"></i> Pickup</span>
                </label>
              </div>
            </div>
          </div>

          <div class="checkout-right" aria-label="Order summary">
            <div class="summary-card">
              <div class="summary-title"><i class="fa-solid fa-receipt" aria-hidden="true"></i> Order Summary</div>
              <div id="checkoutItems" class="summary-items"></div>

              <div class="summary-lines">
                <div class="line"><span>Subtotal</span><strong id="checkoutSubtotal">$0.00</strong></div>
                <div class="line"><span>Processing fee</span><strong id="checkoutFee">$0.00</strong></div>
                <div class="line"><span>Delivery</span><strong id="checkoutDelivery">To be arranged</strong></div>
                <div class="line total"><span>Total</span><strong id="checkoutTotal">$0.00</strong></div>
              </div>

              <div class="summary-actions">
                <button id="payNowBtn" type="button" class="btn primary">
                  <i class="fa-solid fa-credit-card" aria-hidden="true"></i> Pay with Paystack
                </button>
                <button id="cancelCheckoutBtn" type="button" class="btn ghost">
                  <i class="fa-solid fa-xmark" aria-hidden="true"></i> Cancel
                </button>
              </div>

              <small class="hint">
                After payment: a receipt PDF will be generated and saved in your history.
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Generic overlay for drawers -->
  <div id="overlay" class="overlay" aria-hidden="true"></div>
</body>
  <script>
(() => {
  'use strict';

  /* =========================
     CONFIG
  ========================= */
  const CONFIG = {
    brand: 'April Blossoms',
    currency: 'GHS',
    currencySymbol: 'GH₵',
    processingRate: 0.0295, // 2.95%
    paystackPublicKey: 'pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa',
    formspreeEndpoint: 'https://formspree.io/f/xrbyrqry',
    cartPickupAddress: 'Pickup (store arrangement)',
    initialVisible: 12,
    heroAutoplayMs: 4500
  };

  /* =========================
     PRODUCTS (JS-loaded)
     NOTE: sizes exist in data but we do NOT show size picking.
  ========================= */
  const PRODUCTS = [
    { id: "DRESS-001", title: "Floral Ruffles", price: 40.00, description: "One-of-a-kind floral ruffle dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5700.JPG","IMG_5700.JPG"], available: true, createdAt: new Date(Date.now()-1*86400000).toISOString() },
    { id: "DRESS-002", title: "Sunshine Dress", price: 30.00, description: "Bright yellow play dress", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5701.JPG"], available: true, createdAt: new Date(Date.now()-2*86400000).toISOString() },
    { id: "DRESS-003", title: "Party Bow Dress", price: 35.00, description: "Elegant dress for special occasions", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5702.JPG","IMG_5702.JPG"], available: true, createdAt: new Date(Date.now()-3*86400000).toISOString() },
    { id: "DRESS-004", title: "Polka Play", price: 35.00, description: "Polka-dot twirl dress", sizes: ["0-3M","3-6M"], ageCategory: "4-5", images: ["IMG_5703.JPG"], available: true, createdAt: new Date(Date.now()-4*86400000).toISOString() },
    { id: "DRESS-005", title: "Candy Stripes", price: 35.00, description: "Soft striped cotton dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5704.JPG","IMG_5704.JPG"], available: true, createdAt: new Date(Date.now()-5*86400000).toISOString() },
    { id: "DRESS-006", title: "Meadow Tiny", price: 35.00, description: "Hand-stitched meadow pattern", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5705.JPG"], available: true, createdAt: new Date(Date.now()-6*86400000).toISOString() },
    { id: "DRESS-007", title: "Lace Halo", price: 40.00, description: "Lace-trim party dress", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5706.JPG","IMG_5706.JPG"], available: true, createdAt: new Date(Date.now()-7*86400000).toISOString() },
    { id: "DRESS-008", title: "Seaside Sundress", price: 35.00, description: "Cool and breezy sun dress", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5707.JPG"], available: true, createdAt: new Date(Date.now()-8*86400000).toISOString() },
    { id: "DRESS-009", title: "Minty Bow", price: 100.00, description: "White Shirt with skirt", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5708.JPG","IMG_5708.JPG"], available: true, createdAt: new Date(Date.now()-9*86400000).toISOString() },
    { id: "DRESS-010", title: "Rosette Charm", price: 35.00, description: "Rosette detailing, comfy fit", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5709.JPG"], available: true, createdAt: new Date(Date.now()-10*86400000).toISOString() },

    { id: "DRESS-011", title: "Blossom Day", price: 30.00, description: "Lightweight blossom print dress", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5710.JPG","IMG_5710.JPG"], available: true, createdAt: new Date(Date.now()-11*86400000).toISOString() },
    { id: "DRESS-012", title: "Vintage Coral", price: 40.00, description: "Retro coral dress with pockets", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5711.JPG"], available: true, createdAt: new Date(Date.now()-12*86400000).toISOString() },
    { id: "DRESS-013", title: "Petal Puff", price: 30.00, description: "Petal-pattern puff sleeve dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5712.JPG","IMG_5712.JPG"], available: true, createdAt: new Date(Date.now()-13*86400000).toISOString() },
    { id: "DRESS-014", title: "Lemon Drop", price: 65.00, description: "Blue jeans trousers", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5713.JPG"], available: true, createdAt: new Date(Date.now()-14*86400000).toISOString() },
    { id: "DRESS-015", title: "Bluebell Classic", price: 65.00, description: "Black jeans trousers", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5714.JPG","IMG_5714.JPG"], available: true, createdAt: new Date(Date.now()-15*86400000).toISOString() },
    { id: "DRESS-016", title: "Gingham Girl", price: 35.00, description: "Cute gingham for playdates", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5715.JPG"], available: true, createdAt: new Date(Date.now()-16*86400000).toISOString() },
    { id: "DRESS-017", title: "Velvet Holiday", price: 50.00, description: "Velvet holiday edition", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5716.JPG","IMG_5716.JPG"], available: true, createdAt: new Date(Date.now()-17*86400000).toISOString() },
    { id: "DRESS-018", title: "Daisy Chain", price: 70.00, description: "Daisy print with soft lining", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5717.JPG"], available: true, createdAt: new Date(Date.now()-18*86400000).toISOString() },
    { id: "DRESS-019", title: "Sunset Ombre", price: 50.00, description: "Ombre fade summer dress", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5718.JPG","IMG_5718.JPG"], available: true, createdAt: new Date(Date.now()-19*86400000).toISOString() },
    { id: "DRESS-020", title: "Coral Petals", price: 70.00, description: "Coral floral with ruffled hem", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5719.JPG"], available: true, createdAt: new Date(Date.now()-20*86400000).toISOString() },

    { id: "DRESS-021", title: "Lavender Mist", price: 28.00, description: "Soft lavender cotton dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5720.JPG","IMG_5720.JPG"], available: true, createdAt: new Date(Date.now()-21*86400000).toISOString() },
    { id: "DRESS-022", title: "Plaid Picnic", price: 28.00, description: "Cute plaid button dress", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5720.JPG"], available: true, createdAt: new Date(Date.now()-22*86400000).toISOString() },
    { id: "DRESS-023", title: "Rosebud Twirl", price: 120.00, description: "Lightweight twirl skirt", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5721.JPG","IMG_5721.JPG"], available: true, createdAt: new Date(Date.now()-23*86400000).toISOString() },
    { id: "DRESS-024", title: "Mint Sprig", price: 80.00, description: "Refreshingly cool mint dress", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5722.JPG"], available: true, createdAt: new Date(Date.now()-24*86400000).toISOString() },
    { id: "DRESS-025", title: "Buttercup", price: 35.00, description: "Premium buttercup fabric", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5723.JPG","IMG_5723.JPG"], available: true, createdAt: new Date(Date.now()-25*86400000).toISOString() },
    { id: "DRESS-026", title: "Peach Dream", price: 60.00, description: "Soft peach party dress", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5724.JPG"], available: true, createdAt: new Date(Date.now()-26*86400000).toISOString() },
    { id: "DRESS-027", title: "Ivy Garden", price: 35.00, description: "Ivy print with tiny pleats", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5725.JPG","IMG_5725.JPG"], available: true, createdAt: new Date(Date.now()-27*86400000).toISOString() },
    { id: "DRESS-028", title: "Ocean Breeze", price: 45.00, description: "Nautical details and stripes", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5726.JPG"], available: true, createdAt: new Date(Date.now()-28*86400000).toISOString() },
    { id: "DRESS-029", title: "Lilac Lace", price: 35.00, description: "Delicate lilac lace overlay", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5727.JPG","IMG_5727.JPG"], available: true, createdAt: new Date(Date.now()-29*86400000).toISOString() },
    { id: "DRESS-030", title: "Maple Sweet", price: 40.00, description: "Warm tones for autumn play", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5728.JPG"], available: true, createdAt: new Date(Date.now()-30*86400000).toISOString() },

    { id: "DRESS-031", title: "Cherry Puff", price: 40.00, description: "Cherry prints and puff sleeves", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5729.JPG","IMG_5729.JPG"], available: true, createdAt: new Date(Date.now()-31*86400000).toISOString() },
    { id: "DRESS-032", title: "Starry Night", price: 35.00, description: "Dark blue with star pattern", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5730.JPG"], available: true, createdAt: new Date(Date.now()-32*86400000).toISOString() },
    { id: "DRESS-033", title: "Palm Picnic", price: 35.00, description: "Tropical print for sunny days", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5731.JPG","IMG_5731.JPG"], available: true, createdAt: new Date(Date.now()-33*86400000).toISOString() },
    { id: "DRESS-034", title: "Velvet Ribbon", price: 40.00, description: "Lux velvet with ribbon tie", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5732.JPG"], available: true, createdAt: new Date(Date.now()-34*86400000).toISOString() },
    { id: "DRESS-035", title: "Rose Quartz", price: 35.00, description: "Soft pink, comfy cotton", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5733.JPG","IMG_5733.JPG"], available: true, createdAt: new Date(Date.now()-35*86400000).toISOString() },
    { id: "DRESS-036", title: "Star Bloom", price: 30.00, description: "Star bloom pattern, breezy", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5734.JPG"], available: true, createdAt: new Date(Date.now()-36*86400000).toISOString() },
    { id: "DRESS-037", title: "Meadow Stitch", price: 40.00, description: "Detailed stitching, floral", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5735.JPG","IMG_5735.JPG"], available: true, createdAt: new Date(Date.now()-37*86400000).toISOString() },
    { id: "DRESS-038", title: "Denim Dolly", price: 50.00, description: "Soft denim dress with buttons", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5736.JPG"], available: true, createdAt: new Date(Date.now()-38*86400000).toISOString() },
    { id: "DRESS-039", title: "Citrine Bloom", price: 65.00, description: "Sunny citrine color", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5737.JPG","IMG_5737.JPG"], available: true, createdAt: new Date(Date.now()-39*86400000).toISOString() },
    { id: "DRESS-040", title: "Cloud Puff", price: 25.00, description: "Puffy clouds print", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5738.JPG"], available: true, createdAt: new Date(Date.now()-40*86400000).toISOString() },

    { id: "DRESS-041", title: "Mint Melody", price: 28.00, description: "Light mint with trims", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5739.JPG","IMG_5739.JPG"], available: true, createdAt: new Date(Date.now()-41*86400000).toISOString() },
    { id: "DRESS-042", title: "Petite Pearl", price: 25.00, description: "Pearl button detail", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5740.JPG"], available: true, createdAt: new Date(Date.now()-42*86400000).toISOString() },
    { id: "DRESS-043", title: "Coral Breeze", price: 35.00, description: "Soft coral shade", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5741.JPG","IMG_5741.JPG"], available: true, createdAt: new Date(Date.now()-43*86400000).toISOString() },
    { id: "DRESS-044", title: "Pineapple Pop", price: 30.00, description: "Fun pineapple print", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5742.JPG"], available: true, createdAt: new Date(Date.now()-44*86400000).toISOString() },
    { id: "DRESS-045", title: "Willow Whisper", price: 40.00, description: "Earthy willow tones", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5743.JPG","IMG_5743.JPG"], available: true, createdAt: new Date(Date.now()-45*86400000).toISOString() },
    { id: "DRESS-046", title: "Sunbeam Tuck", price: 35.00, description: "Tucked waist, sunny print", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5744.JPG"], available: true, createdAt: new Date(Date.now()-46*86400000).toISOString() },
    { id: "DRESS-047", title: "Peppermint Twist", price: 30.00, description: "Mint stripes and soft collar", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5745.JPG","IMG_5745.JPG"], available: true, createdAt: new Date(Date.now()-47*86400000).toISOString() },
    { id: "DRESS-048", title: "Dotted Dreams", price: 60.00, description: "Subtle dotted pattern", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5746.JPG"], available: true, createdAt: new Date(Date.now()-48*86400000).toISOString() },
    { id: "DRESS-049", title: "Little Luxe", price: 80.00, description: "Tiny luxe finish", sizes: ["9","10"], ageCategory: "7-8", images: ["IMG_5747.JPG","IMG_5747.JPG"], available: true, createdAt: new Date(Date.now()-49*86400000).toISOString() },
    { id: "DRESS-050", title: "Pocket Garden", price: 40.00, description: "Playful pockets and cotton", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5748.JPG"], available: true, createdAt: new Date(Date.now()-50*86400000).toISOString() }
  ];

  /* =========================
     DOM HELPERS
  ========================= */
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const byId = (id) => document.getElementById(id);

  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));
  const money = (n) => `${CONFIG.currencySymbol} ${Number(n || 0).toFixed(2)}`;

  function escapeHtml(s='') {
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function isValidEmail(email) {
    const e = String(email || '').trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(e);
  }

  function uid(prefix='AB') {
    return `${prefix}-${Date.now()}-${Math.floor(Math.random()*90000+10000)}`;
  }

  /* =========================
     STORAGE
  ========================= */
  const LS_KEYS = {
    cart: 'ab_cart_v1',
    wishlist: 'ab_wishlist_v1',
    history: 'ab_history_v1',
    sold: 'ab_sold_v1',
    theme: 'ab_theme_v1'
  };

  function loadJSON(key, fallback) {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    } catch { return fallback; }
  }
  function saveJSON(key, val) {
    localStorage.setItem(key, JSON.stringify(val));
  }

  /* =========================
     STATE
  ========================= */
  const state = {
    // cart: { [id]: 1 } but always 1 per item
    cart: loadJSON(LS_KEYS.cart, {}),
    wishlist: loadJSON(LS_KEYS.wishlist, []),
    history: loadJSON(LS_KEYS.history, []), // array of purchase objects
    sold: loadJSON(LS_KEYS.sold, []),       // array of sold product ids
    ui: {
      visibleCount: CONFIG.initialVisible,
      filter: 'all',
      inStockOnly: false,
      search: '',
      sort: 'newest',
      heroIndex: 1,
      heroTimer: null
    }
  };

  const productById = new Map(PRODUCTS.map(p => [p.id, p]));

  function isSold(id) {
    return state.sold.includes(id);
  }

  function availableNow(p) {
    return Boolean(p.available) && !isSold(p.id);
  }

  /* =========================
     TOAST (simple, no CSS needed to function)
  ========================= */
  function toast(msg) {
    // If you later add CSS, it’ll look beautiful; for now it still works.
    let host = byId('toastHost');
    if (!host) {
      host = document.createElement('div');
      host.id = 'toastHost';
      host.style.position = 'fixed';
      host.style.right = '14px';
      host.style.bottom = '14px';
      host.style.zIndex = '99999';
      host.style.display = 'grid';
      host.style.gap = '8px';
      document.body.appendChild(host);
    }
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.background = 'rgba(20,20,22,0.92)';
    t.style.color = '#fff';
    t.style.padding = '10px 12px';
    t.style.borderRadius = '12px';
    t.style.maxWidth = 'min(360px, calc(100vw - 28px))';
    t.style.fontSize = '14px';
    t.style.boxShadow = '0 14px 30px rgba(0,0,0,0.22)';
    host.appendChild(t);
    setTimeout(() => {
      t.style.opacity = '0';
      t.style.transition = 'opacity 220ms ease';
      setTimeout(() => t.remove(), 240);
    }, 2200);
  }

  /* =========================
     DRAWERS / MODAL CONTROL
  ========================= */
  const overlay = byId('overlay');
  const cartDrawer = byId('cartDrawer');
  const historyDrawer = byId('historyDrawer');
  const checkoutModal = byId('checkoutModal');
  const modalRoot = byId('modalRoot');

  function setOverlay(on) {
    if (!overlay) return;
    overlay.setAttribute('aria-hidden', on ? 'false' : 'true');
    overlay.style.display = on ? 'block' : 'none';
  }

  function lockBody(on) {
    document.body.classList.toggle('modal-open', !!on);
  }

  function openDrawer(drawer) {
    if (!drawer) return;
    drawer.setAttribute('aria-hidden', 'false');
    drawer.classList.add('open');
    setOverlay(true);
    lockBody(true);
  }

  function closeDrawer(drawer) {
    if (!drawer) return;
    drawer.setAttribute('aria-hidden', 'true');
    drawer.classList.remove('open');
    // Only remove overlay if no modal is open
    const anyOpen = (cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open') || (checkoutModal && checkoutModal.getAttribute('aria-hidden') === 'false'));
    if (!anyOpen) {
      setOverlay(false);
      lockBody(false);
    }
  }

  function openCheckout() {
    if (!checkoutModal) return;
    checkoutModal.setAttribute('aria-hidden', 'false');
    checkoutModal.style.display = 'flex';
    setOverlay(true);
    lockBody(true);
    // Prefill with last used (nice UX)
    const last = state.history[0]?.buyer || null;
    if (last) {
      const name = byId('fullName'); if (name && !name.value) name.value = last.name || '';
      const phone = byId('phoneNumber'); if (phone && !phone.value) phone.value = last.phone || '';
      const email = byId('emailAddress'); if (email && !email.value) email.value = last.email || '';
      const addr = byId('deliveryAddress'); if (addr && !addr.value) addr.value = last.address || '';
    }
    byId('fullName')?.focus();
  }

  function closeCheckout() {
    if (!checkoutModal) return;
    checkoutModal.setAttribute('aria-hidden', 'true');
    checkoutModal.style.display = 'none';

    const anyOpen = (cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open'));
    if (!anyOpen) {
      setOverlay(false);
      lockBody(false);
    }
  }

  function closeAllOverlays() {
    closeDrawer(cartDrawer);
    closeDrawer(historyDrawer);
    closeCheckout();
    if (modalRoot) {
      modalRoot.innerHTML = '';
      modalRoot.style.display = 'none';
    }
  }

  /* =========================
     HEADER COUNTS
  ========================= */
  function cartCount() {
    return Object.keys(state.cart).length;
  }
  function historyCount() {
    return state.history.reduce((sum, h) => sum + (h.items?.length || 0), 0);
  }
  function wishlistCount() {
    return state.wishlist.length;
  }

  function updateBadges() {
    const c = cartCount();
    const h = historyCount();
    const w = wishlistCount();

    const cartBadge = byId('cartCount'); if (cartBadge) cartBadge.textContent = String(c);
    const histBadge = byId('historyCount'); if (histBadge) histBadge.textContent = String(h);
    const wishBadge = byId('wishlistCount'); if (wishBadge) wishBadge.textContent = String(w);

    const cartSub = byId('cartSubCount'); if (cartSub) cartSub.textContent = String(c);
    const histSub = byId('historySubCount'); if (histSub) histSub.textContent = String(state.history.length);
  }

  /* =========================
     PRODUCT LIST: FILTER/SORT/SEARCH/SHOWMORE
  ========================= */
  function isNewArrival(p) {
    // consider last 10 days as "new"
    const days = (Date.now() - new Date(p.createdAt).getTime()) / 86400000;
    return days <= 10;
  }

  function getFilteredProducts() {
    let list = PRODUCTS.slice();

    // sold affects availability
    if (state.ui.inStockOnly) {
      list = list.filter(p => availableNow(p));
    }

    // quick filter
    switch (state.ui.filter) {
      case 'new':
        list = list.filter(isNewArrival);
        break;
      case 'under40':
        list = list.filter(p => Number(p.price) < 40);
        break;
      case 'premium':
        list = list.filter(p => Number(p.price) >= 60);
        break;
      case 'available':
        list = list.filter(p => availableNow(p));
        break;
      default: break;
    }

    // search
    const q = String(state.ui.search || '').trim().toLowerCase();
    if (q) {
      list = list.filter(p => {
        const hay = `${p.id} ${p.title} ${p.description} ${p.ageCategory}`.toLowerCase();
        return hay.includes(q);
      });
    }

    // sort
    switch (state.ui.sort) {
      case 'priceLow':
        list.sort((a,b) => a.price - b.price);
        break;
      case 'priceHigh':
        list.sort((a,b) => b.price - a.price);
        break;
      case 'title':
        list.sort((a,b) => a.title.localeCompare(b.title));
        break;
      case 'newest':
      default:
        list.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
        break;
    }

    return list;
  }

  function productCardHTML(p) {
    const sold = isSold(p.id);
    const avail = availableNow(p);
    const inCart = Boolean(state.cart[p.id]);
    const wished = state.wishlist.includes(p.id);

    const img = (p.images && p.images[0]) ? p.images[0] : 'hero-1.jpg';
    const badge = sold ? 'Sold' : (isNewArrival(p) ? 'New' : 'One-of-one');

    return `
      <article class="product-card" data-id="${escapeHtml(p.id)}" role="listitem" aria-label="${escapeHtml(p.title)}">
        <div class="pc-media">
          <img src="${escapeHtml(img)}" alt="${escapeHtml(p.title)}">
          <div class="pc-badge ${sold ? 'sold' : ''}">${escapeHtml(badge)}</div>
          <button class="pc-wish" type="button" data-action="toggleWish" aria-label="${wished ? 'Remove from wishlist' : 'Add to wishlist'}">
            <i class="${wished ? 'fa-solid' : 'fa-regular'} fa-heart" aria-hidden="true"></i>
          </button>
        </div>

        <div class="pc-body">
          <div class="pc-top">
            <div class="pc-title">${escapeHtml(p.title)}</div>
            <div class="pc-price">${money(p.price)}</div>
          </div>
          <div class="pc-desc">${escapeHtml(p.description)}</div>

          <div class="pc-meta">
            <span class="pc-chip"><i class="fa-solid fa-child" aria-hidden="true"></i> Age ${escapeHtml(p.ageCategory || '—')}</span>
            <span class="pc-chip"><i class="fa-solid fa-hashtag" aria-hidden="true"></i> ${escapeHtml(p.id)}</span>
          </div>

          <div class="pc-actions">
            <button class="btn ghost" type="button" data-action="quickView">
              <i class="fa-solid fa-eye" aria-hidden="true"></i> Quick view
            </button>

            <button class="btn primary" type="button" data-action="addToCart" ${(!avail || inCart) ? 'disabled' : ''}>
              <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i>
              ${sold ? 'Sold out' : (inCart ? 'In cart' : 'Add')}
            </button>
          </div>

          <div class="pc-note">
            ${sold ? 'This item has been purchased.' : 'Only 1 available — add to cart to reserve.'}
          </div>
        </div>
      </article>
    `;
  }

  function renderProducts() {
    const grid = byId('productGrid');
    if (!grid) return;

    const list = getFilteredProducts();
    const visible = list.slice(0, state.ui.visibleCount);

    grid.innerHTML = visible.length
      ? visible.map(productCardHTML).join('')
      : `<div class="empty-state">No items match your search/filters.</div>`;

    // show more / show less buttons
    const showMoreBtn = byId('showMoreBtn');
    const showLessBtn = byId('showLessBtn');
    const moreAvailable = list.length > state.ui.visibleCount;

    if (showMoreBtn) showMoreBtn.style.display = moreAvailable ? 'inline-flex' : 'none';
    if (showLessBtn) showLessBtn.style.display = (state.ui.visibleCount > CONFIG.initialVisible && list.length > CONFIG.initialVisible) ? 'inline-flex' : 'none';

    // footer / metrics
    const yearNow = byId('yearNow');
    if (yearNow) yearNow.textContent = String(new Date().getFullYear());

    updateBadges();
  }

  /* =========================
     CART (one-of-one)
  ========================= */
  function saveCart() {
    saveJSON(LS_KEYS.cart, state.cart);
    updateBadges();
  }

  function addToCart(id) {
    const p = productById.get(id);
    if (!p) return;
    if (!availableNow(p)) {
      toast('Sorry — this item is no longer available.');
      renderProducts();
      return;
    }
    if (state.cart[id]) {
      toast('Already in cart.');
      return;
    }
    state.cart[id] = 1;
    saveCart();
    toast('Added to cart.');
    renderProducts();
    renderCart();
  }

  function removeFromCart(id) {
    if (!state.cart[id]) return;
    delete state.cart[id];
    saveCart();
    renderCart();
    renderCheckoutSummary();
    renderProducts();
  }

  function clearCart() {
    state.cart = {};
    saveCart();
    renderCart();
    renderCheckoutSummary();
    renderProducts();
  }

  function cartItemsArray() {
    return Object.keys(state.cart)
      .map(id => productById.get(id))
      .filter(Boolean);
  }

  function calcTotals(items) {
    const sub = items.reduce((sum, p) => sum + Number(p.price || 0), 0);
    const fee = Math.round((sub * CONFIG.processingRate) * 100) / 100;
    const total = Math.round((sub + fee) * 100) / 100;
    return { sub, fee, total };
  }

  function renderCart() {
    const host = byId('cartItems');
    if (!host) return;

    const items = cartItemsArray();

    if (!items.length) {
      host.innerHTML = `
        <div class="empty-cart">
          <div class="empty-title">Your cart is empty</div>
          <div class="empty-sub">Add any one-of-one dress to get started.</div>
          <button type="button" class="btn primary" id="emptyShopBtn">
            <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i> Browse items
          </button>
        </div>
      `;
      byId('emptyShopBtn')?.addEventListener('click', () => {
        closeDrawer(cartDrawer);
        document.querySelector('#shop')?.scrollIntoView({ behavior: 'smooth' });
      });
    } else {
      host.innerHTML = items.map(p => {
        const img = (p.images && p.images[0]) ? p.images[0] : 'hero-1.jpg';
        return `
          <div class="cart-item" data-id="${escapeHtml(p.id)}">
            <div class="ci-img"><img src="${escapeHtml(img)}" alt="${escapeHtml(p.title)}"></div>
            <div class="ci-main">
              <div class="ci-row">
                <div class="ci-title">${escapeHtml(p.title)}</div>
                <div class="ci-price">${money(p.price)}</div>
              </div>
              <div class="ci-sub">${escapeHtml(p.id)} • Age ${escapeHtml(p.ageCategory || '—')} • Qty 1</div>

              <div class="ci-actions">
                <button type="button" class="btn ghost" data-action="quickView"><i class="fa-solid fa-eye" aria-hidden="true"></i> View</button>
                <button type="button" class="btn ghost" data-action="saveForLater"><i class="fa-regular fa-bookmark" aria-hidden="true"></i> Save</button>
                <button type="button" class="btn ghost danger" data-action="remove"><i class="fa-solid fa-trash" aria-hidden="true"></i> Remove</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    const totals = calcTotals(items);
    byId('cartSubtotal') && (byId('cartSubtotal').textContent = money(totals.sub));
    byId('cartFee') && (byId('cartFee').textContent = money(totals.fee));
    byId('cartTotal') && (byId('cartTotal').textContent = money(totals.total));

    // Delivery shown as arranged
    byId('cartDelivery') && (byId('cartDelivery').textContent = 'To be arranged');

    byId('cartSubCount') && (byId('cartSubCount').textContent = String(items.length));
    updateBadges();
  }

  /* =========================
     WISHLIST
  ========================= */
  function saveWishlist() {
    saveJSON(LS_KEYS.wishlist, state.wishlist);
    updateBadges();
  }

  function toggleWishlist(id) {
    const idx = state.wishlist.indexOf(id);
    if (idx >= 0) state.wishlist.splice(idx, 1);
    else state.wishlist.unshift(id);

    saveWishlist();
    renderProducts();
    toast(idx >= 0 ? 'Removed from wishlist.' : 'Saved to wishlist.');
  }

  /* =========================
     QUICK VIEW (modalRoot)
  ========================= */
  function openQuickView(id, source='grid') {
    const p = productById.get(id);
    if (!p || !modalRoot) return;

    const imgs = (p.images && p.images.length) ? p.images : ['hero-1.jpg'];
    const sold = isSold(id);
    const avail = availableNow(p);
    const inCart = !!state.cart[id];
    const wished = state.wishlist.includes(id);

    modalRoot.innerHTML = `
      <div class="ab-modal-backdrop" id="qvBackdrop" role="dialog" aria-modal="true" aria-label="Product details">
        <div class="ab-modal">
          <div class="ab-modal-head">
            <div class="ab-modal-title">
              <div class="ab-modal-h">${escapeHtml(p.title)}</div>
              <div class="ab-modal-sub">${escapeHtml(p.id)} • Age ${escapeHtml(p.ageCategory || '—')} • One-of-one</div>
            </div>
            <button class="icon-btn" id="qvClose" type="button" aria-label="Close">
              <i class="fa-solid fa-xmark" aria-hidden="true"></i>
            </button>
          </div>

          <div class="ab-modal-body">
            <div class="qv-media">
              <img id="qvImg" src="${escapeHtml(imgs[0])}" alt="${escapeHtml(p.title)}">
              <div class="qv-thumbs">
                ${imgs.map((im, i) => `<button type="button" class="qv-thumb" data-idx="${i}" aria-label="View image ${i+1}"><img src="${escapeHtml(im)}" alt=""></button>`).join('')}
              </div>
            </div>

            <div class="qv-info">
              <div class="qv-price">${money(p.price)}</div>
              <div class="qv-desc">${escapeHtml(p.description)}</div>

              <div class="qv-bullets">
                <div class="qv-bullet"><i class="fa-solid fa-circle-check" aria-hidden="true"></i> Unique piece (only 1)</div>
                <div class="qv-bullet"><i class="fa-solid fa-lock" aria-hidden="true"></i> Secure Paystack checkout</div>
                <div class="qv-bullet"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i> PDF receipt saved to history</div>
              </div>

              <div class="qv-actions">
                <button type="button" class="btn ghost" id="qvWish">
                  <i class="${wished ? 'fa-solid' : 'fa-regular'} fa-heart" aria-hidden="true"></i>
                  ${wished ? 'Wishlisted' : 'Wishlist'}
                </button>

                <button type="button" class="btn primary" id="qvAdd" ${(!avail || inCart) ? 'disabled' : ''}>
                  <i class="fa-solid fa-bag-shopping" aria-hidden="true"></i>
                  ${sold ? 'Sold out' : (inCart ? 'In cart' : 'Add to cart')}
                </button>
              </div>

              <div class="qv-mini">
                ${sold ? 'This item has already been purchased.' : 'Tip: Add to cart quickly — items sell fast.'}
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

    modalRoot.style.display = 'block';
    setOverlay(true);
    lockBody(true);

    const backdrop = byId('qvBackdrop');
    const closeBtn = byId('qvClose');
    const wishBtn = byId('qvWish');
    const addBtn = byId('qvAdd');

    function close() {
      modalRoot.innerHTML = '';
      modalRoot.style.display = 'none';
      // If checkout or drawer is open, keep overlay; else remove
      const anyOpen = cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open') || (checkoutModal && checkoutModal.getAttribute('aria-hidden') === 'false');
      if (!anyOpen) {
        setOverlay(false);
        lockBody(false);
      }
      document.removeEventListener('keydown', onEsc);
    }

    function onEsc(e) { if (e.key === 'Escape') close(); }

    backdrop?.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'qvBackdrop') close();
    });
    closeBtn?.addEventListener('click', close);
    document.addEventListener('keydown', onEsc);

    // thumbs
    $$('.qv-thumb', modalRoot).forEach(btn => {
      btn.addEventListener('click', () => {
        const idx = parseInt(btn.dataset.idx || '0', 10);
        const img = imgs[idx] || imgs[0];
        const main = byId('qvImg');
        if (main) main.src = img;
      });
    });

    wishBtn?.addEventListener('click', () => {
      toggleWishlist(id);
      // refresh modal icon/text
      const nowW = state.wishlist.includes(id);
      wishBtn.innerHTML = `<i class="${nowW ? 'fa-solid' : 'fa-regular'} fa-heart" aria-hidden="true"></i> ${nowW ? 'Wishlisted' : 'Wishlist'}`;
    });

    addBtn?.addEventListener('click', () => {
      addToCart(id);
      renderCart();
      // disable button in modal after adding
      addBtn.setAttribute('disabled', 'true');
      addBtn.innerHTML = `<i class="fa-solid fa-check" aria-hidden="true"></i> In cart`;
    });

    closeBtn?.focus();
  }

  /* =========================
     CHECKOUT SUMMARY (modal)
  ========================= */
  function renderCheckoutSummary() {
    const host = byId('checkoutItems');
    if (!host) return;

    const items = cartItemsArray();
    if (!items.length) {
      host.innerHTML = `<div class="empty-state">No items in cart.</div>`;
    } else {
      host.innerHTML = items.map(p => `
        <div class="sum-item">
          <div class="sum-left">
            <div class="sum-title">${escapeHtml(p.title)}</div>
            <div class="sum-sub">${escapeHtml(p.id)} • Qty 1</div>
          </div>
          <div class="sum-right"><strong>${money(p.price)}</strong></div>
        </div>
      `).join('');
    }

    const totals = calcTotals(items);
    byId('checkoutSubtotal') && (byId('checkoutSubtotal').textContent = money(totals.sub));
    byId('checkoutFee') && (byId('checkoutFee').textContent = money(totals.fee));
    byId('checkoutTotal') && (byId('checkoutTotal').textContent = money(totals.total));
    byId('checkoutDelivery') && (byId('checkoutDelivery').textContent = 'To be arranged');
  }

  /* =========================
     HISTORY
  ========================= */
  function saveHistory() {
    saveJSON(LS_KEYS.history, state.history);
    updateBadges();
  }
  function saveSold() {
    saveJSON(LS_KEYS.sold, state.sold);
  }

  function renderHistory() {
    const host = byId('historyList');
    if (!host) return;

    if (!state.history.length) {
      host.innerHTML = `
        <div class="empty-history">
          <div class="empty-title">No purchases yet</div>
          <div class="empty-sub">After you checkout, your receipts and items will appear here.</div>
        </div>
      `;
      return;
    }

    host.innerHTML = state.history.map((h, idx) => {
      const dt = new Date(h.createdAt).toLocaleString();
      const itemCount = h.items?.length || 0;
      return `
        <div class="history-card" data-idx="${idx}">
          <div class="hc-top">
            <div class="hc-title">Order <span class="mono">${escapeHtml(h.orderId)}</span></div>
            <div class="hc-meta">${escapeHtml(dt)} • ${itemCount} item${itemCount === 1 ? '' : 's'}</div>
          </div>

          <div class="hc-items">
            ${(h.items || []).slice(0, 3).map(it => `
              <div class="hc-item">
                <span>${escapeHtml(it.title)}</span>
                <strong>${money(it.price)}</strong>
              </div>
            `).join('')}
            ${(itemCount > 3) ? `<div class="hc-more">+${itemCount - 3} more</div>` : ``}
          </div>

          <div class="hc-bottom">
            <div class="hc-total"><span>Total</span> <strong>${money(h.totalCharged)}</strong></div>
            <div class="hc-actions">
              <button type="button" class="btn ghost" data-action="details"><i class="fa-solid fa-eye" aria-hidden="true"></i> Details</button>
              <button type="button" class="btn ghost" data-action="pdf"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i> PDF</button>
              <button type="button" class="btn ghost" data-action="copy"><i class="fa-solid fa-copy" aria-hidden="true"></i> Copy</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function historyReceiptText(h) {
    const lines = [];
    lines.push(`${CONFIG.brand} — Receipt`);
    lines.push('----------------------------------------');
    lines.push(`Order ID: ${h.orderId}`);
    lines.push(`Payment reference: ${h.payRef}`);
    lines.push(`Date: ${new Date(h.createdAt).toLocaleString()}`);
    lines.push('');
    lines.push('Customer');
    lines.push(`Name: ${h.buyer?.name || ''}`);
    lines.push(`Phone: ${h.buyer?.phone || ''}`);
    lines.push(`Email: ${h.buyer?.email || ''}`);
    lines.push(`Delivery method: ${h.buyer?.method || 'delivery'}`);
    lines.push(`Address: ${h.buyer?.address || ''}`);
    lines.push('');
    lines.push('Items');
    (h.items || []).forEach((it, i) => {
      lines.push(`${i+1}. ${it.title} (${it.id}) — ${money(it.price)} — Qty 1`);
    });
    lines.push('');
    lines.push(`Subtotal: ${money(h.subtotal)}`);
    lines.push(`Processing fee: ${money(h.processingFee)}`);
    lines.push(`Delivery: To be arranged`);
    lines.push(`Total charged: ${money(h.totalCharged)}`);
    lines.push('');
    lines.push('Note: Delivery charges (if any) will be communicated after payment.');
    return lines.join('\n');
  }

  function copyToClipboard(text) {
    return navigator.clipboard?.writeText(text)
      .then(() => true)
      .catch(() => false);
  }

  /* =========================
     PDF GENERATION (jsPDF)
  ========================= */
  function ensureJsPDF() {
    return window.jspdf && window.jspdf.jsPDF;
  }

  function downloadReceiptPDF(h) {
    if (!ensureJsPDF()) {
      alert('PDF generator not loaded (jsPDF). Add jsPDF in your <head>.');
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });

    const pageW = doc.internal.pageSize.getWidth();
    let y = 48;

    // Banner
    doc.setFillColor(20, 20, 24);
    doc.rect(0, 18, pageW, 50, 'F');
    doc.setTextColor(255,255,255);
    doc.setFontSize(18);
    doc.setFont(undefined, 'bold');
    doc.text(`${CONFIG.brand}    Receipt`, pageW/2, 50, { align:'center' });

    doc.setTextColor(35,35,38);
    doc.setFontSize(10);
    doc.setFont(undefined, 'normal');

    y = 92;
    doc.setTextColor(90,90,100);
    doc.text(`Order ID:`, 48, y);
    doc.setTextColor(35,35,38);
    doc.text(String(h.orderId), 110, y);

    y += 14;
    doc.setTextColor(90,90,100);
    doc.text(`Pay Ref:`, 48, y);
    doc.setTextColor(35,35,38);
    doc.text(String(h.payRef), 110, y);

    y += 14;
    doc.setTextColor(90,90,100);
    doc.text(`Date:`, 48, y);
    doc.setTextColor(35,35,38);
    doc.text(new Date(h.createdAt).toLocaleString(), 110, y);

    // Customer box
    y += 22;
    doc.setFillColor(248,248,249);
    doc.roundedRect(48, y, pageW-96, 86, 8, 8, 'F');
    doc.setTextColor(70,70,80);
    doc.setFont(undefined, 'bold');
    doc.text('Customer', 60, y + 18);

    doc.setFont(undefined, 'normal');
    doc.setTextColor(35,35,38);
    doc.text(`Name: ${h.buyer?.name || ''}`, 60, y + 36);
    doc.text(`Phone: ${h.buyer?.phone || ''}`, 60, y + 52);
    doc.text(`Email: ${h.buyer?.email || ''}`, 60, y + 68);

    y += 110;

    // Items header
    doc.setFillColor(240,240,242);
    doc.rect(48, y, pageW-96, 24, 'F');
    doc.setTextColor(70,70,80);
    doc.setFont(undefined, 'bold');
    doc.text('Item', 60, y + 16);
    doc.text('Price', pageW - 120, y + 16);

    y += 34;
    doc.setFont(undefined, 'normal');
    doc.setTextColor(35,35,38);

    (h.items || []).forEach((it) => {
      // Wrap item title if too long
      const title = `${it.title} (${it.id})`;
      const wrapped = doc.splitTextToSize(title, pageW - 220);
      doc.text(wrapped, 60, y);
      doc.text(money(it.price), pageW - 120, y, { align:'left' });
      y += (wrapped.length * 12) + 8;

      if (y > 680) {
        doc.addPage();
        y = 60;
      }
    });

    // Totals box
    y += 10;
    doc.setDrawColor(235,235,235);
    doc.roundedRect(48, y, pageW-96, 92, 8, 8, 'S');

    const rightX = pageW - 60;
    const labelX = pageW - 220;

    doc.setTextColor(90,90,100);
    doc.text('Subtotal', labelX, y + 24);
    doc.setTextColor(35,35,38);
    doc.setFont(undefined, 'bold');
    doc.text(money(h.subtotal), rightX, y + 24, { align:'right' });

    doc.setFont(undefined, 'normal');
    doc.setTextColor(90,90,100);
    doc.text('Processing fee', labelX, y + 44);
    doc.setTextColor(35,35,38);
    doc.setFont(undefined, 'bold');
    doc.text(money(h.processingFee), rightX, y + 44, { align:'right' });

    doc.setFont(undefined, 'normal');
    doc.setTextColor(90,90,100);
    doc.text('Delivery', labelX, y + 64);
    doc.setTextColor(35,35,38);
    doc.setFont(undefined, 'bold');
    doc.text('To be arranged', rightX, y + 64, { align:'right' });

    doc.setDrawColor(230,230,230);
    doc.line(labelX, y + 74, rightX, y + 74);

    doc.setFontSize(12);
    doc.setTextColor(20,20,24);
    doc.setFont(undefined, 'bold');
    doc.text('Total charged', labelX, y + 92);
    doc.text(money(h.totalCharged), rightX, y + 92, { align:'right' });

    // Footer note
    doc.setFontSize(9);
    doc.setFont(undefined, 'normal');
    doc.setTextColor(110,110,120);
    doc.text('Note: Delivery charges (if any) will be communicated after payment.', 48, 800);

    doc.save(`${CONFIG.brand.replace(/\s+/g,'')}_Receipt_${h.orderId}.pdf`);
  }

  /* =========================
     FORM SUBMISSION (Formspree)
  ========================= */
  async function postToFormspree(payload) {
    if (!CONFIG.formspreeEndpoint) return;
    try {
      await fetch(CONFIG.formspreeEndpoint, {
        method: 'POST',
        headers: { 'Accept':'application/json', 'Content-Type':'application/json' },
        body: JSON.stringify(payload),
        mode: 'cors'
      });
    } catch {
      // non-blocking
    }
  }

  /* =========================
     PAYSTACK CHECKOUT
  ========================= */
  function startPaystackPayment() {
    const items = cartItemsArray();
    if (!items.length) {
      toast('Your cart is empty.');
      return;
    }

    // Validate that items are still available (important!)
    const unavailable = items.find(p => !availableNow(p));
    if (unavailable) {
      toast(`"${unavailable.title}" is no longer available. Removing it from cart.`);
      removeFromCart(unavailable.id);
      return;
    }

    const name = (byId('fullName')?.value || '').trim();
    const phone = (byId('phoneNumber')?.value || '').trim();
    const email = (byId('emailAddress')?.value || '').trim();
    const addressEl = byId('deliveryAddress');
    const method = document.querySelector('input[name="deliveryMethod"]:checked')?.value || 'delivery';
    let address = (addressEl?.value || '').trim();

    if (!name) { alert('Please enter your full name.'); byId('fullName')?.focus(); return; }
    if (!phone) { alert('Please enter your phone number.'); byId('phoneNumber')?.focus(); return; }
    if (!email) { alert('Please enter your email address.'); byId('emailAddress')?.focus(); return; }
    if (!isValidEmail(email)) { alert('Please enter a valid email (e.g. name@gmail.com).'); byId('emailAddress')?.focus(); return; }

    if (method === 'pickup') {
      address = CONFIG.cartPickupAddress;
      if (addressEl) addressEl.value = address;
    } else {
      if (!address) { alert('Please enter your delivery address (delivery fee arranged after payment).'); addressEl?.focus(); return; }
    }

    if (typeof PaystackPop === 'undefined') {
      alert('Paystack not loaded. Add Paystack inline script in <head>.');
      return;
    }

    const totals = calcTotals(items);
    const orderId = uid('AB');
    const amountInPesewas = Math.round(totals.total * 100);

    const metadata = {
      custom_fields: [
        { display_name: 'Customer Name', variable_name: 'customer_name', value: name },
        { display_name: 'Phone', variable_name: 'phone', value: phone },
        { display_name: 'Delivery Method', variable_name: 'delivery_method', value: method },
        { display_name: 'Address', variable_name: 'address', value: address },
        { display_name: 'Items', variable_name: 'items', value: items.map(p => `${p.title} (${p.id})`).join(', ') },
        { display_name: 'Processing Fee', variable_name: 'processing_fee', value: totals.fee }
      ]
    };

    const handler = PaystackPop.setup({
      key: CONFIG.paystackPublicKey,
      email: email,                  // IMPORTANT: Paystack receipt goes here
      amount: amountInPesewas,
      currency: CONFIG.currency,
      ref: orderId,
      metadata,
      onClose: function() {
        toast('Payment window closed.');
      },
      callback: function(response) {
        const payRef = response.reference || orderId;

        // Mark items as sold (one-of-one)
        items.forEach(p => {
          if (!state.sold.includes(p.id)) state.sold.unshift(p.id);
        });
        saveSold();

        // Build history record
        const purchase = {
          orderId,
          payRef,
          createdAt: new Date().toISOString(),
          buyer: { name, phone, email, method, address },
          items: items.map(p => ({ id:p.id, title:p.title, price:Number(p.price), ageCategory:p.ageCategory })),
          subtotal: totals.sub,
          processingFee: totals.fee,
          totalCharged: totals.total
        };

        // Save to history (newest first)
        state.history.unshift(purchase);
        saveHistory();

        // Clear cart after purchase
        clearCart();
        renderHistory();
        renderProducts();
        renderCheckoutSummary();
        renderCart();
        updateBadges();

        // Send to Formspree (best effort)
        postToFormspree({
          type: 'purchase',
          brand: CONFIG.brand,
          order_id: purchase.orderId,
          payment_reference: purchase.payRef,
          buyer_name: name,
          buyer_email: email,
          phone,
          delivery_method: method,
          address,
          currency: CONFIG.currency,
          subtotal: purchase.subtotal,
          processing_fee: purchase.processingFee,
          total_charged: purchase.totalCharged,
          items: purchase.items,
          message: historyReceiptText(purchase),
          timestamp: purchase.createdAt
        });

        // Close checkout + show success modal
        closeCheckout();
        closeDrawer(cartDrawer);

        showSuccessModal(purchase);
        toast('Payment successful! Receipt saved to history.');
      }
    });

    handler.openIframe();
  }

  /* =========================
     SUCCESS MODAL (with receipt actions)
  ========================= */
  function showSuccessModal(purchase) {
    if (!modalRoot) return;

    modalRoot.innerHTML = `
      <div class="ab-modal-backdrop" id="successBackdrop" role="dialog" aria-modal="true" aria-label="Payment successful">
        <div class="ab-modal ab-success">
          <div class="ab-modal-head">
            <div class="ab-modal-title">
              <div class="ab-modal-h">Payment Successful</div>
              <div class="ab-modal-sub">Thank you <strong>${escapeHtml(purchase.buyer?.name || '')}</strong> — your order is confirmed.</div>
            </div>
            <button class="icon-btn" id="successClose" type="button" aria-label="Close">
              <i class="fa-solid fa-xmark" aria-hidden="true"></i>
            </button>
          </div>

          <div class="ab-modal-body">
            <div class="succ-grid">
              <div class="succ-col">
                <div class="succ-title">Order</div>
                <div class="succ-row"><span>Order ID</span><strong class="mono">${escapeHtml(purchase.orderId)}</strong></div>
                <div class="succ-row"><span>Pay Ref</span><strong class="mono">${escapeHtml(purchase.payRef)}</strong></div>
                <div class="succ-row"><span>Date</span><strong>${escapeHtml(new Date(purchase.createdAt).toLocaleString())}</strong></div>
              </div>

              <div class="succ-col">
                <div class="succ-title">Customer</div>
                <div class="succ-row"><span>Email</span><strong>${escapeHtml(purchase.buyer?.email || '')}</strong></div>
                <div class="succ-row"><span>Phone</span><strong>${escapeHtml(purchase.buyer?.phone || '')}</strong></div>
                <div class="succ-row"><span>Delivery</span><strong>${escapeHtml(purchase.buyer?.method || 'delivery')}</strong></div>
              </div>
            </div>

            <div class="succ-items">
              ${(purchase.items || []).map(it => `
                <div class="succ-item">
                  <div>
                    <div class="succ-item-title">${escapeHtml(it.title)}</div>
                    <div class="succ-item-sub">${escapeHtml(it.id)} • Qty 1</div>
                  </div>
                  <strong>${money(it.price)}</strong>
                </div>
              `).join('')}
            </div>

            <div class="succ-totals">
              <div class="line"><span>Subtotal</span><strong>${money(purchase.subtotal)}</strong></div>
              <div class="line"><span>Processing fee</span><strong>${money(purchase.processingFee)}</strong></div>
              <div class="line"><span>Delivery</span><strong>To be arranged</strong></div>
              <div class="line total"><span>Total charged</span><strong>${money(purchase.totalCharged)}</strong></div>
            </div>
          </div>

          <div class="ab-modal-foot">
            <button type="button" class="btn primary" id="successPdf"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i> Download PDF</button>
            <button type="button" class="btn ghost" id="successCopy"><i class="fa-solid fa-copy" aria-hidden="true"></i> Copy receipt</button>
            <button type="button" class="btn ghost" id="successHistory"><i class="fa-solid fa-clock-rotate-left" aria-hidden="true"></i> View history</button>
            <button type="button" class="btn ghost" id="successOk"><i class="fa-solid fa-check" aria-hidden="true"></i> Done</button>
          </div>
        </div>
      </div>
    `;

    modalRoot.style.display = 'block';
    setOverlay(true);
    lockBody(true);

    const backdrop = byId('successBackdrop');
    const closeBtn = byId('successClose');
    const okBtn = byId('successOk');
    const pdfBtn = byId('successPdf');
    const copyBtn = byId('successCopy');
    const histBtn = byId('successHistory');

    function close() {
      modalRoot.innerHTML = '';
      modalRoot.style.display = 'none';
      // if drawers or checkout open, keep overlay; otherwise remove
      const anyOpen = cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open') || (checkoutModal && checkoutModal.getAttribute('aria-hidden') === 'false');
      if (!anyOpen) {
        setOverlay(false);
        lockBody(false);
      }
      document.removeEventListener('keydown', onEsc);
    }
    function onEsc(e) { if (e.key === 'Escape') close(); }

    backdrop?.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'successBackdrop') close();
    });

    closeBtn?.addEventListener('click', close);
    okBtn?.addEventListener('click', close);
    document.addEventListener('keydown', onEsc);

    pdfBtn?.addEventListener('click', () => downloadReceiptPDF(purchase));
    copyBtn?.addEventListener('click', async () => {
      const ok = await copyToClipboard(historyReceiptText(purchase));
      ok ? toast('Receipt copied.') : alert('Could not copy. Try downloading PDF.');
    });
    histBtn?.addEventListener('click', () => {
      close();
      openDrawer(historyDrawer);
      renderHistory();
    });

    closeBtn?.focus();
  }

  /* =========================
     HERO SLIDER
  ========================= */
  function heroSlides() {
    return $$('.hero-slide', byId('heroSlider') || document);
  }

  function setHeroSlide(n) {
    const slides = heroSlides();
    if (!slides.length) return;

    const max = slides.length;
    const idx = clamp(n, 1, max);
    state.ui.heroIndex = idx;

    slides.forEach(s => s.classList.remove('is-active'));
    const active = slides[idx - 1];
    if (active) active.classList.add('is-active');

    $$('.dot').forEach(d => d.classList.remove('is-active'));
    const dot = $(`.dot[data-go="${idx}"]`);
    if (dot) dot.classList.add('is-active');
  }

  function heroNext() {
    const slides = heroSlides();
    if (!slides.length) return;
    setHeroSlide((state.ui.heroIndex % slides.length) + 1);
  }

  function heroPrev() {
    const slides = heroSlides();
    if (!slides.length) return;
    const next = state.ui.heroIndex - 1;
    setHeroSlide(next < 1 ? slides.length : next);
  }

  function startHeroAutoplay() {
    stopHeroAutoplay();
    state.ui.heroTimer = setInterval(() => {
      if (document.hidden) return;
      heroNext();
    }, CONFIG.heroAutoplayMs);
  }

  function stopHeroAutoplay() {
    if (state.ui.heroTimer) clearInterval(state.ui.heroTimer);
    state.ui.heroTimer = null;
  }

  /* =========================
     BACK TO TOP + PROGRESS
  ========================= */
  function updateScrollUI() {
    const btn = byId('backToTopBtn');
    const topProgress = byId('topProgress');

    const y = window.scrollY || document.documentElement.scrollTop || 0;
    const h = document.documentElement.scrollHeight - window.innerHeight;
    const p = h > 0 ? (y / h) : 0;

    if (topProgress) topProgress.style.transform = `scaleX(${p})`;

    if (btn) {
      if (y > window.innerHeight * 0.9) btn.classList.add('show');
      else btn.classList.remove('show');
    }
  }

  /* =========================
     THEME + SHARE + COPY
  ========================= */
  function applyTheme(theme) {
    // You’ll style later. For now we attach attribute for CSS.
    document.documentElement.setAttribute('data-theme', theme);
    saveJSON(LS_KEYS.theme, theme);
  }

  function initTheme() {
    const saved = loadJSON(LS_KEYS.theme, null);
    if (saved) {
      applyTheme(saved);
    } else {
      // default: light
      applyTheme('light');
    }
  }

  async function shareShop() {
    const data = { title: CONFIG.brand, text: 'Shop one-of-a-kind kidswear', url: location.href };
    if (navigator.share) {
      try { await navigator.share(data); } catch {}
    } else {
      const ok = await copyToClipboard(location.href);
      ok ? toast('Link copied.') : alert('Could not copy link.');
    }
  }

  /* =========================
     EVENTS WIRING
  ========================= */
  function wireHeaderActions() {
    byId('cartBtn')?.addEventListener('click', () => {
      openDrawer(cartDrawer);
      renderCart();
    });
    byId('closeCartBtn')?.addEventListener('click', () => closeDrawer(cartDrawer));

    byId('historyBtn')?.addEventListener('click', () => {
      openDrawer(historyDrawer);
      renderHistory();
    });
    byId('closeHistoryBtn')?.addEventListener('click', () => closeDrawer(historyDrawer));

    overlay?.addEventListener('click', () => closeAllOverlays());

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeAllOverlays();
    });

    // Search
    const searchInput = byId('searchInput');
    searchInput?.addEventListener('input', () => {
      state.ui.search = searchInput.value || '';
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
    });

    byId('clearSearchBtn')?.addEventListener('click', () => {
      if (searchInput) searchInput.value = '';
      state.ui.search = '';
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
    });

    // Sort
    const sort = byId('sortSelect');
    sort?.addEventListener('change', () => {
      state.ui.sort = sort.value || 'newest';
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
    });

    // Filters chips
    $$('.chip').forEach(chip => {
      chip.addEventListener('click', () => {
        $$('.chip').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        state.ui.filter = chip.dataset.filter || 'all';
        state.ui.visibleCount = CONFIG.initialVisible;
        renderProducts();
      });
    });

    // In-stock only
    byId('inStockOnlyBtn')?.addEventListener('click', () => {
      state.ui.inStockOnly = !state.ui.inStockOnly;
      byId('inStockOnlyBtn').setAttribute('aria-pressed', String(state.ui.inStockOnly));
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
    });

    // Clear filters
    byId('clearFiltersBtn')?.addEventListener('click', () => {
      state.ui.filter = 'all';
      state.ui.inStockOnly = false;
      state.ui.search = '';
      state.ui.sort = 'newest';
      if (searchInput) searchInput.value = '';
      if (sort) sort.value = 'newest';
      byId('inStockOnlyBtn')?.setAttribute('aria-pressed', 'false');
      $$('.chip').forEach(c => c.classList.remove('active'));
      $$('.chip')[0]?.classList.add('active');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      toast('Filters cleared.');
    });
  }

  function wireHero() {
    byId('heroNext')?.addEventListener('click', () => { heroNext(); startHeroAutoplay(); });
    byId('heroPrev')?.addEventListener('click', () => { heroPrev(); startHeroAutoplay(); });

    $$('.dot').forEach(dot => {
      dot.addEventListener('click', () => {
        const go = parseInt(dot.dataset.go || '1', 10);
        setHeroSlide(go);
        startHeroAutoplay();
      });
    });

    // nice CTA hooks
    byId('openCartFromHero')?.addEventListener('click', () => { openDrawer(cartDrawer); renderCart(); });
    byId('shopNowBtn')?.addEventListener('click', () => {});
    byId('viewNewArrivalsBtn')?.addEventListener('click', () => {
      state.ui.filter = 'new';
      $$('.chip').forEach(c => c.classList.remove('active'));
      $(`.chip[data-filter="new"]`)?.classList.add('active');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
    });
    byId('howItWorksBtn')?.addEventListener('click', () => {
      toast('How it works: Each listing is unique (qty 1). Add to cart → checkout → Paystack → receipt saved.');
    });

    const slider = byId('heroSlider');
    slider?.addEventListener('mouseenter', stopHeroAutoplay);
    slider?.addEventListener('mouseleave', startHeroAutoplay);
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) stopHeroAutoplay();
      else startHeroAutoplay();
    });

    setHeroSlide(1);
    startHeroAutoplay();
  }

  function wireShopButtons() {
    byId('showMoreBtn')?.addEventListener('click', () => {
      state.ui.visibleCount = 999; // show all
      renderProducts();
      toast('Showing all items.');
    });

    byId('showLessBtn')?.addEventListener('click', () => {
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth', block:'start' });
      toast('Showing first 12 items.');
    });

    // Delegated click for product cards
    byId('productGrid')?.addEventListener('click', (e) => {
      const card = e.target.closest('.product-card');
      if (!card) return;
      const id = card.dataset.id;
      const actionBtn = e.target.closest('[data-action]');
      if (!actionBtn) return;
      const action = actionBtn.dataset.action;

      if (action === 'addToCart') addToCart(id);
      if (action === 'quickView') openQuickView(id);
      if (action === 'toggleWish') toggleWishlist(id);
    });
  }

  function wireCartDrawer() {
    byId('checkoutBtn')?.addEventListener('click', () => {
      renderCheckoutSummary();
      openCheckout();
    });

    byId('clearCartBtn')?.addEventListener('click', () => {
      if (!cartCount()) return;
      if (confirm('Clear all items from cart?')) clearCart();
    });

    byId('cartItems')?.addEventListener('click', (e) => {
      const row = e.target.closest('.cart-item');
      if (!row) return;
      const id = row.dataset.id;
      const btn = e.target.closest('[data-action]');
      if (!btn) return;

      const action = btn.dataset.action;
      if (action === 'remove') removeFromCart(id);
      if (action === 'quickView') openQuickView(id, 'cart');
      if (action === 'saveForLater') {
        toggleWishlist(id);
        toast('Saved to wishlist.');
      }
    });
  }

  function wireCheckoutModal() {
    byId('closeCheckoutBtn')?.addEventListener('click', closeCheckout);
    byId('cancelCheckoutBtn')?.addEventListener('click', closeCheckout);

    // auto address behavior for pickup
    $$('input[name="deliveryMethod"]').forEach(r => {
      r.addEventListener('change', () => {
        const method = document.querySelector('input[name="deliveryMethod"]:checked')?.value || 'delivery';
        const addr = byId('deliveryAddress');
        if (method === 'pickup') {
          if (addr) addr.value = CONFIG.cartPickupAddress;
          toast('Pickup selected.');
        } else {
          if (addr && addr.value === CONFIG.cartPickupAddress) addr.value = '';
          toast('Delivery selected.');
        }
      });
    });

    byId('payNowBtn')?.addEventListener('click', startPaystackPayment);

    // close when clicking backdrop area
    checkoutModal?.addEventListener('click', (e) => {
      if (e.target === checkoutModal) closeCheckout();
    });
  }

  function wireHistoryDrawer() {
    byId('historyList')?.addEventListener('click', async (e) => {
      const card = e.target.closest('.history-card');
      if (!card) return;
      const idx = parseInt(card.dataset.idx || '0', 10);
      const h = state.history[idx];
      if (!h) return;

      const btn = e.target.closest('[data-action]');
      if (!btn) return;
      const action = btn.dataset.action;

      if (action === 'pdf') downloadReceiptPDF(h);
      if (action === 'copy') {
        const ok = await copyToClipboard(historyReceiptText(h));
        ok ? toast('Receipt copied.') : alert('Copy failed. Download PDF instead.');
      }
      if (action === 'details') showHistoryDetailsModal(h);
    });

    byId('clearHistoryBtn')?.addEventListener('click', () => {
      if (!state.history.length) return;
      if (!confirm('Clear purchase history on this device?')) return;
      state.history = [];
      saveHistory();
      renderHistory();
      updateBadges();
      toast('History cleared.');
    });

    byId('exportHistoryBtn')?.addEventListener('click', async () => {
      if (!state.history.length) { toast('No history to export.'); return; }
      const data = JSON.stringify(state.history, null, 2);
      const ok = await copyToClipboard(data);
      ok ? toast('History JSON copied to clipboard.') : alert('Could not copy. Try on a different browser.');
    });
  }

  function showHistoryDetailsModal(h) {
    if (!modalRoot) return;
    modalRoot.innerHTML = `
      <div class="ab-modal-backdrop" id="histBackdrop" role="dialog" aria-modal="true" aria-label="Purchase details">
        <div class="ab-modal">
          <div class="ab-modal-head">
            <div class="ab-modal-title">
              <div class="ab-modal-h">Purchase Details</div>
              <div class="ab-modal-sub">Order <span class="mono">${escapeHtml(h.orderId)}</span></div>
            </div>
            <button class="icon-btn" id="histClose" type="button" aria-label="Close">
              <i class="fa-solid fa-xmark" aria-hidden="true"></i>
            </button>
          </div>

          <div class="ab-modal-body">
            <pre class="receipt-pre">${escapeHtml(historyReceiptText(h))}</pre>
          </div>

          <div class="ab-modal-foot">
            <button type="button" class="btn primary" id="histPdf"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i> PDF</button>
            <button type="button" class="btn ghost" id="histCopy"><i class="fa-solid fa-copy" aria-hidden="true"></i> Copy</button>
            <button type="button" class="btn ghost" id="histOk"><i class="fa-solid fa-check" aria-hidden="true"></i> Close</button>
          </div>
        </div>
      </div>
    `;
    modalRoot.style.display = 'block';
    setOverlay(true);
    lockBody(true);

    const backdrop = byId('histBackdrop');
    const closeBtn = byId('histClose');
    const okBtn = byId('histOk');

    function close() {
      modalRoot.innerHTML = '';
      modalRoot.style.display = 'none';
      // keep overlay if drawer open
      const anyOpen = cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open') || (checkoutModal && checkoutModal.getAttribute('aria-hidden') === 'false');
      if (!anyOpen) {
        setOverlay(false);
        lockBody(false);
      }
      document.removeEventListener('keydown', onEsc);
    }
    function onEsc(e) { if (e.key === 'Escape') close(); }

    backdrop?.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'histBackdrop') close();
    });
    closeBtn?.addEventListener('click', close);
    okBtn?.addEventListener('click', close);
    document.addEventListener('keydown', onEsc);

    byId('histPdf')?.addEventListener('click', () => downloadReceiptPDF(h));
    byId('histCopy')?.addEventListener('click', async () => {
      const ok = await copyToClipboard(historyReceiptText(h));
      ok ? toast('Copied.') : alert('Copy failed. Try PDF.');
    });

    closeBtn?.focus();
  }

  function wireFooterExtras() {
    byId('copyShopLinkBtn')?.addEventListener('click', async () => {
      const ok = await copyToClipboard(location.href);
      ok ? toast('Shop link copied.') : alert('Could not copy link.');
    });
    byId('shareShopBtn')?.addEventListener('click', shareShop);

    byId('themeToggleBtn')?.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme') || 'light';
      applyTheme(cur === 'light' ? 'dark' : 'light');
      toast('Theme toggled.');
    });

    // Footer quick filters
    byId('footerNewArrivals')?.addEventListener('click', () => {
      state.ui.filter = 'new';
      $$('.chip').forEach(c => c.classList.remove('active'));
      $(`.chip[data-filter="new"]`)?.classList.add('active');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
    });

    byId('footerUnder40')?.addEventListener('click', () => {
      state.ui.filter = 'under40';
      $$('.chip').forEach(c => c.classList.remove('active'));
      $(`.chip[data-filter="under40"]`)?.classList.add('active');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
    });

    byId('footerPremium')?.addEventListener('click', () => {
      state.ui.filter = 'premium';
      $$('.chip').forEach(c => c.classList.remove('active'));
      $(`.chip[data-filter="premium"]`)?.classList.add('active');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
    });

    byId('footerInStock')?.addEventListener('click', () => {
      state.ui.filter = 'available';
      $$('.chip').forEach(c => c.classList.remove('active'));
      $(`.chip[data-filter="available"]`)?.classList.add('active');
      state.ui.inStockOnly = true;
      byId('inStockOnlyBtn')?.setAttribute('aria-pressed', 'true');
      state.ui.visibleCount = CONFIG.initialVisible;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
    });

    byId('openCartFooter')?.addEventListener('click', () => { openDrawer(cartDrawer); renderCart(); });
    byId('openHistoryFooter')?.addEventListener('click', () => { openDrawer(historyDrawer); renderHistory(); });
    byId('openWishlistFooter')?.addEventListener('click', () => {
      if (!state.wishlist.length) { toast('Wishlist is empty.'); return; }
      // Show wishlist items quickly via filter/search
      state.ui.search = '';
      const first = state.wishlist[0];
      const p = productById.get(first);
      if (p) {
        state.ui.search = p.title.split(' ')[0];
        const si = byId('searchInput');
        if (si) si.value = state.ui.search;
      }
      state.ui.visibleCount = 999;
      renderProducts();
      document.querySelector('#shop')?.scrollIntoView({ behavior:'smooth' });
      toast('Showing wishlist-related items.');
    });

    // Policies/FAQ/Terms/Privacy placeholders (to be styled later)
    const placeholder = (title, text) => {
      if (!modalRoot) return;
      modalRoot.innerHTML = `
        <div class="ab-modal-backdrop" id="pBackdrop" role="dialog" aria-modal="true" aria-label="${escapeHtml(title)}">
          <div class="ab-modal">
            <div class="ab-modal-head">
              <div class="ab-modal-title">
                <div class="ab-modal-h">${escapeHtml(title)}</div>
                <div class="ab-modal-sub">${CONFIG.brand}</div>
              </div>
              <button class="icon-btn" id="pClose" type="button" aria-label="Close">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
              </button>
            </div>
            <div class="ab-modal-body">
              <div style="line-height:1.6">${escapeHtml(text)}</div>
            </div>
            <div class="ab-modal-foot">
              <button type="button" class="btn primary" id="pOk"><i class="fa-solid fa-check" aria-hidden="true"></i> OK</button>
            </div>
          </div>
        </div>
      `;
      modalRoot.style.display = 'block';
      setOverlay(true);
      lockBody(true);

      const close = () => {
        modalRoot.innerHTML = '';
        modalRoot.style.display = 'none';
        // keep overlay if drawer open
        const anyOpen = cartDrawer?.classList.contains('open') || historyDrawer?.classList.contains('open') || (checkoutModal && checkoutModal.getAttribute('aria-hidden') === 'false');
        if (!anyOpen) { setOverlay(false); lockBody(false); }
      };
      byId('pClose')?.addEventListener('click', close);
      byId('pOk')?.addEventListener('click', close);
      byId('pBackdrop')?.addEventListener('click', (e) => { if (e.target.id === 'pBackdrop') close(); });
    };

    byId('openPoliciesBtn')?.addEventListener('click', () => placeholder(
      'Store Policies',
      'All items are one-of-one. Adding to cart does not guarantee availability until payment is completed. Delivery fees (if any) are arranged after payment. Receipts are issued via Paystack and saved locally in your purchase history.'
    ));
    byId('openFaqBtn')?.addEventListener('click', () => placeholder(
      'FAQ',
      'Q: Can I choose sizes? A: No — each listing is a single unique item. Q: Do you deliver? A: Yes, delivery charges are communicated after payment. Q: Will I get a receipt? A: Yes — Paystack email receipt + downloadable PDF.'
    ));
    byId('openTermsBtn')?.addEventListener('click', () => placeholder(
      'Terms',
      'By purchasing, you confirm your details are correct and accept that each item is unique and may sell quickly. Delivery fees are not included in checkout total and may be arranged after payment.'
    ));
    byId('openPrivacyBtn')?.addEventListener('click', () => placeholder(
      'Privacy',
      'Your purchase history is stored locally on your device for convenience. We send order details to our inbox via Formspree for fulfillment. Payment is processed securely by Paystack.'
    ));

    // Newsletter (send to Formspree)
    byId('newsletterForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = (byId('newsletterEmail')?.value || '').trim();
      if (!email) return toast('Enter your email.');
      if (!isValidEmail(email)) return toast('Enter a valid email.');

      await postToFormspree({
        type: 'newsletter',
        brand: CONFIG.brand,
        email,
        timestamp: new Date().toISOString()
      });

      byId('newsletterEmail').value = '';
      toast('Subscribed! You’ll get drop alerts.');
    });
  }

  function wireBackToTop() {
    byId('backToTopBtn')?.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    window.addEventListener('scroll', updateScrollUI, { passive:true });
    window.addEventListener('resize', updateScrollUI);
    updateScrollUI();
  }

  /* =========================
     GLOBAL CLICK ROUTES
  ========================= */
  function wireGlobalRoutes() {
    // quick open cart/history from footer buttons and hero
    // already wired, but we ensure smooth.
  }

  /* =========================
     INIT
  ========================= */
  function initSoldFromHistorySafety() {
    // Safety: if history exists, ensure sold includes those item ids
    const ids = new Set(state.sold);
    state.history.forEach(h => (h.items || []).forEach(it => ids.add(it.id)));
    state.sold = Array.from(ids);
    saveSold();
  }

  function initMetrics() {
    // update hero metrics if present
    const total = byId('metricTotal');
    const unique = byId('metricUnique');
    const fast = byId('metricFast');
    if (total) total.textContent = String(PRODUCTS.length);
    if (unique) unique.textContent = '100%';
    if (fast) fast.textContent = 'Instant';
  }

  function initialRender() {
    updateBadges();
    renderProducts();
    renderCart();
    renderCheckoutSummary();
    renderHistory();
    initMetrics();
  }

  function wireEverything() {
    wireHeaderActions();
    wireHero();
    wireShopButtons();
    wireCartDrawer();
    wireCheckoutModal();
    wireHistoryDrawer();
    wireFooterExtras();
    wireBackToTop();
    wireGlobalRoutes();

    // Overlay: ensure hidden by default if you didn't set CSS yet
    if (overlay) overlay.style.display = 'none';
    if (checkoutModal) checkoutModal.style.display = 'none';

    // Cart/History exports in UI need updates
    updateBadges();
  }

  // Ensure Paystack/jsPDF presence warnings (non-blocking)
  function warnLibraries() {
    if (typeof PaystackPop === 'undefined') console.warn('Paystack inline.js not found. Add <script src="https://js.paystack.co/v1/inline.js"></script> in <head>.');
    if (!ensureJsPDF()) console.warn('jsPDF not found. Add jsPDF UMD in <head>.');
  }

  // Page boot
  document.addEventListener('DOMContentLoaded', () => {
    initTheme();
    initSoldFromHistorySafety();
    initialRender();
    wireEverything();
    warnLibraries();

    // Set year
    const y = byId('yearNow');
    if (y) y.textContent = String(new Date().getFullYear());

    // Nice: default sort newest in select
    const sort = byId('sortSelect');
    if (sort) sort.value = state.ui.sort || 'newest';
  });

})();
</script>

</html>
