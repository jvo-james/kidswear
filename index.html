<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kids Wear — One-off Dresses</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Lexend:wght@600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4Q5GR0GCN9"></script>
  <!-- Paystack inline -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- STYLE: full page styles (place inside <head> or a CSS file) -->

<!-- Firebase (compat) - add this near the top of <head> BEFORE your app script -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  // ---------- REPLACE with your Firebase config (copy from Firebase console) ----------
  const FIREBASE_CONFIG = {  
    apiKey: "AIzaSyDkMmXNchhrC_Mfhwvqy7iSGOl-MABroJw",
    authDomain: "kidswear-ad8ca.firebaseapp.com",
    databaseURL: "https://kidswear-ad8ca-default-rtdb.firebaseio.com",
    projectId: "kidswear-ad8ca",
    storageBucket: "kidswear-ad8ca.firebasestorage.app",
    messagingSenderId: "784273336752",
    appId: "1:784273336752:web:fc82385f63b3ef50d74e75",
    measurementId: "G-32FT2N7BGG"
  };
  if (!window.firebase || !firebase.apps) {
    console.error('Firebase SDK load issue?');
  }
  if (!firebase.apps.length) {
    firebase.initializeApp(FIREBASE_CONFIG);
  }
  const db = firebase.database();
  const auth = firebase.auth();
</script>


<style>

:root{
  --brand-1: #ff6b8a;        /* playful pink */
  --brand-2: #ffd166;        /* sunny yellow */
  --accent:   #6ee7b7;       /* mint accent */
  --bg:       #fffaf6;
  --muted:    #6b7280;
  --card:     #ffffff;
  --glass:    rgba(255,255,255,0.6);
  --shadow:   0 8px 24px rgba(23,23,23,0.08);
  --radius-lg: 18px;
  --radius-md: 12px;
  --radius-sm: 8px;
  --max-width: 1200px;
  --transition-fast: 180ms;
  --transition: 280ms;
  --elev: 0 10px 30px rgba(16,24,40,0.08);
  --focus: 0 0 0 4px rgba(110,231,183,0.18);
  --text: #0f172a;
  --success: #10b981;
}

/* quick reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg, #fffaf6 0%, #fff7f0 40%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
  scroll-behavior:smooth;
  -webkit-tap-highlight-color: transparent;
}

/* container helper */
.container{
  width:90%;
  max-width:var(--max-width);
  margin:0 auto;
}

/* simple utilities */
.sr-only{
  position:absolute!important;
  width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
}
.lead{font-size:1.05rem;color:var(--muted)}

/* -------------------------
   HEADER
   -------------------------*/
.site-header{
  position:sticky;
  top:0;
  z-index:60;
  backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.65));
  border-bottom: 1px solid rgba(15,23,42,0.04);
  box-shadow: 0 6px 18px rgba(18,24,36,0.03);
}
.header-inner{
  display:flex;
  align-items:center;
  gap:12px;
  height:72px;
  width:90%;
  max-width:var(--max-width);
  margin:0 auto;
  padding:8px 0;
}
.logo{
  display:flex;
  gap:10px;
  align-items:center;
  text-decoration:none;
  color:var(--text);
  font-weight:700;
  font-size:1.1rem;
}
.logo-ico{
  font-size:20px;
  color:var(--brand-1);
  transform:translateY(-1px);
  text-shadow: 0 2px 8px rgba(255,107,138,0.12);
}
.brand-name{letter-spacing:0.2px}
.main-nav{margin-left:16px;flex:1}
.main-nav .nav-list{
  display:flex;
  gap:12px;
  align-items:center;
  list-style:none;
  padding:0;margin:0;
}
.main-nav a{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 12px;
  border-radius:10px;
  color:var(--muted);
  text-decoration:none;
  font-weight:600;
  transition:all var(--transition);
}
.main-nav a:hover, .main-nav a:focus{
  color:var(--text);
  transform:translateY(-2px);
  background:linear-gradient(90deg, rgba(255,107,138,0.06), rgba(255,209,102,0.04));
}

.header-actions{
  display:flex;
  gap:8px;
  align-items:center;
}

/* icon buttons */
.icon-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border:0;
  background:transparent;
  padding:8px;
  border-radius:10px;
  cursor:pointer;
  color:var(--muted);
  transition:all var(--transition);
}
.icon-btn:focus{outline:none;box-shadow:var(--focus)}
.icon-btn:hover{transform:translateY(-3px); color:var(--text)}

/* badge */
.badge{
  display:inline-block;
  min-width:20px;
  background:var(--brand-1);
  color:#fff;
  padding:2px 6px;
  font-size:12px;
  border-radius:999px;
  margin-left:6px;
  vertical-align:middle;
  text-align:center;
}

/* hamburger mobile */
.hamburger{
  display:inline-flex;
  align-items:center;
  gap:8px;
  background:var(--card);
  border-radius:12px;
  border:1px solid rgba(15,23,42,0.04);
  padding:8px 10px;
}
.hamburger .fa-bars{font-size:18px}

/* MOBILE NAV */
.mobile-nav{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:14px;
  border-top:1px solid rgba(15,23,42,0.03);
  background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
  transform-origin:top;
  transition:all 220ms ease;
  overflow:hidden;
  max-height:0;
}
.mobile-nav.open{max-height:420px}
.mobile-nav ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
.mobile-nav a{padding:12px;border-radius:10px;text-decoration:none;color:var(--text);font-weight:600}
.mobile-nav-footer{margin-top:12px}

/* -------------------------
   HERO / SLIDER
   -------------------------*/
.hero{
  margin:18px auto;
  width:100%;
}
.hero-slider{
  position:relative;
  border-radius:var(--radius-lg);
  overflow:hidden;
  box-shadow:var(--elev);
  min-height:300px;
}
.slide{
  display:block;
  width:100%;
  height:100%;
  position:relative;
}
.slide-inner{
  display:grid;
  grid-template-columns: 1fr;
  align-items:center;
  min-height:320px;
}

/* hero image */
.hero-media img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  filter:contrast(1.02) saturate(1.05);
  transform:scale(1.02);
  transition:transform 6s ease;
}
.hero-slider .slide.active .hero-media img{ transform: scale(1); }

/* caption overlay */
.hero-caption{
  position:absolute;
  left:14px;
  bottom:18px;
  z-index:3;
  background:linear-gradient(90deg, rgba(255,255,255,0.92), rgba(255,255,255,0.72));
  padding:18px;
  border-radius:14px;
  width:calc(100% - 40px);
  max-width:560px;
  box-shadow:var(--shadow);
}
.hero-caption h1, .hero-caption h2{
  margin:0 0 6px 0;
  font-size:1.45rem;
  line-height:1.1;
  color:var(--text);
}
.hero-caption p{margin:0 0 12px 0;color:var(--muted)}
.hero-cta{display:flex;gap:10px;flex-wrap:wrap}

/* hero controls */
.hero-controls{
  position:absolute;
  right:12px;
  top:12px;
  display:flex;
  gap:10px;
  align-items:center;
  z-index:4;
}
.hero-prev, .hero-next{
  border:0;
  background:rgba(255,255,255,0.9);
  padding:8px 10px;
  border-radius:10px;
  cursor:pointer;
  box-shadow:0 6px 18px rgba(12,18,28,0.06);
}
.hero-dots{display:flex;gap:6px;margin-left:8px}
.hero-dots .dot{
  width:10px;height:10px;border-radius:999px;border:0;background:rgba(12,18,28,0.12);cursor:pointer;
}
.hero-dots .dot.active{background:linear-gradient(90deg,var(--brand-1),var(--brand-2))}

/* -------------------------
   CATEGORIES (CHIPS)
   -------------------------*/
.categories{margin:20px auto}
.section-title{display:flex;align-items:center;gap:8px;font-size:1.05rem;margin:6px 0 10px 0}
.category-chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  border:1px solid rgba(15,23,42,0.06);
  background:linear-gradient(180deg,white, rgba(255,255,255,0.92));
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  font-weight:600;
  display:inline-flex;
  align-items:center;
  gap:8px;
  transition:all var(--transition);
}
.chip:hover{transform:translateY(-3px)}
.chip.active{
  background:linear-gradient(90deg,var(--brand-1),var(--brand-2));
  color:white;
  box-shadow: 0 10px 30px rgba(255,107,138,0.12);
}

/* -------------------------
   SHOP / PRODUCT GRID
   -------------------------*/
.shop{margin:20px auto 36px}
.shop-header{display:flex;flex-direction:column;gap:12px;margin-bottom:8px}
.shop-header h2{margin:0;display:flex;align-items:center;gap:8px;font-size:1.15rem}
.shop-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.search-wrap{display:flex;gap:6px;align-items:center;border-radius:12px;padding:6px;background:var(--card);box-shadow:var(--shadow)}
.search-wrap input[type="search"]{
  border:0;padding:10px 8px;min-width:150px;border-radius:10px;outline:none;font-size:0.95rem;
}
.search-wrap .icon-btn{padding:8px 10px}
.sort-wrap select{
  padding:8px 10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);background:var(--card);
}

/* product grid */
.product-grid{
  display:grid;
  gap:12px;
  width:100%;
  margin-top:12px;
}

/* grid columns: mobile-first (1 column) */
.product-grid{grid-template-columns: 1fr}

/* product card */
.product-card{
  display:flex;
  flex-direction:column;
  background:var(--card);
  border-radius:14px;
  overflow:hidden;
  box-shadow:var(--shadow);
  transition:transform var(--transition), box-shadow var(--transition);
  border:1px solid rgba(15,23,42,0.03);
}
.product-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(16,24,40,0.06)}
.product-media{position:relative;padding-top:70%;overflow:hidden;background:linear-gradient(180deg,rgba(255,246,245,1),rgba(255,250,245,0.6))}
.product-media img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;display:block}
.product-media .quickview{
  position:absolute;right:8px;top:8px;background:rgba(255,255,255,0.9);border-radius:10px;padding:8px;border:0;cursor:pointer;box-shadow:0 6px 18px rgba(12,18,28,0.06)
}
.product-tag{
  position:absolute;left:8px;top:8px;background:linear-gradient(90deg,var(--brand-1),var(--brand-2));color:white;padding:6px 10px;border-radius:999px;font-weight:700;display:inline-flex;gap:8px;align-items:center;font-size:13px
}

.product-body{padding:12px 14px 16px;display:flex;flex-direction:column;gap:10px}
.product-title{font-size:1rem;margin:0;color:var(--text)}
.product-meta{margin:0;color:var(--muted);font-size:13px}
.product-bottom{display:flex;align-items:center;justify-content:space-between;gap:8px}
.price-wrap .price{font-weight:800;color:var(--brand-1)}
.card-actions{display:flex;align-items:center;gap:8px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--brand-1),var(--brand-2));color:white;font-weight:700;transition:transform var(--transition)}
.btn:hover{transform:translateY(-3px)}
.btn.tiny{padding:6px 8px;font-weight:700;border-radius:10px;font-size:0.92rem}
.btn.large{padding:12px 18px;font-size:1rem;border-radius:14px}
.btn.outline{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--text);font-weight:700}
.btn.accent{background:linear-gradient(90deg,var(--accent), #34d399);color:#083325}

/* sold-out style */
.product-card.sold-out{
  opacity:0.62;filter:grayscale(0.2);pointer-events:none;
}

/* load more */
.load-more-wrap{text-align:center;margin:18px 0}
.load-more-wrap .btn{background:linear-gradient(90deg,var(--brand-2),var(--brand-1));}

/* no results */
.no-results{padding:38px;text-align:center;color:var(--muted)}

/* -------------------------
   PRODUCT MODAL
   -------------------------*/
.modal{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(8,15,24,0.5);
  padding:20px;
  opacity:0;pointer-events:none;transition:opacity 220ms ease;
  z-index:120;
}
.modal.open{opacity:1;pointer-events:auto}
.modal-inner{
  width:100%;
  max-width:980px;
  background:linear-gradient(180deg,#fff,#fffefc);
  border-radius:18px;
  padding:16px;
  box-shadow:0 30px 60px rgba(10,20,30,0.2);
  position:relative;
}
.modal-close{position:absolute;right:14px;top:14px;border:0;background:transparent;padding:8px;border-radius:10px;cursor:pointer;color:var(--muted)}
.modal-grid{display:grid;grid-template-columns:1fr;gap:12px}
.modal-media{background:var(--card);border-radius:12px;padding:8px;display:flex;flex-direction:column;gap:8px}
#modal-gallery{min-height:260px;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center}
#modal-gallery img{max-width:100%;max-height:320px;object-fit:contain}
#modal-thumbs{display:flex;gap:8px;overflow:auto;padding:6px}
#modal-thumbs .thumb{height:64px;border-radius:8px;object-fit:cover;cursor:pointer;box-shadow:0 10px 30px rgba(16,24,40,0.06)}
.modal-info{padding:6px 6px 12px}
.modal-title{font-size:1.15rem;margin:0 0 6px 0}
.modal-price{font-weight:900;font-size:1.15rem;color:var(--brand-1);margin-bottom:8px}
.price-row{display:flex;gap:12px;align-items:center;margin-bottom:8px}
.availability{color:var(--success);font-weight:700;font-size:0.95rem}
.modal-desc{color:var(--muted);margin-bottom:12px}
.modal-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.modal-controls label{font-weight:700;font-size:0.9rem}
.modal-controls select, .modal-controls input[type="number"]{padding:8px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);min-width:120px}
.modal-cta{display:flex;gap:8px;margin-left:auto}

/* modal meta */
.modal-meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);margin-top:12px}

/* -------------------------
   CART PANEL (slide out)
   -------------------------*/
.cart-panel{
  position:fixed;
  right:0;
  top:0;
  height:100%;
  width:100%;
  max-width:420px;
  background:linear-gradient(180deg,#fff,#fffefc);
  box-shadow:-20px 0 60px rgba(10,20,30,0.16);
  transform:translateX(110%);
  transition:transform 260ms cubic-bezier(.2,.9,.2,1);
  z-index:110;
  display:flex;
  flex-direction:column;
}
.cart-panel.open{transform:translateX(0)}
.cart-header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid rgba(15,23,42,0.03)}
.cart-contents{padding:14px;flex:1;overflow:auto}
.cart-footer{padding:14px;border-top:1px solid rgba(15,23,42,0.03)}
.cart-item{display:flex;gap:12px;align-items:center;padding:8px;border-radius:10px;margin-bottom:10px;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.95));box-shadow:var(--shadow)}
.cart-item-thumb{width:68px;height:68px;border-radius:10px;object-fit:cover}
.cart-item-info{flex:1}
.cart-item-title{display:block;font-weight:800}
.cart-item-meta{display:block;color:var(--muted);font-size:13px}
.cart-item-actions{display:flex;gap:6px;align-items:center}
.cart-item-qty{width:68px;padding:6px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)}
.cart-item-remove{background:transparent;border:0;color:var(--muted);cursor:pointer}

/* -------------------------
   CONTACT / FORMS
   -------------------------*/
.contact{margin:28px auto 60px}
.contact-grid{display:grid;gap:16px}
.contact-card{padding:16px;border-radius:12px;background:linear-gradient(180deg,#fff,#fffefc);box-shadow:var(--shadow)}
.contact-list{list-style:none;padding:0;margin:8px 0 0 0;color:var(--muted)}
.contact-list li{display:flex;gap:8px;align-items:center;padding:6px 0}
.contact-form{background:linear-gradient(180deg,#fff,#fffefc);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
.contact-form .form-row{margin-bottom:10px}
.contact-form label{display:block;margin-bottom:6px;font-weight:700}
.contact-form input, .contact-form textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06)}
.form-actions{display:flex;gap:8px;justify-content:flex-end}

/* -------------------------
   ABOUT / FEATURES
   -------------------------*/
.features-grid{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.features-grid li{list-style:none;background:linear-gradient(180deg,#fff,#fffefc);padding:12px;border-radius:12px;box-shadow:var(--shadow);display:flex;gap:8px;align-items:center;font-weight:700;color:var(--muted)}

/* -------------------------
   FOOTER
   -------------------------*/
.site-footer{background:linear-gradient(180deg,#fffefc,#fff7f0);padding:24px 0;border-top:1px solid rgba(15,23,42,0.03)}
.footer-top{display:flex;gap:20px;flex-direction:column;padding-bottom:12px}
.footer-col{flex:1}
.footer-logo{display:inline-flex;gap:8px;align-items:center;text-decoration:none;color:var(--text);font-weight:800}
.socials a{display:inline-flex;margin-right:8px}
.newsletter-form{display:flex;gap:8px;margin-top:8px}
.newsletter-form input{padding:8px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);flex:1}
.footer-bottom{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px dashed rgba(15,23,42,0.03);gap:8px}

  /* Checkout modal specifics (stacked, polished) */
.checkout-modal { display:flex; align-items:center; justify-content:center; }
.checkout-modal .modal-inner { border-radius:18px; box-shadow:0 30px 60px rgba(10,20,30,0.22); }
.checkout-modal .checkout-item { display:flex; gap:10px; align-items:center; padding:8px; border-radius:10px; background:linear-gradient(180deg,#fff,#fffefc); box-shadow:var(--shadow); }
.checkout-modal .checkout-item img { width:64px; height:64px; object-fit:cover; border-radius:8px; }
.checkout-modal .checkout-item .meta { display:flex; flex-direction:column; gap:4px; }
.checkout-modal .checkout-item .meta .title { font-weight:800; }
.checkout-modal .checkout-item .meta .sub { color:var(--muted); font-size:13px; }
.checkout-modal .checkout-summary small { color:var(--muted); font-size:12px; }

  /* Ensure buynow modal matches checkout modal style */
#buynow-modal.checkout-modal .checkout-item { align-items:center; }
#buynow-modal .modal-inner { max-width:980px; }

  /* ---------- Compact mobile header: only logo + cart + hamburger ---------- */
@media (max-width: 720px) {

  /* tighten header height and spacing */
  .header-inner {
    height: 60px;
    padding: 6px 0;
    align-items: center;
    gap: 8px;
  }

  /* push logo to the left and icons to the right */
  .header-inner { display:flex; align-items:center; justify-content:space-between; }

  /* hide the desktop nav */
  .main-nav { display: none !important; }

  /* hide all header-actions children by default, show only cart & hamburger */
  .header-actions > * { display: none !important; }
  .header-actions { gap: 4px; }

  /* show cart + mobile toggle */
  .header-actions #cart-toggle,
  .header-actions #mobile-toggle,
  .header-actions .hamburger {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
  }

  /* make logo slightly smaller on phones */
  .site-logo { height:40px; }

  /* make the hamburger compact and visible */
  .hamburger{
    display:inline-flex !important;
    padding:8px;
    border-radius:10px;
  }

  /* ensure the mobile nav container is available but collapsed by max-height
     (we override inline display:none if present) */
  #mobile-nav { display: flex !important; }

  /* keep mobile-nav closed by default (max-height 0). When JS adds "open" it reveals */
  #mobile-nav { max-height: 0; overflow: hidden; transition: max-height 280ms ease; }
  #mobile-nav.open { max-height: 420px; }

  /* visually emphasize the cart icon */
  #cart-toggle { background: rgba(255,255,255,0.95); border-radius:10px; padding:8px; box-shadow: 0 6px 18px rgba(12,18,28,0.06); }
  #cart-toggle .badge { transform: translateY(-2px); }

  /* Reduce hero caption size a little so it doesn't crowd */
  .hero-caption { padding:12px; bottom:10px; left:10px; width:calc(100% - 20px); max-width:400px; }

  /* hide search field & large CTAs on mobile; keep layout neat */
  .search-wrap, .shop-controls .sort-wrap { display: none !important; }

  /* hide secondary header icons (search, etc.) that might remain */
  .icon-btn[aria-label="Search"], .header-actions .icon-btn:not(#cart-toggle) { display: none !important; }

  /* make product grid comfortable on narrow phones */
  .product-grid { gap:10px; grid-template-columns: 1fr; }

  /* reduce hero min-height on very small screens */
  .hero-slider { min-height: 220px; height: 45vh; }
}

/* optional: make the header compact also apply exactly at the breakpoint via a class
   (JS will toggle the 'compact-header' class for better control) */
.compact-header .main-nav { display: none !important; }
.compact-header .header-actions > * { display: none !important; }
.compact-header .header-actions #cart-toggle,
.compact-header .header-actions #mobile-toggle,
.compact-header .header-actions .hamburger { display:inline-flex !important; }
.compact-header .site-logo { height:40px; }

/* -------------------------
   TOAST
   -------------------------*/
.tiny-toast{
  position:fixed;left:50%;transform:translateX(-50%) translateY(6px);
  bottom:26px;
  background:rgba(20,20,20,0.92);
  color:white;padding:10px 16px;border-radius:999px;opacity:0;transition:all 220ms;z-index:999;
  box-shadow:0 8px 30px rgba(8,20,38,0.3);
}
.tiny-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  /* LOGO specifics */
.logo{display:flex;align-items:center;gap:12px;text-decoration:none}
.site-logo{
  display:block;
  height:46px;           /* desktop size */
  width:auto;
  object-fit:contain;
  filter: drop-shadow(0 6px 18px rgba(0,0,0,0.08));
  transition: transform var(--transition);
}
.logo:hover .site-logo{ transform: translateY(-3px) scale(1.02); }

/* If you want a small text label next to the logo (optional) */
.brand-name{
  font-weight:800;
  font-size:1.05rem;
  color:var(--text);
  letter-spacing:0.2px;
}
/* -------------------------
   SMALLER SIZING / RESPONSIVE
   -------------------------*/
@media (min-width:520px){
  .product-grid{grid-template-columns: repeat(2, 1fr)}
  .hero-caption{left:24px;bottom:24px;width:46%}
  .hero-slider{min-height:360px}
  .hero-media img{transform:scale(1.03)}
  .modal-grid{grid-template-columns: 1fr 1fr}
  .modal-inner{padding:18px}
  .contact-grid{grid-template-columns: 1fr 1fr}
  .footer-top{flex-direction:row}
  .header-inner{height:76px}
  .main-nav .nav-list{gap:18px}
}
.cart-item-title.clickable { cursor: pointer; display:inline-block; }
.cart-item-title.clickable:hover { text-decoration: underline; color: var(--brand-1); }
.cart-item-thumb { cursor: pointer; }
.cart-item[role="group"]:focus { outline: none; box-shadow: var(--focus); border-radius: 10px; }

@media (min-width:880px){
  .product-grid{grid-template-columns: repeat(3, 1fr)}
  .hero-slider{min-height:420px}
  .hero-caption{max-width:620px}
  .header-inner{height:84px}
}

@media (min-width:1100px){
  .product-grid{grid-template-columns: repeat(4, 1fr)}
  .hero-slider{min-height:500px}
  .modal-inner{max-width:1100px}
  .modal-grid{grid-template-columns:1fr 1fr}
}

/* Accessibility focus states */
a:focus, button:focus, input:focus, select:focus, textarea:focus{
  outline:none;box-shadow:var(--focus);
}
/* small header checkout button */
.cart-header .checkout-header-btn {
  padding: 8px 10px;
  border-radius: 10px;
  font-weight: 700;
  display: inline-flex;
  gap: 8px;
  align-items: center;
}
.cart-header .checkout-header-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* -------------------------
   Subtle micro animations
   -------------------------*/
@keyframes floaty {
  0%{ transform:translateY(0) }
  50%{ transform:translateY(-6px) }
  100%{ transform:translateY(0) }
}
.btn.large{animation:floaty 4s ease-in-out infinite}

/* small helpers */
.lead-strong{font-weight:800}
.center{text-align:center}
.kv{display:flex;align-items:center;gap:8px}

/* -------------------------
   END
   -------------------------*/
</style>
<style> /* HERO: force hero slider to occupy half the viewport */
:root {
  --header-space: 84px; /* change if your header-inner height differs */
}

.hero-slider {
  height: 50vh !important;       /* half the viewport */
  min-height: 220px;             /* fallback on very small screens */
  max-height: 60vh;
  border-radius: var(--radius-lg);
  display: block;
  overflow: hidden;
}

/* make slide children fill that height */
.hero-slider .slide,
.hero-slider .slide-inner,
.hero-media,
.hero-media img {
  height: 100% !important;
}

/* adjust caption positioning to fit smaller height */
.hero-caption {
  bottom: 12px;
  left: 12px;
  padding: 14px;
  width: calc(100% - 32px);
  max-width: 520px;
}
/* =========================
   Mobile UX improvements (phones)
   ========================= */

/* Make hamburger easier to tap and above other UI */
.hamburger{
  touch-action: manipulation;
  -webkit-tap-highlight-color: rgba(0,0,0,0.0);
  z-index: 140; /* above modals/nav */
  padding: 10px 12px;   /* larger hit area */
  font-size: 18px;
}

/* ensure the hamburger icon has visible tap target */
.hamburger .fa-bars { font-size: 20px; }

/* ---------- Phone-specific layout tweaks ---------- */
@media (max-width: 720px) {

  /* 2b: Make shop grid 2 columns on phones (2x2 viewport feel) */
  .product-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 10px;
  }

  /* Make product card contents breathe better in 2-column layout */
  .product-card { padding: 10px; border-radius: 12px; }
  .product-media { padding-top: 66%; } /* balance aspect in smaller columns */

  /* 2c: Enlarge modal & cart close buttons on phones */
  .modal .modal-close,
  .cart-close,
  #checkout-modal .modal-close,
  #buynow-modal .modal-close {
    font-size: 20px;
    padding: 10px;
    border-radius: 12px;
    background: rgba(255,255,255,0.98);
    box-shadow: 0 8px 22px rgba(10,20,30,0.06);
    color: var(--muted);
  }
  .modal .modal-close:focus,
  .cart-close:focus { box-shadow: var(--focus); }

  /* Increase the close icon's clickable area */
  .modal .modal-close i,
  .cart-close i { pointer-events: none; }

  /* 2d: Checkout & BuyNow modal — stack vertically on phones */
  #checkout-modal .modal-inner > div,
  #buynow-modal .modal-inner > div {
    display: grid;
    grid-template-columns: 1fr !important;
    gap: 12px;
  }
  #checkout-modal .modal-inner aside,
  #buynow-modal .modal-inner aside {
    width: 100% !important;
    max-width: none !important;
    box-sizing: border-box;
  }

  /* Make checkout summary area full width and pinned below item list */
  #checkout-modal .modal-inner aside,
  #buynow-modal .modal-inner aside {
    order: 2;
  }
  #checkout-modal .modal-inner > div > :first-child,
  #buynow-modal .modal-inner > div > :first-child {
    order: 1;
  }

  /* Ensure checkout modal is full height scrollable and comfortable on phones */
  #checkout-modal .modal-inner,
  #buynow-modal .modal-inner {
    max-height: calc(100vh - var(--header-space, 84px));
    overflow: auto;
    padding: 14px;
    border-radius: 14px;
  }

  /* Increase CTA sizes inside checkout on phones */
  #checkout-pay, #buynow-pay {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
  }

  /* Make 'Continue shopping' button inside empty cart look tappable */
  .cart-empty .btn { padding: 10px 14px; border-radius: 12px; }

  /* Slightly increase cart toggle sizing */
  #cart-toggle { padding: 10px !important; border-radius: 12px; font-size: 18px; }

  /* Reduce hero caption overlay on very small screens if needed */
  .hero-caption { max-width: 95%; padding: 10px; }

}

</style>
  <style>
    :root {
  /* keep your fallback — JS will update this on load */
  --header-space: 84px;
}

/* make header fixed at the top (replaces previous sticky behavior) */
.site-header{
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 120; /* above most UI elements */
  backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
  border-bottom: 1px solid rgba(15,23,42,0.04);
  box-shadow: 0 6px 18px rgba(18,24,36,0.03);
}

/* push page content below the fixed header */
body {
  /* keep the existing rules, but add this line: */
  padding-top: var(--header-space);
}

/* cart panel should start below the header and span the rest of the viewport */
.cart-panel{
  position: fixed;
  right: 0;
  top: var(--header-space);                  /* start below header */
  height: calc(100% - var(--header-space));  /* full height minus header */
  width: 100%;
  max-width: 420px;
  background: linear-gradient(180deg,#fff,#fffefc);
  box-shadow: -20px 0 60px rgba(10,20,30,0.16);
  transform: translateX(110%);
  transition: transform 260ms cubic-bezier(.2,.9,.2,1);
  z-index: 110;
  display: flex;
  flex-direction: column;
}
.cart-panel.open{ transform: translateX(0); }

  </style>
  <style>
/* ============ Mobile improvements (phones ≤ 720px) ============ */
@media (max-width:720px) {
  /* 2.a — make hamburger reliably tappable + visible */
  #mobile-toggle, .hamburger {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    padding: 12px !important;
    border-radius: 12px !important;
    min-width: 44px;
    min-height: 44px;
    touch-action: manipulation;
    z-index: 140; /* above header content so taps register */
    -webkit-tap-highlight-color: rgba(0,0,0,0.06);
  }
  #mobile-toggle .fa-bars, .hamburger .fa-bars { font-size: 20px !important; }

  /* 2.b — shop dresses: show 2 columns on phones (2x2 visible when scrolling) */
  .product-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 10px !important;
  }

  /* make product cards breathe on tiny screens */
  .product-card { border-radius: 12px; }

  /* 2.c — bigger close buttons so they're easier to tap on phones */
  .modal-close, .cart-close, #checkout-modal .modal-close, #buynow-modal .modal-close {
    padding: 10px 12px !important;
    font-size: 18px !important;
    border-radius: 12px !important;
    min-width: 44px;
    min-height: 44px;
    box-shadow: 0 8px 20px rgba(8,20,38,0.08);
  }

  /* make icon-only close buttons have higher hit area */
  .modal .modal-close i, .cart-close i { pointer-events: none; }

  /* 2.d — stack checkout modal vertically on phones */
  /* override inline grid from HTML using !important */
  #checkout-modal .modal-inner > div,
  #buynow-modal .modal-inner > div {
    grid-template-columns: 1fr !important;
    align-items: stretch;
  }
  /* make sidebar area full-width and appear below items */
  #checkout-modal .modal-inner aside,
  #buynow-modal .modal-inner aside {
    width: 100% !important;
    max-width: none !important;
    margin-top: 12px;
  }
  /* ensure modal inner is scrollable vertically and not horizontally */
  #checkout-modal .modal-inner, #buynow-modal .modal-inner {
    max-width: 92vw !important;
    padding: 12px !important;
    overflow: auto !important;
  }

  /* tighten hero caption so it doesn't overlap */
  .hero-caption { max-width: 60%; }

  /* ensure mobile nav is visible and animation is smooth */
  #mobile-nav { display: flex !important; transition: max-height 260ms ease; }
  #mobile-nav.open { max-height: 520px !important; }

  /* enlarge cart button target as well */
  #cart-toggle { padding: 10px !important; min-width: 44px; min-height: 44px; border-radius: 10px; }
  #cart-toggle .fa-shopping-cart { font-size: 18px !important; }

  /* spacing fixes for product-body elements */
  .product-body { padding: 10px !important; }
}
</style>
<style>
/* === Task 3: Bigger header cart icon & badge === */

/* make the cart button larger and more tappable (desktop + mobile) */
.header-actions #cart-toggle {
  padding: 10px 14px !important;    /* larger hit area */
  min-width: 52px !important;
  min-height: 52px !important;
  border-radius: 12px !important;
  display: inline-flex !important;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 24px rgba(12,18,28,0.06);
  transition: transform 160ms ease, box-shadow 160ms ease;
}

/* slightly grow on hover/focus for visual affordance */
.header-actions #cart-toggle:hover,
.header-actions #cart-toggle:focus {
  transform: translateY(-3px) scale(1.03);
  box-shadow: 0 12px 30px rgba(12,18,28,0.10);
  outline: none;
}

/* bigger cart glyph */
.header-actions #cart-toggle .fa-shopping-cart {
  font-size: 20px !important; /* desktop */
  line-height: 1;
}

/* badge: larger, more legible */
#cart-badge {
  min-width: 22px !important;
  height: 22px !important;
  padding: 2px 7px !important;
  font-size: 12px !important;
  border-radius: 999px !important;
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(12,18,28,0.08);
}

/* slightly larger for small screens too */
@media (max-width:720px) {
  .header-actions #cart-toggle { padding: 10px !important; min-width:48px !important; min-height:48px !important; }
  .header-actions #cart-toggle .fa-shopping-cart { font-size: 18px !important; }
  #cart-badge { min-width:20px; height:20px; font-size:11px; padding:2px 6px; }
}
</style>
<style>
/* Header search toggle: reveal the shop search on mobile and provide a neat overlay */
body.search-open {
  /* nothing visual by itself; we target the search wrap */
}

/* when search-open is active, show the hidden .search-wrap (mobile override) */
body.search-open .search-wrap {
  display: flex !important;
  position: fixed !important;
  left: 8px !important;
  right: 8px !important;
  top: calc(var(--header-space) + 8px) !important;
  z-index: 220 !important;
  padding: 8px !important;
  border-radius: 12px !important;
  box-shadow: 0 14px 40px rgba(8,20,38,0.12) !important;
  background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92)) !important;
  align-items: center;
}

/* make the search input wider when overlay active */
body.search-open .search-wrap input[type="search"] {
  width: 100% !important;
  min-width: 140px !important;
  padding: 12px 10px !important;
  font-size: 1rem !important;
}

/* subtle dim behind the header when search is open on mobile (non-invasive) */
body.search-open::before{
  content: "";
  position: fixed;
  inset: 0;
  top: calc(var(--header-space) + 8px);
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(8,15,24,0.18);
  z-index: 210;
  pointer-events: none;
}

/* ensure clear button sits nicely in overlay */
body.search-open #search-clear {
  z-index: 230;
}

/* keep layout consistent on desktop (no visual change) */
@media (min-width:721px) {
  body.search-open .search-wrap { position: static; box-shadow: none; top: auto; left: auto; right: auto; }
  body.search-open::before { display:none; }
}
</style>

</head>
<body>
  <!-- SITE HEADER -->
  <header class="site-header" role="banner">
    <div class="container header-inner">
      <!-- Replace the old logo <a> in your header with this -->
<a href="#" class="logo" aria-label="April Blossoms">
  <img src="logo.jpg" alt="April Blossoms logo" class="site-logo" />
  <span class="brand-name sr-only">April Blossoms</span>
</a>


  <nav class="main-nav" role="navigation" aria-label="Primary">
    <ul class="nav-list">
      <li><a href="#hero"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="#shop"><i class="fa fa-shopping-bag"></i> Shop</a></li>
      <li><a href="#contact"><i class="fa fa-envelope"></i> Contact</a></li>
      <li><a href="#about"><i class="fa fa-info-circle"></i> About</a></li>
    </ul>
  </nav>

  <div class="header-actions">
    <button id="search-toggle" class="icon-btn" aria-label="Search">
      <i class="fa fa-search"></i>
    </button>

    <button id="cart-toggle" class="icon-btn" aria-label="Open cart" aria-haspopup="true" aria-controls="cart-panel">
      <i class="fa fa-shopping-cart"></i>
      <span id="cart-badge" class="badge" aria-live="polite">0</span>
    </button>

    <!-- HAMBURGER / MOBILE TOGGLE -->
   <button id="mobile-toggle" class="hamburger" aria-label="Open menu" aria-expanded="false">
  <span class="hamburger-lines" aria-hidden="true"></span>
  <i class="fa fa-bars" aria-hidden="true"></i>
</button>
  </div>
</div>

<!-- MOBILE NAV (will be toggled by JS) -->
<nav id="mobile-nav" class="mobile-nav" aria-hidden="true" aria-label="Mobile navigation" style="display: none">
  <ul>
    <li><a href="#hero"><i class="fa fa-home"></i> Home</a></li>
    <li><a href="#shop"><i class="fa fa-shopping-bag"></i> Shop</a></li>
    <li><a href="#contact"><i class="fa fa-envelope"></i> Contact</a></li>
    <li><a href="#about"><i class="fa fa-info-circle"></i> About</a></li>
  </ul>
  <div class="mobile-nav-footer">
    <a class="btn tiny" href="#"><i class="fa fa-user"></i> Admin</a>
  </div>
</nav>

  </header>

  <main id="main" role="main">

<!-- HERO / SLIDESHOW -->
<section id="hero" class="hero">
  <div class="hero-slider" data-slides="3" aria-roledescription="carousel">
    <div class="slide" data-slide="1" role="group" aria-roledescription="slide" aria-label="Slide 1 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="hero-1.jpg" alt="Bright kids dresses on display">
        </picture>
        <div class="hero-caption">
          <h1>Unique Dresses — Only One of Each</h1>
          <p>Handmade kids' dresses. Once it's sold, it's gone. Find the one that fits her best.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-shopping-bag"></i> Shop Now</a>
            <a class="btn outline" href="#about"><i class="fa fa-info-circle"></i> Learn More</a>
          </div>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="2" role="group" aria-roledescription="slide" aria-label="Slide 2 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="hero-2.jpg" alt="Child wearing a floral dress">
        </picture>
        <div class="hero-caption">
          <h2>Playful, Pretty & Practical</h2>
          <p>Comfortable fabrics, joyful designs — perfect for parties and play dates.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-star"></i> Browse Styles</a>
          </div>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="3" role="group" aria-roledescription="slide" aria-label="Slide 3 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="hero-4.jpg" alt="Close-up detail of dress fabric">
        </picture>
        <div class="hero-caption">
          <h2>Limited Editions</h2>
          <p>Each dress is one-of-a-kind — grab it before it's gone.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-bolt"></i> Limited Picks</a>
          </div>
        </div>
      </div>
    </div>

    <!-- hero controls (JS will hook these) -->
    <div class="hero-controls">
      <button class="hero-prev" aria-label="Previous slide"><i class="fa fa-chevron-left"></i></button>
      <button class="hero-next" aria-label="Next slide"><i class="fa fa-chevron-right"></i></button>
      <div class="hero-dots" role="tablist" aria-label="Slide indicators"></div>
    </div>
  </div>
</section>

<!-- CATEGORIES (AGE RANGES) -->
<section class="categories" aria-label="Age categories">
  <div class="container">
    <h3 class="section-title"><i class="fa fa-list"></i> Sizes & Age Groups</h3>
    <div class="category-chips" role="toolbar" aria-label="Filter by age">
      <button class="chip" data-filter="0-3">0–3 yrs <i class="fa fa-baby"></i></button>
      <button class="chip" data-filter="4-5">4–5 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="5-6">5–6 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="6-7">6–7 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="7-8">7–8 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="8-9">8–9 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="9-10">9–10 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="10-12">10–12 yrs <i class="fa fa-teen"></i></button>
      <button class="chip" data-filter="adult">Adult <i class="fa fa-user"></i></button>
    </div>
  </div>
</section>

<!-- SHOP / PRODUCT GRID -->
<section id="shop" class="shop container" aria-labelledby="shop-heading">
  <div class="shop-header">
    <h2 id="shop-heading"><i class="fa fa-store"></i> Shop Dresses</h2>
    <div class="shop-controls">
      <div class="search-wrap">
        <input id="search-input" type="search" placeholder="Search by name, color or id..." aria-label="Search products">
        <button id="search-clear" class="icon-btn" aria-label="Clear search"><i class="fa fa-times"></i></button>
      </div>

      <div class="sort-wrap">
        <label for="sort-select" class="sr-only">Sort</label>
        <select id="sort-select" aria-label="Sort products">
          <option value="featured">Featured</option>
          <option value="newest">Newest</option>
          <option value="price-asc">Price: Low → High</option>
          <option value="price-desc">Price: High → Low</option>
        </select>
      </div>
    </div>
  </div>

 
  <div id="product-grid" class="product-grid" data-total-products="50" aria-live="polite">
    <!-- JS will inject product cards here using the template below -->
  </div>

  <!-- Load more to reveal more products in batches of 10 -->
  <div class="load-more-wrap">
    <button id="load-more" class="btn" aria-controls="product-grid" aria-label="Load more products">
      More dresses <i class="fa fa-chevron-down"></i>
    </button>
  </div>
</section>

<!-- PRODUCT CARD TEMPLATE (to be cloned by JS) -->
<template id="product-card-template">
  <article class="product-card" role="article" aria-label="Product">
    <div class="product-media">
      <button class="quickview" data-action="open-modal" aria-label="Quick view product">
        <i class="fa fa-search-plus"></i>
      </button>
      <img src="" alt="" class="product-image" />
      <div class="product-tag">
        <span class="tag-text">One-of-a-kind</span>
        <i class="fa fa-tag"></i>
      </div>
    </div>

    <div class="product-body">
      <h3 class="product-title"></h3>
      <p class="product-meta">
        <span class="product-size"></span>
        <span class="product-id"></span>
      </p>
      <div class="product-bottom">
        <div class="price-wrap">
          <span class="price"></span>
        </div>
        <div class="card-actions">
          <button class="btn tiny add-cart" data-action="add-to-cart" aria-label="Add to cart">
            <i class="fa fa-shopping-cart"></i> Add
          </button>
          <button class="btn outline tiny more-info" data-action="more-info" aria-label="More details">
            <i class="fa fa-info-circle"></i> More
          </button>
        </div>
      </div>
    </div>
  </article>
</template>

<!-- PRODUCT QUICK-VIEW / DETAILS MODAL -->
<div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
  <div class="modal-inner">
    <button class="modal-close" aria-label="Close product" data-action="close-modal">
      <i class="fa fa-times"></i>
    </button>

    <div class="modal-grid">
      <div class="modal-media">
        <div class="gallery" id="modal-gallery" aria-live="polite">
          <!-- JS will fill with <img> thumbnails and main image -->
        </div>
        <div class="gallery-thumbs" id="modal-thumbs">
          <!-- thumbnails -->
        </div>
      </div>

      <div class="modal-info">
        <h2 id="modal-title" class="modal-title"></h2>
        <p class="modal-id"></p>

        <div class="price-row">
          <div class="modal-price"></div>
          <div class="availability"><i class="fa fa-check-circle"></i> In stock</div>
        </div>

        <p class="modal-desc"></p>

        <div class="modal-controls">
          <label for="modal-size">Size</label>
          <select id="modal-size" name="size" aria-label="Choose size">
            <option value="">Select size</option>
          </select>

          <label for="modal-qty">Qty</label>
          <input id="modal-qty" type="number" min="1" value="1" aria-label="Quantity" />

          <div class="modal-cta">
            <button id="modal-add" class="btn large" data-action="add-to-cart-modal">
              <i class="fa fa-shopping-cart"></i> Add to cart
            </button>

            <button id="modal-buy" class="btn accent" data-action="checkout-now">
              <i class="fa fa-credit-card"></i> Buy now
            </button>
          </div>
        </div>

        <div class="modal-meta">
          <small><i class="fa fa-calendar"></i> Unique piece ID: <span class="meta-id"></span></small>
          <small><i class="fa fa-star"></i> Handmade details</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CART PANEL (slide-out) -->
<aside id="cart-panel" class="cart-panel" aria-hidden="true" role="region" aria-label="Shopping cart">
 <div class="cart-header">
    <h3><i class="fa fa-shopping-cart"></i> Your Cart</h3>
    <div class="cart-header-actions" style="display:flex;align-items:center;gap:8px">
      <button id="cart-header-checkout" class="btn tiny checkout-header-btn" data-action="checkout" aria-label="Checkout" disabled>
        <i class="fa fa-credit-card"></i> Checkout
      </button>
      <button class="cart-close icon-btn" aria-label="Close cart" data-action="close-cart"><i class="fa fa-times"></i></button>
    </div>
  </div>


  <div id="cart-contents" class="cart-contents">
    <!-- JS will inject cart items here -->
    <div class="cart-empty">
      <i class="fa fa-box-open fa-3x"></i>
      <p>Your cart is empty. Add a dress you love!</p>
    </div>
  </div>

  <div class="cart-footer">
    <div class="cart-summary">
      <div class="subtotal">
        <span>Subtotal</span>
        <strong id="cart-subtotal">₵0.00</strong>
      </div>
    </div>

    <div class="cart-actions">
      <!-- Paystack will be handled via frontend JS on checkout -->
      <button id="checkout-btn" class="btn large checkout" data-action="checkout" aria-label="Checkout with Paystack">
        <i class="fa fa-credit-card"></i> Checkout (Paystack)
      </button>
      <button id="clear-cart" class="btn outline" data-action="clear-cart" aria-label="Clear cart">
        <i class="fa fa-trash"></i> Clear
      </button>
    </div>
  </div>
</aside>

<!-- CONTACT SECTION -->
<section id="contact" class="contact container" aria-labelledby="contact-heading">
  <h2 id="contact-heading"><i class="fa fa-envelope-open"></i> Get in touch</h2>
  <div class="contact-grid">
    <div class="contact-card">
      <h3>Questions?</h3>
      <p>Send us a message about sizing, fabric or custom orders.</p>
      <ul class="contact-list">
        <li><i class="fa fa-phone"></i> <a href="tel:+233000000000">+233 000 000 000</a></li>
        <li><i class="fa fa-whatsapp"></i> <a href="#">WhatsApp</a></li>
        <li><i class="fa fa-envelope"></i> <a href="mailto:hello@tinythreads.example">hello@tinythreads.example</a></li>
      </ul>
    </div>

    <form id="contact-form" class="contact-form" aria-label="Contact form" novalidate>
      <div class="form-row">
        <label for="name">Name</label>
        <input id="name" name="name" type="text" placeholder="Your name" required />
      </div>

      <div class="form-row">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" placeholder="you@example.com" required />
      </div>

      <div class="form-row">
        <label for="message">Message</label>
        <textarea id="message" name="message" rows="4" placeholder="Ask about a dress, sizing, or restocks..." required></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn"><i class="fa fa-paper-plane"></i> Send message</button>
        <button type="reset" class="btn outline"><i class="fa fa-eraser"></i> Reset</button>
      </div>
    </form>
  </div>
</section>

<!-- ABOUT / SHOP INFO -->
<section id="about" class="about container" aria-labelledby="about-heading">
  <h2 id="about-heading"><i class="fa fa-info-circle"></i> About Tiny Threads</h2>
  <p class="lead">We make one-off dresses for children and small adults — lovingly crafted and limited in quantity. Each piece is photographed and listed as a single item. When it’s sold, it’s removed from the shop so you know you’re getting something unique.</p>

  <ul class="features-grid">
    <li><i class="fa fa-hand-paper"></i> Ethically made</li>
    <li><i class="fa fa-seedling"></i> Natural fabrics</li>
    <li><i class="fa fa-truck"></i> Fast local shipping</li>
    <li><i class="fa fa-star"></i> Unique designs</li>
  </ul>
</section>
```

  </main>

  <!-- STACKED FOOTER -->

  <footer class="site-footer" role="contentinfo">
    <div class="footer-top container">
      <div class="footer-col">
        <a class="footer-logo" href="#"><i class="fa fa-heart"></i> Tiny Threads</a>
        <p>One-of-a-kind kids dresses. Small batches, big smiles.</p>
        <div class="socials">
          <a href="#" aria-label="Instagram"><i class="fa fa-instagram"></i></a>
          <a href="#" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
          <a href="#" aria-label="TikTok"><i class="fa fa-music"></i></a>
        </div>
      </div>


  <div class="footer-col">
    <h4>Quick links</h4>
    <ul>
      <li><a href="#shop"><i class="fa fa-angle-right"></i> Shop</a></li>
      <li><a href="#about"><i class="fa fa-angle-right"></i> About</a></li>
      <li><a href="#contact"><i class="fa fa-angle-right"></i> Contact</a></li>
      <li><a href="admin.html"><i class="fa fa-angle-right"></i> Admin (private)</a></li>
    </ul>
  </div>

  <div class="footer-col">
    <h4>Newsletter</h4>
    <p>Get new dress drops and restock alerts.</p>
    <form id="newsletter" class="newsletter-form" aria-label="Newsletter sign up">
      <input type="email" placeholder="you@example.com" aria-label="Email for newsletter" />
      <button type="submit" class="btn tiny"><i class="fa fa-paper-plane"></i> Subscribe</button>
    </form>
  </div>
</div>

<div class="footer-bottom container">
  <small>&copy; <span id="year"></span> Tiny Threads — All rights reserved.</small>
  <ul class="legal">
    <li><a href="#">Terms</a></li>
    <li><a href="#">Privacy</a></li>
  </ul>
</div>


  </footer>

  <!-- TEMPLATES FOR CART ITEMS -->

 <template id="cart-item-template">
  <div class="cart-item" data-product-id="" tabindex="0" role="group" aria-label="Cart item">
    <img src="" alt="" class="cart-item-thumb" />
    <div class="cart-item-info">
      <strong class="cart-item-title clickable"></strong>
      <small class="cart-item-meta"></small>

      <div class="cart-item-price-row" style="display:flex;gap:10px;align-items:center;margin:6px 0;">
        <span class="unit-price" aria-hidden="true" style="font-size:0.95rem;color:var(--muted)"></span>
        <span class="line-price" style="margin-left:auto;"><strong class="item-price"></strong></span>
      </div>

      <div class="cart-item-actions" style="display:flex;gap:8px;align-items:center;">
        <input type="number" min="1" value="1" class="cart-item-qty" aria-label="Quantity" />
        <button class="icon-btn cart-item-remove" aria-label="Remove item"><i class="fa fa-trash"></i></button>
      </div>
    </div>
  </div>
</template>

  <!-- CHECKOUT MODAL -->
<div id="checkout-modal" class="modal checkout-modal" role="dialog" aria-modal="true" aria-hidden="true" style="z-index:130;display:none;">
  <div class="modal-inner" style="max-width:980px; padding:18px;">
    <button class="modal-close" aria-label="Close checkout" data-action="close-checkout" style="right:16px;top:12px">
      <i class="fa fa-times"></i>
    </button>
    <div style="display:grid;grid-template-columns:1fr 340px;gap:16px;">
      <!-- LEFT: items list -->
      <div style="padding:8px 6px; max-height:60vh; overflow:auto;">
        <h2 style="margin:0 0 8px 0; font-size:1.1rem;"><i class="fa fa-receipt"></i> Order & items</h2>
        <div id="checkout-items" aria-live="polite" style="display:flex;flex-direction:column;gap:10px;margin-top:10px;">
          <!-- JS will inject item rows: thumbnail, title, size, qty, unit, line -->
        </div>
      </div>

      <!-- RIGHT: buyer details + summary -->
      <aside style="padding:8px 12px; background:linear-gradient(180deg,#fff,#fffefc); border-radius:12px; box-shadow:var(--shadow);">
        <h3 style="margin:0 0 8px 0;">Your details</h3>
        <form id="checkout-form" novalidate>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <label class="sr-only" for="checkout-name">Full name</label>
            <input id="checkout-name" name="name" type="text" placeholder="Full name" required style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />

            <label class="sr-only" for="checkout-email">Email</label>
            <input id="checkout-email" name="email" type="email" placeholder="Email (for receipt)" required style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />

            <label class="sr-only" for="checkout-phone">Phone</label>
            <input id="checkout-phone" name="phone" type="tel" placeholder="Phone number (WhatsApp preferred)" style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(15,23,42,0.04)" />

          <div style="display:flex;flex-direction:column;gap:6px;">
            <div style="display:flex;justify-content:space-between"><span>Subtotal</span><strong id="checkout-subtotal">₵0.00</strong></div>
            <div style="display:flex;justify-content:space-between"><span>Processing fee <small>(1.95% + 1%)</small></span><strong id="checkout-fee">₵0.00</strong></div>
            <div style="display:flex;justify-content:space-between;font-size:1.05rem;margin-top:6px;"><span>Total</span><strong id="checkout-total">₵0.00</strong></div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="checkout-pay" class="btn large" type="button"><i class="fa fa-credit-card"></i> Pay</button>
            <button id="checkout-cancel" class="btn outline" type="button"><i class="fa fa-times"></i> Cancel</button>
          </div>
        </form>
      </aside>
    </div>
  </div>
</div>

<!-- BUY NOW (single product) MODAL -->
<div id="buynow-modal" class="modal checkout-modal" role="dialog" aria-modal="true" aria-hidden="true" style="z-index:130;display:none;">
  <div class="modal-inner" style="max-width:980px; padding:18px;">
    <button class="modal-close" aria-label="Close buy now" data-action="close-buynow" style="right:16px;top:12px">
      <i class="fa fa-times"></i>
    </button>
    <div style="display:grid;grid-template-columns:1fr 340px;gap:16px;">
      <!-- LEFT: single product preview -->
      <div style="padding:8px 6px; max-height:60vh; overflow:auto;">
        <h2 style="margin:0 0 8px 0; font-size:1.1rem;"><i class="fa fa-bolt"></i> Buy this item</h2>
        <div id="buynow-item" aria-live="polite" style="display:flex;flex-direction:column;gap:10px;margin-top:10px;">
          <!-- JS injects single item row (thumbnail, title, size, qty, price) -->
        </div>
      </div>

      <!-- RIGHT: buyer details + summary -->
      <aside style="padding:8px 12px; background:linear-gradient(180deg,#fff,#fffefc); border-radius:12px; box-shadow:var(--shadow);">
        <h3 style="margin:0 0 8px 0;">Your details</h3>
        <form id="buynow-form" novalidate>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <label class="sr-only" for="buynow-name">Full name</label>
            <input id="buynow-name" name="name" type="text" placeholder="Full name" required style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />

            <label class="sr-only" for="buynow-email">Email</label>
            <input id="buynow-email" name="email" type="email" placeholder="Email (for receipt)" required style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />

            <label class="sr-only" for="buynow-phone">Phone</label>
            <input id="buynow-phone" name="phone" type="tel" placeholder="Phone number (WhatsApp preferred)" style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06)" />
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(15,23,42,0.04)" />

          <div style="display:flex;flex-direction:column;gap:6px;">
           <div style="display:flex;justify-content:space-between"><span>Subtotal</span><strong id="buynow-subtotal">₵0.00</strong></div>
            <div style="display:flex;justify-content:space-between"><span>Processing fee <small>(1.95% + 1%)</small></span><strong id="buynow-fee">₵0.00</strong></div>
            <div style="display:flex;justify-content:space-between;font-size:1.05rem;margin-top:6px;"><span>Total</span><strong id="buynow-total">₵0.00</strong></div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="buynow-pay" class="btn large" type="button"><i class="fa fa-credit-card"></i> Pay</button>
            <button id="buynow-cancel" class="btn outline" type="button"><i class="fa fa-times"></i> Cancel</button>
          </div>
        </form>
      </aside>
    </div>
  </div>
</div>
<!-- ==== Receipt modal (paste near end of <body>) ==== -->
<div id="receipt-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="receipt-title" style="display:none; z-index:9999;">
  <div class="modal-inner" style="max-width:820px; padding:18px; border-radius:14px;">
    <button class="modal-close" aria-label="Close receipt" id="receipt-close" style="position:absolute; right:14px; top:12px; border:0; background:transparent; padding:8px; cursor:pointer;"><i class="fa fa-times"></i></button>

    <h2 id="receipt-title" style="margin-top:4px;"><i class="fa fa-receipt"></i> Payment receipt</h2>
    <p id="receipt-sub" class="lead" style="margin:6px 0 12px 0; color:var(--muted);">Below are the payment details. Use <strong>View receipt</strong> to open the full PDF (printable & downloadable).</p>

    <div id="receipt-body" style="display:grid; grid-template-columns: 1fr 320px; gap:12px;">
      <div id="receipt-summary" style="padding:8px 10px;">
        <!-- JS will populate summary here -->
      </div>

      <aside style="padding:10px; border-radius:10px; background:linear-gradient(180deg,#fff,#fffefc); box-shadow:var(--shadow);">
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
          <div style="flex:1">
            <div style="font-size:0.95rem; color:var(--muted)">Total paid</div>
            <div id="receipt-total" style="font-weight:900; font-size:1.5rem; color:var(--brand-1)"></div>
          </div>
        </div>

        <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
          <button id="receipt-view" class="btn large" type="button" style="display:block;"><i class="fa fa-eye"></i> View receipt (PDF)</button>
          <button id="receipt-download" class="btn outline" type="button" style="display:block;"><i class="fa fa-download"></i> Download PDF</button>
          <button id="receipt-print" class="btn tiny" type="button" style="display:block;"><i class="fa fa-print"></i> Print</button>
        </div>
      </aside>
    </div>

    <!-- Optional embedded preview (initially hidden and toggled when user clicks View) -->
    <div id="receipt-preview-wrap" style="margin-top:12px; display:none;">
      <div style="font-size:0.95rem; color:var(--muted); margin-bottom:6px;"><strong>PDF preview</strong> — scroll within the frame or use View to open in a new tab.</div>
      <iframe id="receipt-preview" style="width:100%; height:480px; border:1px solid rgba(15,23,42,0.06); border-radius:8px;" title="Receipt preview"></iframe>
    </div>
  </div>
</div>

<script>
/*
  Consolidated tinythreads script
  - Uses your Paystack public key below
  - No Firebase or remote DB references (local-only)
  - Includes cart, product grid, product modal, checkout, buy-now, invoice PDF, and receipt modal
  - Robust mobile nav (hamburger) behavior
*/

(() => {
  'use strict';

  /* ======================= CONFIG ======================= */
  const PAYSTACK_PUBLIC_KEY = 'pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa';
  const STORAGE_KEYS = { PRODUCTS: 'tiny_products_v1', CART: 'tiny_cart_v1', ORDERS: 'tiny_orders_v1' };
  const LOAD_BATCH = 10;
  const MOBILE_BREAKPOINT = 720;

  /* ======================= HELPERS ======================= */
  const $ = (sel, el = document) => el.querySelector(sel);
  const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));
  const formatPrice = (p) => `₵${Number(p || 0).toFixed(2)}`;
  const nowISO = () => new Date().toISOString();

  function toast(msg, timeout = 2500) {
    try {
      const t = document.createElement('div');
      t.className = 'tiny-toast';
      t.textContent = msg;
      document.body.appendChild(t);
      requestAnimationFrame(() => t.classList.add('show'));
      setTimeout(() => {
        t.classList.remove('show');
        setTimeout(() => t.remove(), 300);
      }, timeout);
    } catch (e) { console.warn('toast error', e); }
  }

  /* ======================= PRODUCTS (local sample) ======================= */
  // Use persisted local copy if present, otherwise built-in sample list
  const builtInProducts = [
  { id: "DRESS-001", title: "Floral Ruffles", price: 40.00, description: "One-of-a-kind floral ruffle dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5700.JPG","IMG_5700.JPG"], available: true, createdAt: new Date(Date.now()-1*86400000).toISOString() },
  { id: "DRESS-002", title: "Sunshine Dress", price: 30.00, description: "Bright yellow play dress", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5701.JPG"], available: true, createdAt: new Date(Date.now()-2*86400000).toISOString() },
  { id: "DRESS-003", title: "Party Bow Dress", price: 35.00, description: "Elegant dress for special occasions", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5702.JPG","IMG_5702.JPG"], available: true, createdAt: new Date(Date.now()-3*86400000).toISOString() },
  { id: "DRESS-004", title: "Polka Play", price: 35.00, description: "Polka-dot twirl dress", sizes: ["0-3M","3-6M"], ageCategory: "4-5", images: ["IMG_5703.JPG"], available: true, createdAt: new Date(Date.now()-4*86400000).toISOString() },
  { id: "DRESS-005", title: "Candy Stripes", price: 35.00, description: "Soft striped cotton dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5704.JPG","IMG_5704.JPG"], available: true, createdAt: new Date(Date.now()-5*86400000).toISOString() },
  { id: "DRESS-006", title: "Meadow Tiny", price: 35.00, description: "Hand-stitched meadow pattern", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5705.JPG"], available: true, createdAt: new Date(Date.now()-6*86400000).toISOString() },
  { id: "DRESS-007", title: "Lace Halo", price: 40.00, description: "Lace-trim party dress", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5706.JPG","IMG_5706.JPG"], available: true, createdAt: new Date(Date.now()-7*86400000).toISOString() },
  { id: "DRESS-008", title: "Seaside Sundress", price: 35.00, description: "Cool and breezy sun dress", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5707.JPG"], available: true, createdAt: new Date(Date.now()-8*86400000).toISOString() },
  { id: "DRESS-009", title: "Minty Bow", price: 100.00, description: "White Shirt with skirt", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5708.JPG","IMG_5708.JPG"], available: true, createdAt: new Date(Date.now()-9*86400000).toISOString() },
  { id: "DRESS-010", title: "Rosette Charm", price: 35.00, description: "Rosette detailing, comfy fit", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5709.JPG"], available: true, createdAt: new Date(Date.now()-10*86400000).toISOString() },

  { id: "DRESS-011", title: "Blossom Day", price: 30.00, description: "Lightweight blossom print dress", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5710.JPG","IMG_5710.JPG"], available: true, createdAt: new Date(Date.now()-11*86400000).toISOString() },
  { id: "DRESS-012", title: "Vintage Coral", price: 40.00, description: "Retro coral dress with pockets", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5711.JPG"], available: true, createdAt: new Date(Date.now()-12*86400000).toISOString() },
  { id: "DRESS-013", title: "Petal Puff", price: 30.00, description: "Petal-pattern puff sleeve dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5712.JPG","IMG_5712.JPG"], available: true, createdAt: new Date(Date.now()-13*86400000).toISOString() },
  { id: "DRESS-014", title: "Lemon Drop", price: 65.00, description: "Blue jeans trousers", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5713.JPG"], available: true, createdAt: new Date(Date.now()-14*86400000).toISOString() },
  { id: "DRESS-015", title: "Bluebell Classic", price: 65.00, description: "Black jeans trousers", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5714.JPG","IMG_5714.JPG"], available: true, createdAt: new Date(Date.now()-15*86400000).toISOString() },
  { id: "DRESS-016", title: "Gingham Girl", price: 35.00, description: "Cute gingham for playdates", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5715.JPG"], available: true, createdAt: new Date(Date.now()-16*86400000).toISOString() },
  { id: "DRESS-017", title: "Velvet Holiday", price: 50.00, description: "Velvet holiday edition", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5716.JPG","IMG_5716.JPG"], available: true, createdAt: new Date(Date.now()-17*86400000).toISOString() },
  { id: "DRESS-018", title: "Daisy Chain", price: 70.00, description: "Daisy print with soft lining", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5717.JPG"], available: true, createdAt: new Date(Date.now()-18*86400000).toISOString() },
  { id: "DRESS-019", title: "Sunset Ombre", price: 50.00, description: "Ombre fade summer dress", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5718.JPG","IMG_5718.JPG"], available: true, createdAt: new Date(Date.now()-19*86400000).toISOString() },
  { id: "DRESS-020", title: "Coral Petals", price: 70.00, description: "Coral floral with ruffled hem", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5719.JPG"], available: true, createdAt: new Date(Date.now()-20*86400000).toISOString() },

  { id: "DRESS-021", title: "Lavender Mist", price: 28.00, description: "Soft lavender cotton dress", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5720.JPG","IMG_5720.JPG"], available: true, createdAt: new Date(Date.now()-21*86400000).toISOString() },
  { id: "DRESS-022", title: "Plaid Picnic", price: 28.00, description: "Cute plaid button dress", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5720.JPG"], available: true, createdAt: new Date(Date.now()-22*86400000).toISOString() },
  { id: "DRESS-023", title: "Rosebud Twirl", price: 120.00, description: "Lightweight twirl skirt", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5721.JPG","IMG_5721.JPG"], available: true, createdAt: new Date(Date.now()-23*86400000).toISOString() },
  { id: "DRESS-024", title: "Mint Sprig", price: 80.00, description: "Refreshingly cool mint dress", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5722.JPG"], available: true, createdAt: new Date(Date.now()-24*86400000).toISOString() },
  { id: "DRESS-025", title: "Buttercup", price: 35.00, description: "Premium buttercup fabric", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5723.JPG","IMG_5723.JPG"], available: true, createdAt: new Date(Date.now()-25*86400000).toISOString() },
  { id: "DRESS-026", title: "Peach Dream", price: 60.00, description: "Soft peach party dress", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5724.JPG"], available: true, createdAt: new Date(Date.now()-26*86400000).toISOString() },
  { id: "DRESS-027", title: "Ivy Garden", price: 35.00, description: "Ivy print with tiny pleats", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5725.JPG","IMG_5725.JPG"], available: true, createdAt: new Date(Date.now()-27*86400000).toISOString() },
  { id: "DRESS-028", title: "Ocean Breeze", price: 45.00, description: "Nautical details and stripes", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5726.JPG"], available: true, createdAt: new Date(Date.now()-28*86400000).toISOString() },
  { id: "DRESS-029", title: "Lilac Lace", price: 35.00, description: "Delicate lilac lace overlay", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5727.JPG","IMG_5727.JPG"], available: true, createdAt: new Date(Date.now()-29*86400000).toISOString() },
  { id: "DRESS-030", title: "Maple Sweet", price: 40.00, description: "Warm tones for autumn play", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5728.JPG"], available: true, createdAt: new Date(Date.now()-30*86400000).toISOString() },

  { id: "DRESS-031", title: "Cherry Puff", price: 40.00, description: "Cherry prints and puff sleeves", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5729.JPG","IMG_5729.JPG"], available: true, createdAt: new Date(Date.now()-31*86400000).toISOString() },
  { id: "DRESS-032", title: "Starry Night", price: 35.00, description: "Dark blue with star pattern", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5730.JPG"], available: true, createdAt: new Date(Date.now()-32*86400000).toISOString() },
  { id: "DRESS-033", title: "Palm Picnic", price: 35.00, description: "Tropical print for sunny days", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5731.JPG","IMG_5731.JPG"], available: true, createdAt: new Date(Date.now()-33*86400000).toISOString() },
  { id: "DRESS-034", title: "Velvet Ribbon", price: 40.00, description: "Lux velvet with ribbon tie", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5732.JPG"], available: true, createdAt: new Date(Date.now()-34*86400000).toISOString() },
  { id: "DRESS-035", title: "Rose Quartz", price: 35.00, description: "Soft pink, comfy cotton", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5733.JPG","IMG_5733.JPG"], available: true, createdAt: new Date(Date.now()-35*86400000).toISOString() },
  { id: "DRESS-036", title: "Star Bloom", price: 30.00, description: "Star bloom pattern, breezy", sizes: ["S","M"], ageCategory: "4-5", images: ["IMG_5734.JPG"], available: true, createdAt: new Date(Date.now()-36*86400000).toISOString() },
  { id: "DRESS-037", title: "Meadow Stitch", price: 40.00, description: "Detailed stitching, floral", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5735.JPG","IMG_5735.JPG"], available: true, createdAt: new Date(Date.now()-37*86400000).toISOString() },
  { id: "DRESS-038", title: "Denim Dolly", price: 50.00, description: "Soft denim dress with buttons", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5736.JPG"], available: true, createdAt: new Date(Date.now()-38*86400000).toISOString() },
  { id: "DRESS-039", title: "Citrine Bloom", price: 65.00, description: "Sunny citrine color", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5737.JPG","IMG_5737.JPG"], available: true, createdAt: new Date(Date.now()-39*86400000).toISOString() },
  { id: "DRESS-040", title: "Cloud Puff", price: 25.00, description: "Puffy clouds print", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5738.JPG"], available: true, createdAt: new Date(Date.now()-40*86400000).toISOString() },

  { id: "DRESS-041", title: "Mint Melody", price: 28.00, description: "Light mint with trims", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5739.JPG","IMG_5739.JPG"], available: true, createdAt: new Date(Date.now()-41*86400000).toISOString() },
  { id: "DRESS-042", title: "Petite Pearl", price: 25.00, description: "Pearl button detail", sizes: ["9","10"], ageCategory: "4-5", images: ["IMG_5740.JPG"], available: true, createdAt: new Date(Date.now()-42*86400000).toISOString() },
  { id: "DRESS-043", title: "Coral Breeze", price: 35.00, description: "Soft coral shade", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5741.JPG","IMG_5741.JPG"], available: true, createdAt: new Date(Date.now()-43*86400000).toISOString() },
  { id: "DRESS-044", title: "Pineapple Pop", price: 30.00, description: "Fun pineapple print", sizes: ["4","5"], ageCategory: "4-5", images: ["IMG_5742.JPG"], available: true, createdAt: new Date(Date.now()-44*86400000).toISOString() },
  { id: "DRESS-045", title: "Willow Whisper", price: 40.00, description: "Earthy willow tones", sizes: ["5","6"], ageCategory: "4-5", images: ["IMG_5743.JPG","IMG_5743.JPG"], available: true, createdAt: new Date(Date.now()-45*86400000).toISOString() },
  { id: "DRESS-046", title: "Sunbeam Tuck", price: 35.00, description: "Tucked waist, sunny print", sizes: ["6","7"], ageCategory: "4-5", images: ["IMG_5744.JPG"], available: true, createdAt: new Date(Date.now()-46*86400000).toISOString() },
  { id: "DRESS-047", title: "Peppermint Twist", price: 30.00, description: "Mint stripes and soft collar", sizes: ["7","8"], ageCategory: "4-5", images: ["IMG_5745.JPG","IMG_5745.JPG"], available: true, createdAt: new Date(Date.now()-47*86400000).toISOString() },
  { id: "DRESS-048", title: "Dotted Dreams", price: 60.00, description: "Subtle dotted pattern", sizes: ["8","9"], ageCategory: "4-5", images: ["IMG_5746.JPG"], available: true, createdAt: new Date(Date.now()-48*86400000).toISOString() },
  { id: "DRESS-049", title: "Little Luxe", price: 80.00, description: "Tiny luxe finish", sizes: ["9","10"], ageCategory: "7-8", images: ["IMG_5747.JPG","IMG_5747.JPG"], available: true, createdAt: new Date(Date.now()-49*86400000).toISOString() },
  { id: "DRESS-050", title: "Pocket Garden", price: 40.00, description: "Playful pockets and cotton", sizes: ["10","12"], ageCategory: "4-5", images: ["IMG_5748.JPG"], available: true, createdAt: new Date(Date.now()-50*86400000).toISOString() }
];

  // load persisted products or use built-in (we keep local only)
  let products = (function loadLocalProducts() {
    try {
      const raw = localStorage.getItem(STORAGE_KEYS.PRODUCTS);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed) && parsed.length) return parsed;
      }
    } catch (e) { /* ignore */ }
    // clone builtInProducts to avoid accidental mutation of original const
    return JSON.parse(JSON.stringify(builtInProducts));
  })();

  /* ======================= PERSISTENCE: CART & ORDERS ======================= */
  function saveCart(c) { try { localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(c || [])); } catch (e){} }
  function loadCart() { try { const raw = localStorage.getItem(STORAGE_KEYS.CART); return raw ? JSON.parse(raw) : []; } catch (e) { return []; } }
  function pushOrder(order) {
    try {
      const raw = localStorage.getItem(STORAGE_KEYS.ORDERS);
      const arr = raw ? JSON.parse(raw) : [];
      arr.unshift(order);
      localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(arr));
    } catch (e) { console.warn('pushOrder failed', e); }
  }
  function saveProductsLocal() {
    try { localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products)); } catch(e) {}
  }

  /* ======================= APP STATE ======================= */
  let cart = loadCart();
  let currentBatchIndex = 0;
  let activeFilters = { ageCategory: null, search: '', sort: 'featured' };

  /* ======================= RENDER: PRODUCTS ======================= */
  const productGrid = $('#product-grid');
  const productTemplate = document.getElementById('product-card-template')?.content;

  function createProductCard(product) {
    const node = document.importNode(productTemplate, true);
    const art = node.querySelector('.product-card');
    art.dataset.productId = product.id;

    const img = node.querySelector('.product-image');
    img.src = (product.images && product.images[0]) || '';
    img.alt = product.title || product.id;

    node.querySelector('.product-title').textContent = product.title || product.id;
    node.querySelector('.product-size').textContent = (product.sizes||[]).join(' • ');
    node.querySelector('.product-id').textContent = product.id;
    node.querySelector('.price').textContent = formatPrice(product.price);

    const addBtn = node.querySelector('[data-action="add-to-cart"]');
    const moreBtn = node.querySelector('.more-info');
    const quickBtn = node.querySelector('[data-action="open-modal"]');

    if (!product.available) {
      art.classList.add('sold-out');
      const tag = node.querySelector('.product-tag .tag-text');
      if (tag) tag.textContent = 'Sold';
      if (addBtn) { addBtn.disabled = true; addBtn.textContent = 'Sold'; }
    }

    // initial button state
    const inCart = cart.some(c => c.id === product.id);
    setProductButtonState(product.id, inCart);

    addBtn?.addEventListener('click', (e) => {
      e.preventDefault();
      const nowInCart = cart.some(c => c.id === product.id);
      if (nowInCart) {
        removeFromCart(product.id);
        toast('Removed from cart');
      } else {
        if (product.sizes && product.sizes.length) {
          openProductModal(product.id);
        } else {
          addToCart(product.id, 1, '');
        }
      }
    });

    moreBtn?.addEventListener('click', (e) => { e.preventDefault(); openProductModal(product.id); });
    quickBtn?.addEventListener('click', (e) => { e.preventDefault(); openProductModal(product.id); });

    return node;
  }

  function setProductButtonState(productId, inCart) {
    const card = document.querySelector(`.product-card[data-product-id="${productId}"]`);
    if (card) {
      const addBtn = card.querySelector('[data-action="add-to-cart"]');
      if (addBtn) {
        if (inCart) {
          addBtn.innerHTML = '<i class="fa fa-times-circle"></i> Remove';
          addBtn.classList.add('in-cart');
          addBtn.setAttribute('aria-pressed', 'true');
        } else {
          addBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Add';
          addBtn.classList.remove('in-cart');
          addBtn.setAttribute('aria-pressed', 'false');
        }
      }
    }
    const modalAddBtn = document.getElementById('modal-add');
    if (modalAddBtn && window.modalCurrentProduct && window.modalCurrentProduct.id === productId) {
      if (inCart) {
        modalAddBtn.innerHTML = '<i class="fa fa-times-circle"></i> Remove from cart';
        modalAddBtn.dataset.state = 'remove';
      } else {
        modalAddBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Add to cart';
        modalAddBtn.dataset.state = 'add';
      }
    }
  }

  function getFilteredSortedProducts() {
    let list = products.slice();
    list = list.filter(p => p.available !== false);
    if (activeFilters.ageCategory) list = list.filter(p => p.ageCategory === activeFilters.ageCategory);
    const q = (activeFilters.search || '').trim().toLowerCase();
    if (q) {
      list = list.filter(p =>
        (p.title||'').toLowerCase().includes(q) ||
        (p.id||'').toLowerCase().includes(q) ||
        ((p.description||'').toLowerCase().includes(q))
      );
    }
    switch (activeFilters.sort) {
      case 'newest': list.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt)); break;
      case 'price-asc': list.sort((a,b) => a.price - b.price); break;
      case 'price-desc': list.sort((a,b) => b.price - a.price); break;
      default: break;
    }
    return list;
  }

  function renderProductsBatch(reset = false) {
    if (!productGrid) return;
    if (reset) { currentBatchIndex = 0; productGrid.innerHTML = ''; }
    const filtered = getFilteredSortedProducts();
    const start = currentBatchIndex * LOAD_BATCH;
    const batch = filtered.slice(start, start + LOAD_BATCH);
    if (batch.length === 0 && start === 0) {
      productGrid.innerHTML = `<div class="no-results"><i class="fa fa-frown"></i><p>No dresses found.</p></div>`;
      return;
    }
    batch.forEach(p => {
      const node = createProductCard(p);
      productGrid.appendChild(node);
    });
    currentBatchIndex++;
    const loadMore = $('#load-more');
    if (start + LOAD_BATCH >= filtered.length) loadMore && (loadMore.style.display = 'none'); else loadMore && (loadMore.style.display = 'inline-block');
  }

  /* ======================= FILTERS / SEARCH / SORT ======================= */
  $$('.category-chips .chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const key = chip.dataset.filter;
      if (activeFilters.ageCategory === key) { activeFilters.ageCategory = null; chip.classList.remove('active'); }
      else { activeFilters.ageCategory = key; $$('.category-chips .chip').forEach(c => c.classList.remove('active')); chip.classList.add('active'); }
      renderProductsBatch(true);
    });
  });
  $('#search-input')?.addEventListener('input', (e) => {
    activeFilters.search = e.target.value;
    clearTimeout(window.__searchTimer);
    window.__searchTimer = setTimeout(() => renderProductsBatch(true), 220);
  });
  $('#search-clear')?.addEventListener('click', () => { $('#search-input').value = ''; activeFilters.search = ''; renderProductsBatch(true); });
  $('#sort-select')?.addEventListener('change', (e) => { activeFilters.sort = e.target.value; renderProductsBatch(true); });
  $('#load-more')?.addEventListener('click', (e) => { e.preventDefault(); renderProductsBatch(false); });

  /* ======================= MODAL ======================= */
  const modal = $('#product-modal');
  const modalGallery = $('#modal-gallery');
  const modalThumbs = $('#modal-thumbs');
  const modalTitle = $('#modal-title');
  const modalPrice = document.querySelector('.modal-price');
  const modalDesc = document.querySelector('.modal-desc');
  const modalIdSpan = document.querySelector('.meta-id');
  const modalSizeSelect = $('#modal-size');
  const modalQty = $('#modal-qty');
  window.modalCurrentProduct = null;

  function openProductModal(productId) {
    const p = products.find(x => x.id === productId);
    if (!p) return;
    window.modalCurrentProduct = p;
    modalGallery.innerHTML = '';
    modalThumbs.innerHTML = '';
    (p.images || []).forEach((src, idx) => {
      const mainImg = document.createElement('img');
      mainImg.src = src;
      mainImg.alt = `${p.title} image ${idx+1}`;
      mainImg.className = 'modal-main-img';
      mainImg.dataset.idx = idx;
      if (idx !== 0) mainImg.style.display = 'none';
      modalGallery.appendChild(mainImg);

      const t = document.createElement('img');
      t.src = src;
      t.alt = `thumb ${idx+1}`;
      t.className = 'thumb';
      t.dataset.idx = idx;
      t.addEventListener('click', () => {
        $$('.modal-main-img', modalGallery).forEach(img => img.style.display = 'none');
        modalGallery.querySelector(`img[data-idx="${idx}"]`).style.display = '';
      });
      modalThumbs.appendChild(t);
    });

    modalTitle.textContent = p.title || '';
    modalPrice && (modalPrice.textContent = formatPrice(p.price || 0));
    modalDesc && (modalDesc.textContent = p.description || '');
    modalIdSpan && (modalIdSpan.textContent = p.id || '');

    if (modalSizeSelect) {
      modalSizeSelect.innerHTML = `<option value="">Select size</option>`;
      (p.sizes || []).forEach(s => { const o = document.createElement('option'); o.value = s; o.textContent = s; modalSizeSelect.appendChild(o); });
    }

    modalQty.value = 1;
    if (p.available === false) {
      try { $('.availability', modal).textContent = 'Sold'; } catch(e){}
      $('#modal-add') && ($('#modal-add').disabled = true);
      $('#modal-buy') && ($('#modal-buy').disabled = true);
    } else {
      try { $('.availability', modal).textContent = 'In stock'; } catch(e){}
      $('#modal-add') && ($('#modal-add').disabled = false);
      $('#modal-buy') && ($('#modal-buy').disabled = false);
    }

    modal && modal.setAttribute('aria-hidden', 'false');
    modal && modal.classList.add('open');
  }

  function closeProductModal() {
    modal && modal.setAttribute('aria-hidden', 'true');
    modal && modal.classList.remove('open');
    clearModalEditState();
    window.modalCurrentProduct = null;
  }

  document.addEventListener('click', (e) => {
    if (e.target.matches('[data-action="close-modal"]') || e.target.closest('#product-modal .modal-close')) closeProductModal();
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeProductModal(); });

  function clearModalEditState() {
    const modalEl = document.getElementById('product-modal');
    if (!modalEl) return;
    modalEl.removeAttribute('data-edit-cart-id');
    const modalAddBtn = document.getElementById('modal-add');
    if (modalAddBtn) modalAddBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Add to cart';
  }

  /* ======================= CART ======================= */
  const cartPanel = $('#cart-panel');
  const cartBadge = $('#cart-badge');
  const cartContents = $('#cart-contents');
  const cartSubtotalEl = $('#cart-subtotal');

  function updateCartUI() {
    if (!cartContents) return;
    cartContents.innerHTML = '';
    if (!cart || cart.length === 0) {
      cartContents.innerHTML = `<div class="cart-empty">
        <i class="fa fa-box-open fa-3x"></i>
        <p>Your cart is empty. Add a dress you love!</p>
        <div style="margin-top:10px"><a href="#shop" class="btn">Continue shopping</a></div>
      </div>`;
      cartBadge && (cartBadge.textContent = 0);
      cartSubtotalEl && (cartSubtotalEl.textContent = '₵0.00');
      $('#cart-header-checkout') && ($('#cart-header-checkout').disabled = true);
      $('#checkout-btn') && ($('#checkout-btn').disabled = true);
      return;
    }

    cartBadge && (cartBadge.textContent = cart.length);
    let subtotal = 0;
    cart.forEach(item => {
      const p = products.find(pp => pp.id === item.id) || {};
      const tpl = document.getElementById('cart-item-template').content.cloneNode(true);
      const el = tpl.querySelector('.cart-item');
      el.dataset.productId = item.id;
      el.querySelector('.cart-item-thumb').src = (p.images && p.images[0]) || '';
      el.querySelector('.cart-item-title').textContent = p.title || item.id;
      el.querySelector('.cart-item-meta').textContent = `${item.size || ''} • ${p.id || ''}`;
      el.querySelector('.unit-price').textContent = `Unit: ${formatPrice(p.price || 0)}`;
      el.querySelector('.cart-item-qty').value = item.qty;
      el.querySelector('.item-price').textContent = formatPrice((p.price || 0) * item.qty);

      el.querySelector('.cart-item-qty').addEventListener('change', (ev) => {
        let v = Number(ev.target.value || 1);
        if (v < 1) { v = 1; ev.target.value = 1; }
        const idx = cart.findIndex(c => c.id === item.id);
        if (idx >= 0) {
          cart[idx].qty = v;
          saveCart(cart);
          updateCartUI();
        }
      });

      el.querySelector('.cart-item-remove').addEventListener('click', (ev) => {
        ev.preventDefault();
        removeFromCart(item.id);
      });

      cartContents.appendChild(tpl);
      subtotal += (p.price || 0) * item.qty;
    });

    cartSubtotalEl && (cartSubtotalEl.textContent = formatPrice(subtotal));
    $('#cart-header-checkout') && ($('#cart-header-checkout').disabled = false);
    $('#checkout-btn') && ($('#checkout-btn').disabled = false);
  }

  function addToCart(productId, qty = 1, size = '') {
    const p = products.find(x => x.id === productId);
    if (!p || p.available === false) { toast('Sorry — this dress is not available'); return; }
    if (cart.some(c => c.id === productId)) { toast('Item already in cart'); return; }
    const item = { id: productId, qty: Math.max(1, Number(qty || 1)), size: size || '' };
    cart.push(item);
    saveCart(cart);
    updateCartUI();
    setProductButtonState(productId, true);
    toast('Added to cart');
    openCart();
  }

  function removeFromCart(productId) {
    if (!productId) return;
    const existed = cart.some(c => c.id === productId);
    if (!existed) return;
    cart = cart.filter(c => c.id !== productId);
    saveCart(cart);
    setProductButtonState(productId, false);
    updateCartUI();
    // if checkout modal open, refresh
    const checkoutModal = document.getElementById('checkout-modal');
    if (checkoutModal && checkoutModal.classList.contains('open')) {
      if (cart.length === 0) closeCheckoutModal(); else openCheckoutModal(cart);
    }
    // if buynow modal open for this item, close it
    const buynowModal = document.getElementById('buynow-modal');
    if (buynowModal && buynowModal.classList.contains('open')) {
      const bn = buynowModal._buynowItem;
      if (bn && bn.id === productId) closeBuyNowModal();
    }
    const modalAddBtn = document.getElementById('modal-add');
    if (window.modalCurrentProduct && window.modalCurrentProduct.id === productId && modalAddBtn) {
      modalAddBtn.innerHTML = '<i class="fa fa-shopping-cart"></i> Add to cart';
      modalAddBtn.dataset.state = 'add';
    }
    toast('Removed from cart');
  }

  function openCart() {
    if (!cartPanel) return;
    cartPanel.setAttribute('aria-hidden', 'false');
    cartPanel.classList.add('open');
    updateCartUI();
  }
  function closeCart() { if (!cartPanel) return; cartPanel.setAttribute('aria-hidden', 'true'); cartPanel.classList.remove('open'); }

  $('#cart-toggle')?.addEventListener('click', () => { const open = cartPanel?.getAttribute('aria-hidden') === 'false'; if (open) closeCart(); else openCart(); });
  document.querySelectorAll('[data-action="close-cart"]').forEach(btn => btn.addEventListener('click', closeCart));
  $('#clear-cart')?.addEventListener('click', (e) => { e.preventDefault(); cart = []; saveCart(cart); updateCartUI(); toast('Cart cleared'); });

  $('#cart-header-checkout')?.addEventListener('click', (e) => { e.preventDefault(); if (cart.length === 0) { toast('Your cart is empty'); return; } startCheckout(cart); });

  /* ======================= CHECKOUT: open modal & process payment ======================= */
  $('#checkout-btn')?.addEventListener('click', (e) => { e.preventDefault(); if (cart.length === 0) { toast('Your cart is empty'); return; } startCheckout(cart); });

  function startCheckout(items) { openCheckoutModal(items); }

  function openCheckoutModal(items) {
    for (const it of items) {
      const p = products.find(pp => pp.id === it.id);
      if (!p || p.available === false) { toast(`${it.id} is no longer available`); return; }
    }
    const modalEl = document.getElementById('checkout-modal');
    const itemsWrap = document.getElementById('checkout-items');
    const subtotalEl = document.getElementById('checkout-subtotal');
    const feeEl = document.getElementById('checkout-fee');
    const totalEl = document.getElementById('checkout-total');
    if (!modalEl || !itemsWrap) return;
    itemsWrap.innerHTML = '';
    const enriched = items.map(it => {
      const p = products.find(pp => pp.id === it.id) || {};
      const unit = p.price || 0; const qty = Number(it.qty || 1); const line = +(unit * qty);
      return { id: it.id, title: p.title || it.id, image: (p.images && p.images[0]) || '', size: it.size || '', qty, unit, line };
    });
    const subtotal = enriched.reduce((s, x) => s + x.line, 0);
    const fee = +(subtotal * 0.0295).toFixed(2);
    const total = +(subtotal + fee).toFixed(2);
    enriched.forEach(it => {
      const row = document.createElement('div');
      row.className = 'checkout-item';
      row.innerHTML = `
        <img src="${it.image}" alt="${it.title}" />
        <div class="meta">
          <div class="title">${it.title}</div>
          <div class="sub">${it.size ? `Size: ${it.size} • ` : ''}Qty: ${it.qty}</div>
        </div>
        <div style="margin-left:auto;text-align:right;">
          <div style="font-weight:800">${formatPrice(it.unit)}</div>
          <div style="color:var(--muted)">${formatPrice(it.line)}</div>
        </div>
      `;
      itemsWrap.appendChild(row);
    });
    subtotalEl.textContent = formatPrice(subtotal);
    feeEl.textContent = formatPrice(fee);
    totalEl.textContent = formatPrice(total);

    modalEl.setAttribute('aria-hidden', 'false');
    modalEl.classList.add('open');
    modalEl.style.display = 'flex';

    modalEl._checkoutItems = enriched;
    modalEl._checkoutSubtotal = subtotal;
    modalEl._checkoutFee = fee;
    modalEl._checkoutTotal = total;

    if (window.__lastBuyerEmail) $('#checkout-email').value = window.__lastBuyerEmail;
    document.getElementById('checkout-cancel').onclick = () => closeCheckoutModal();
    document.querySelector('#checkout-modal .modal-close')?.addEventListener('click', closeCheckoutModal);
    document.getElementById('checkout-pay').onclick = () => processCheckoutPayment();
  }

  function closeCheckoutModal() {
    const modalEl = document.getElementById('checkout-modal');
    if (!modalEl) return;
    modalEl.setAttribute('aria-hidden', 'true');
    modalEl.classList.remove('open');
    modalEl.style.display = 'none';
  }

  function processCheckoutPayment() {
    const modalEl = document.getElementById('checkout-modal');
    if (!modalEl) return;
    const name = (document.getElementById('checkout-name')?.value || '').trim();
    const email = (document.getElementById('checkout-email')?.value || '').trim();
    const phone = (document.getElementById('checkout-phone')?.value || '').trim();
    if (!email || !email.includes('@')) { toast('Please provide a valid email'); return; }
    if (!name) { toast('Please provide your full name'); return; }
    const items = modalEl._checkoutItems || [];
    const subtotal = modalEl._checkoutSubtotal || 0;
    const fee = modalEl._checkoutFee || 0;
    const total = modalEl._checkoutTotal || (subtotal + fee);
    window.__lastBuyerEmail = email;
    window.__lastBuyerName = name;

    for (const it of items) {
      const prod = products.find(p => p.id === it.id);
      if (!prod || prod.available === false) { toast(`${it.id} is no longer available`); return; }
    }

    if (!window.PaystackPop || !PAYSTACK_PUBLIC_KEY || PAYSTACK_PUBLIC_KEY.includes('YOUR_PAYSTACK_PUBLIC_KEY_HERE')) {
      const proceed = confirm(`Paystack not configured. Simulate payment of ${formatPrice(total)}?`);
      if (!proceed) return;
      const fakeRef = 'SIM-' + Math.random().toString(36).slice(2, 10).toUpperCase();
      handleSuccessfulPayment(fakeRef, email, items.map(it => ({ id: it.id, qty: it.qty, size: it.size })), total, { name, phone });
      closeCheckoutModal();
      return;
    }

    try {
      const amountMinor = Math.round(total * 100);
      const handler = PaystackPop.setup({
        key: PAYSTACK_PUBLIC_KEY,
        email: email,
        amount: amountMinor,
        metadata: {
          custom_fields: [
            { display_name: "Buyer name", variable_name: "buyer_name", value: name },
            { display_name: "Phone", variable_name: "phone", value: phone },
            { display_name: "Cart items", variable_name: "cart", value: JSON.stringify(items) }
          ]
        },
        onClose: function() { toast('Payment window closed'); },
        callback: function(response) {
          try {
            handleSuccessfulPayment(response.reference, email, items.map(it => ({ id: it.id, qty: it.qty, size: it.size })), total, { name, phone });
          } catch (err) { console.error('callback error', err); }
          closeCheckoutModal();
        }
      });
      handler.openIframe();
    } catch (err) {
      console.error('Failed to start Paystack transaction', err);
      toast('Could not start transaction — check console.');
    }
  }

  /* ======================= BUY NOW ======================= */
  function openBuyNowModal(singleItem) {
    const p = products.find(pp => pp.id === singleItem.id);
    if (!p || p.available === false) { toast('This item is no longer available'); return; }
    const modalEl = document.getElementById('buynow-modal'); const wrap = document.getElementById('buynow-item');
    const subtotalEl = document.getElementById('buynow-subtotal'); const feeEl = document.getElementById('buynow-fee'); const totalEl = document.getElementById('buynow-total');
    if (!modalEl || !wrap) return;
    wrap.innerHTML = '';
    const unit = p.price || 0; const qty = Number(singleItem.qty || 1); const line = +(unit * qty).toFixed(2);
    const subtotal = line; const fee = +(subtotal * 0.0295).toFixed(2); const total = +(subtotal + fee).toFixed(2);
    const row = document.createElement('div'); row.className = 'checkout-item';
    row.innerHTML = `<img src="${(p.images && p.images[0]) || ''}" alt="${p.title}" />
      <div class="meta"><div class="title">${p.title}</div><div class="sub">${singleItem.size ? 'Size: ' + singleItem.size + ' • ' : ''}Qty: ${qty}</div></div>
      <div style="margin-left:auto;text-align:right;"><div style="font-weight:800">${formatPrice(unit)}</div><div style="color:var(--muted)">${formatPrice(line)}</div></div>`;
    wrap.appendChild(row);
    subtotalEl.textContent = formatPrice(subtotal); feeEl.textContent = formatPrice(fee); totalEl.textContent = formatPrice(total);
    modalEl.setAttribute('aria-hidden', 'false'); modalEl.classList.add('open'); modalEl.style.display = 'flex';
    modalEl._buynowItem = { id: singleItem.id, qty, size: singleItem.size, unit, line }; modalEl._buynowSubtotal = subtotal; modalEl._buynowFee = fee; modalEl._buynowTotal = total;
    if (window.__lastBuyerEmail) document.getElementById('buynow-email').value = window.__lastBuyerEmail;
    if (window.__lastBuyerName) document.getElementById('buynow-name').value = window.__lastBuyerName;
    document.getElementById('buynow-cancel').onclick = () => closeBuyNowModal();
    document.querySelector('#buynow-modal .modal-close')?.addEventListener('click', closeBuyNowModal);
    document.getElementById('buynow-pay').onclick = () => processBuyNowPayment();
  }

  function closeBuyNowModal() { const modalEl = document.getElementById('buynow-modal'); if (!modalEl) return; modalEl.setAttribute('aria-hidden', 'true'); modalEl.classList.remove('open'); modalEl.style.display = 'none'; }

  function processBuyNowPayment() {
    const modalEl = document.getElementById('buynow-modal');
    if (!modalEl) return;
    const name = (document.getElementById('buynow-name')?.value || '').trim();
    const email = (document.getElementById('buynow-email')?.value || '').trim();
    const phone = (document.getElementById('buynow-phone')?.value || '').trim();
    if (!email || !email.includes('@')) { toast('Please provide a valid email'); return; }
    if (!name) { toast('Please provide your full name'); return; }
    const item = modalEl._buynowItem;
    if (!item) { toast('No item to purchase'); return; }
    const items = [{ id: item.id, qty: item.qty, size: item.size }];
    const subtotal = modalEl._buynowSubtotal || 0;
    const fee = modalEl._buynowFee || 0;
    const total = modalEl._buynowTotal || subtotal + fee;
    window.__lastBuyerEmail = email; window.__lastBuyerName = name;
    const prod = products.find(p => p.id === item.id);
    if (!prod || prod.available === false) { toast('This item is no longer available'); return; }

    if (!window.PaystackPop || !PAYSTACK_PUBLIC_KEY || PAYSTACK_PUBLIC_KEY.includes('YOUR_PAYSTACK_PUBLIC_KEY_HERE')) {
      const proceed = confirm(`Paystack not configured. Simulate payment of ${formatPrice(total)}?`);
      if (!proceed) return;
      const fakeRef = 'SIM-' + Math.random().toString(36).slice(2, 10).toUpperCase();
      handleSuccessfulPayment(fakeRef, email, items, total, { name, phone });
      closeBuyNowModal();
      return;
    }

    try {
      const amountMinor = Math.round(total * 100);
      const handler = PaystackPop.setup({
        key: PAYSTACK_PUBLIC_KEY,
        email,
        amount: amountMinor,
        metadata: {
          custom_fields: [
            { display_name: "Buyer name", variable_name: "buyer_name", value: name },
            { display_name: "Phone", variable_name: "phone", value: phone },
            { display_name: "Item", variable_name: "item", value: JSON.stringify(items[0]) }
          ]
        },
        onClose: function() { toast('Payment window closed'); },
        callback: function(response) {
          try {
            handleSuccessfulPayment(response.reference, email, items, total, { name, phone });
          } catch (err) { console.error('buy-now callback error', err); }
          closeBuyNowModal();
        }
      });
      handler.openIframe();
    } catch (err) {
      console.error('Failed to start Paystack transaction (buynow)', err);
      toast('Could not start transaction — check console for details.');
    }
  }

  // Hook modal buy button
  $('#modal-buy')?.addEventListener('click', () => {
    if (!window.modalCurrentProduct) return;
    const size = modalSizeSelect?.value || '';
    const qty = Number(modalQty?.value || 1);
    const single = { id: window.modalCurrentProduct.id, qty, size };
    openBuyNowModal(single);
  });

  /* ======================= INVOICE / PDF (jsPDF) & RECEIPT MODAL ======================= */
  async function fetchImageAsDataURL(url) {
    if (!url) return null;
    try {
      const res = await fetch(url, { cache: 'no-cache' });
      if (!res.ok) return null;
      const blob = await res.blob();
      return await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    } catch (err) { return null; }
  }

  async function generateInvoiceBlobUrl(order) {
    if (!order) throw new Error('Missing order');
    const { jsPDF } = window.jspdf || {};
    if (!jsPDF) throw new Error('jsPDF not found');
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });
    const left = 40; let y = 40; const lineHeight = 18; const pageWidth = doc.internal.pageSize.getWidth();

    // header
    doc.setFontSize(18); doc.setFont('helvetica', 'bold'); doc.text('Tiny Threads', left, y);
    doc.setFontSize(10); doc.setFont('helvetica', 'normal'); doc.text('One-of-a-kind kids dresses', left, y + 18);
    const metaX = pageWidth - 260;
    doc.setFontSize(16); doc.setFont('helvetica', 'bold'); doc.text('INVOICE', metaX, y);
    doc.setFontSize(10); doc.setFont('helvetica', 'normal'); doc.text(`Ref: ${order.reference || '—'}`, metaX, y + lineHeight);
    doc.text(`Date: ${new Date(order.paidAt || Date.now()).toLocaleString()}`, metaX, y + lineHeight*2);
    doc.setTextColor(40,160,100); doc.setFontSize(28); doc.setFont('helvetica', 'bold'); doc.text('PAID', pageWidth - 120, y + 60, { align: 'center' }); doc.setTextColor(0,0,0);
    y += 80;

    // buyer
    doc.setFontSize(11); doc.setFont('helvetica', 'bold'); doc.text('BILL TO', left, y);
    doc.setFont('helvetica', 'normal');
    const buyerName = (order.buyerDetails && order.buyerDetails.name) ? order.buyerDetails.name : '';
    doc.text(buyerName || '—', left, y + lineHeight);
    doc.text(order.buyerEmail || '—', left, y + lineHeight*2);
    if (order.buyerDetails && order.buyerDetails.phone) doc.text(order.buyerDetails.phone, left, y + lineHeight*3);
    y += lineHeight * 4;

    // items header
    doc.setFont('helvetica', 'bold'); doc.setFontSize(11); doc.text('Item', left, y);
    doc.text('Qty', pageWidth - 200, y); doc.text('Unit', pageWidth - 110, y); doc.text('Total', pageWidth - 40, y, { align: 'right' });
    y += lineHeight; doc.setDrawColor(220); doc.line(left, y - 8, pageWidth - left, y - 8); y += 8;

    for (const it of (order.items || [])) {
      const prod = products.find(p => p.id === it.id) || {};
      const title = prod.title || it.id; const qty = Number(it.qty || 1); const unit = prod.price || (it.unit || 0); const line = +(qty * unit).toFixed(2);
      if (y > doc.internal.pageSize.getHeight() - 120) { doc.addPage(); y = 40; }
      doc.setFont('helvetica', 'bold'); doc.setFontSize(10); doc.text(String(title), left, y);
      doc.setFont('helvetica', 'normal'); doc.text(String(qty), pageWidth - 200, y);
      doc.text(formatPrice(unit), pageWidth - 110, y); doc.text(formatPrice(line), pageWidth - 40, y, { align: 'right' });
      y += lineHeight;
      doc.setFontSize(9);
      const meta = it.size ? `Size: ${it.size} • ID: ${it.id}` : `ID: ${it.id}`;
      doc.setFont('helvetica', 'normal'); doc.text(meta, left, y);
      y += (lineHeight + 6);
    }

    if (y > doc.internal.pageSize.getHeight() - 160) { doc.addPage(); y = 40; }
    const totalsY = y + 8; doc.setDrawColor(220); doc.line(left, totalsY, pageWidth - left, totalsY);
    doc.setFont('helvetica', 'bold'); doc.text('Total', pageWidth - 160, totalsY + 18); doc.text(formatPrice(order.total || 0), pageWidth - 40, totalsY + 18, { align: 'right' });
    const footerY = doc.internal.pageSize.getHeight() - 40; doc.setFontSize(9); doc.setFont('helvetica', 'normal');
    doc.text('Thank you for shopping with Tiny Threads — contact: hello@tinythreads.example', left, footerY);

    const blob = doc.output('blob');
    const url = URL.createObjectURL(blob);
    return { url, blob };
  }

  function showReceiptModal(order, pdfInfo) {
    try {
      const modal = document.getElementById('receipt-modal');
      const summary = document.getElementById('receipt-summary');
      const totalEl = document.getElementById('receipt-total');
      const btnView = document.getElementById('receipt-view');
      const btnDownload = document.getElementById('receipt-download');
      const btnPrint = document.getElementById('receipt-print');
      const previewWrap = document.getElementById('receipt-preview-wrap');
      const previewFrame = document.getElementById('receipt-preview');

      if (!modal || !summary || !totalEl) return;

      const itemsHtml = (order.items || []).map(it => {
        const prod = products.find(p => p.id === it.id) || {};
        return `<div style="display:flex;justify-content:space-between;margin-bottom:8px;">
          <div style="flex:1"><strong>${(prod.title||it.id)}</strong><div style="color:var(--muted);font-size:12px">${it.size?('Size: '+it.size):''} ${it.size? ' • ' : ''}ID: ${it.id}</div></div>
          <div style="text-align:right; min-width:96px;">
            <div style="font-weight:800">${formatPrice((prod.price||0))}</div>
            <div style="color:var(--muted); font-size:13px">${it.qty} ×</div>
          </div>
        </div>`;
      }).join('');

      summary.innerHTML = `
        <div style="margin-bottom:8px;"><strong>Buyer</strong><div style="color:var(--muted);font-size:13px">${(order.buyerDetails && order.buyerDetails.name) ? order.buyerDetails.name : '—'}</div>
        <div style="color:var(--muted);font-size:13px">${order.buyerEmail || '—'}</div>
        ${order.buyerDetails && order.buyerDetails.phone ? `<div style="color:var(--muted);font-size:13px">${order.buyerDetails.phone}</div>` : ''}</div>

        <div style="margin-top:6px;"><strong>Items</strong>
          <div style="margin-top:8px">${itemsHtml || '<div style="color:var(--muted)">No items</div>'}</div>
        </div>

        <div style="margin-top:12px; display:flex; justify-content:space-between; border-top:1px dashed rgba(15,23,42,0.06); padding-top:10px;">
          <div style="color:var(--muted)">Subtotal</div>
          <div style="font-weight:700">${formatPrice((order.total || 0) - (order.processingFee || 0))}</div>
        </div>

        <div style="display:flex; justify-content:space-between; margin-top:6px;">
          <div style="color:var(--muted)">Processing</div>
          <div style="font-weight:700">${formatPrice(order.processingFee || ((order.total||0)*0.0295))}</div>
        </div>
      `;

      totalEl.textContent = formatPrice(order.total || 0);

      if (pdfInfo && pdfInfo.url) {
        const url = pdfInfo.url;
        btnView.onclick = () => {
          try { previewWrap.style.display = ''; previewFrame.src = url; } catch (e) {}
          window.open(url, '_blank');
        };
        btnDownload.onclick = () => { const a = document.createElement('a'); a.href = url; a.download = `Invoice-${order.reference || 'receipt'}.pdf`; document.body.appendChild(a); a.click(); a.remove(); };
        btnPrint.onclick = () => { const w = window.open(url, '_blank'); w?.addEventListener && w.addEventListener('load', () => w.print()); };
      } else {
        btnView.disabled = btnDownload.disabled = btnPrint.disabled = true;
      }

      document.getElementById('receipt-close').onclick = () => {
        try { if (pdfInfo && pdfInfo.url) URL.revokeObjectURL(pdfInfo.url); } catch(e){}
        try { previewWrap.style.display = 'none'; } catch(e){}
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
        modal.classList.remove('open');
      };

      modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false'); modal.classList.add('open');
      document.getElementById('receipt-close').focus();
    } catch (err) { console.error('showReceiptModal error', err); }
  }

  /* ======================= handleSuccessfulPayment (single) ======================= */
  async function handleSuccessfulPayment(reference, buyerEmail, items, total, buyerDetails = {}) {
    try {
      if (!Array.isArray(items)) items = [];

      // snapshot items
      const snapshotItems = items.map(it => ({ id: it.id, qty: it.qty || 1, size: it.size || '' }));

      // mark locally unavailable & persist products locally
      for (const it of snapshotItems) {
        const p = products.find(pp => pp.id === it.id);
        if (p) p.available = false;
      }
      saveProductsLocal();

      // compute fee
      const processingFee = +( (total * 0.0295) ).toFixed(2);

      // build order and save locally
      const order = {
        reference: reference || ('REF-' + Math.random().toString(36).slice(2,9).toUpperCase()),
        buyerEmail: buyerEmail || (buyerDetails && buyerDetails.email) || '',
        buyerDetails: buyerDetails || {},
        items: snapshotItems,
        total: total || 0,
        processingFee,
        paidAt: nowISO(),
        status: 'paid'
      };
      pushOrder(order);

      // remove purchased items from cart & persist
      const purchasedIds = snapshotItems.map(i => i.id);
      cart = cart.filter(c => !purchasedIds.includes(c.id));
      saveCart(cart);

      // update UI
      updateCartUI();
      renderProductsBatch(true);
      closeCart();
      closeProductModal();

      toast('Payment successful — thank you! Generating receipt...');

      // generate PDF blob URL & show receipt modal
      try {
        const pdfInfo = await generateInvoiceBlobUrl(order);
        showReceiptModal(order, pdfInfo);
      } catch (err) {
        console.error('Invoice generation failed', err);
        // fallback: try direct PDF generation that opens/downloads
        try { await generateInvoicePDFFallback(order); } catch(e){ console.error('fallback pdf failed', e); }
        showReceiptModal(order, null);
      }

      return order;
    } catch (err) {
      console.error('handleSuccessfulPayment error', err);
      toast('Payment recorded, but an error occurred — check console.');
      return null;
    }
  }

  // expose globally for Paystack callbacks if needed
  window.handleSuccessfulPayment = handleSuccessfulPayment;

  // Simple fallback generator that directly opens/downloads (keeps old behaviour for backwards compatibility)
  async function generateInvoicePDFFallback(order) {
    // Reuse generateInvoiceBlobUrl to create blob; if that fails, fallback to a minimal jsPDF save
    try {
      const info = await generateInvoiceBlobUrl(order);
      // open & download
      const a = document.createElement('a'); a.href = info.url; a.download = `Invoice-${order.reference || 'receipt'}.pdf`; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(info.url), 60000);
      return;
    } catch (err) {
      try {
        const { jsPDF } = window.jspdf || {};
        if (jsPDF) { const doc = new jsPDF(); doc.text('Invoice — see app for details', 20, 20); doc.save(`Invoice-${order.reference || 'receipt'}.pdf`); }
      } catch (e) {}
    }
  }

  /* ======================= UI Wiring: modal buttons that depend on product modal ======================= */
  // Replace modal add & buy behaviours to be resilient (no size required if you removed UI)
  (function wireModalButtons() {
    const modalAdd = document.getElementById('modal-add');
    const modalBuy = document.getElementById('modal-buy');
    if (modalAdd) {
      modalAdd.addEventListener('click', (e) => {
        e.preventDefault();
        if (!window.modalCurrentProduct) return;
        const qty = Number(modalQty?.value || 1);
        const editId = document.getElementById('product-modal')?.getAttribute('data-edit-cart-id');
        if (editId) { updateCartItem(editId, qty, ''); clearModalEditState(); closeProductModal(); return; }
        const alreadyInCart = cart.some(c => c.id === window.modalCurrentProduct.id);
        if (alreadyInCart) { removeFromCart(window.modalCurrentProduct.id); clearModalEditState(); closeProductModal(); toast('Removed from cart'); return; }
        addToCart(window.modalCurrentProduct.id, qty, '');
        clearModalEditState(); closeProductModal();
      });
    }
    if (modalBuy) {
      modalBuy.addEventListener('click', (e) => {
        e.preventDefault();
        if (!window.modalCurrentProduct) return;
        const qty = Number(modalQty?.value || 1);
        const single = { id: window.modalCurrentProduct.id, qty, size: '' };
        openBuyNowModal(single);
      });
    }
  })();

  /* ======================= CART EDIT HELPERS ======================= */
  function updateCartItem(productId, qty = 1, size = '') {
    const idx = cart.findIndex(c => c.id === productId);
    if (idx === -1) return toast('Item not in cart');
    cart[idx].qty = Math.max(1, Number(qty));
    if (size) cart[idx].size = size;
    saveCart(cart);
    updateCartUI();
    toast('Cart updated');
  }

  /* ======================= HERO SLIDER (unchanged) ======================= */
  (function heroInit(){
    const slider = document.querySelector('.hero-slider'); if (!slider) return;
    const slides = $$('.hero-slider .slide'); const dotsWrap = $('.hero-dots');
    let idx = 0; const total = slides.length; let timer = null;
    function show(i) {
      slides.forEach(s => { s.classList.remove('active'); s.style.display = 'none'; });
      slides[i].style.display = ''; slides[i].classList.add('active');
      dotsWrap.innerHTML = '';
      for (let d = 0; d < total; d++) {
        const b = document.createElement('button'); b.className = 'dot' + (d === i ? ' active' : '');
        b.setAttribute('aria-label', `Go to slide ${d+1}`); b.addEventListener('click', () => { idx = d; resetTimer(); show(idx); });
        dotsWrap.appendChild(b);
      }
    }
    function next() { idx = (idx + 1) % total; show(idx); }
    function prev() { idx = (idx - 1 + total) % total; show(idx); }
    $('.hero-next')?.addEventListener('click', (e)=>{ e.preventDefault(); resetTimer(); next(); });
    $('.hero-prev')?.addEventListener('click', (e)=>{ e.preventDefault(); resetTimer(); prev(); });
    function resetTimer() { if (timer) clearInterval(timer); timer = setInterval(next, 4000); }
    show(0); resetTimer();
  })();

  /* ======================= MOBILE NAV / HAMBURGER FIX ======================= */
  (function mobileNavInit(){
    const mobileToggle = document.getElementById('mobile-toggle');
    const mobileNav = document.getElementById('mobile-nav');
    if (!mobileToggle || !mobileNav) return;

    function ensureMobileToggleVisible() {
      if (window.innerWidth <= MOBILE_BREAKPOINT) {
        mobileToggle.style.display = 'inline-flex'; mobileToggle.setAttribute('aria-hidden', 'false');
      } else {
        mobileToggle.style.display = ''; mobileToggle.setAttribute('aria-hidden', 'true');
        mobileNav.classList.remove('open'); mobileNav.setAttribute('aria-hidden', 'true'); mobileToggle.setAttribute('aria-expanded', 'false');
      }
    }
    ensureMobileToggleVisible();
    window.addEventListener('resize', () => ensureMobileToggleVisible());

    function toggleMobileNav(e) {
      if (e && e.preventDefault) e.preventDefault();
      const isOpen = mobileNav.classList.contains('open');
      mobileNav.classList.toggle('open', !isOpen);
      mobileNav.setAttribute('aria-hidden', isOpen ? 'true' : 'false');
      mobileToggle.setAttribute('aria-expanded', (!isOpen).toString());
      if (!isOpen) { const firstLink = mobileNav.querySelector('a'); if (firstLink) firstLink.focus(); } else { mobileToggle.focus(); }
    }

    mobileToggle.addEventListener('click', (ev) => { ev.preventDefault(); toggleMobileNav(ev); });
    mobileToggle.addEventListener('touchstart', (ev) => { ev.preventDefault(); toggleMobileNav(ev); }, { passive: false });

    $$('#mobile-nav a').forEach(a => a.addEventListener('click', () => {
      mobileToggle.setAttribute('aria-expanded','false');
      mobileNav.setAttribute('aria-hidden','true');
      mobileNav.classList.remove('open');
    }));
  })();

  /* ======================= HEADER / SEARCH / RESPONSIVE TWEAKS ======================= */
  function syncHeaderSpace() {
    const header = document.querySelector('.site-header'); if (!header) return;
    const h = header.offsetHeight || 0; document.documentElement.style.setProperty('--header-space', h + 'px');
  }
  document.addEventListener('DOMContentLoaded', () => { syncHeaderSpace(); setTimeout(syncHeaderSpace, 120); });
  let __headerResizeTimer; window.addEventListener('resize', () => { clearTimeout(__headerResizeTimer); __headerResizeTimer = setTimeout(syncHeaderSpace, 120); });

  (function headerSearchInit(){
    const searchToggle = document.getElementById('search-toggle'); const searchInput = document.getElementById('search-input'); const searchWrap = document.querySelector('.search-wrap');
    if (!searchToggle || !searchInput) return;
    function openSearch() { document.body.classList.add('search-open'); if (searchWrap) searchWrap.style.zIndex = 230; if (window.innerWidth <= MOBILE_BREAKPOINT) { const shopEl = document.getElementById('shop'); if (shopEl) shopEl.scrollIntoView({ behavior: 'smooth', block: 'start' }); } setTimeout(() => searchInput.focus({ preventScroll: false }), 120); searchToggle.setAttribute('aria-expanded', 'true'); }
    function closeSearch() { document.body.classList.remove('search-open'); searchToggle.setAttribute('aria-expanded', 'false'); }
    searchToggle.addEventListener('click', () => { const isOpen = document.body.classList.contains('search-open'); if (isOpen) closeSearch(); else openSearch(); });
    searchToggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); const isOpen = document.body.classList.contains('search-open'); if (isOpen) closeSearch(); else openSearch(); } });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && document.body.classList.contains('search-open')) { closeSearch(); try { searchInput.blur(); } catch (err) {} } });
    document.addEventListener('click', (e) => { if (!document.body.classList.contains('search-open')) return; const target = e.target; if (searchWrap && !searchWrap.contains(target) && !searchToggle.contains(target)) closeSearch(); });
    searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); activeFilters.search = searchInput.value; renderProductsBatch(true); if (window.innerWidth <= MOBILE_BREAKPOINT) { const shopEl = document.getElementById('shop'); if (shopEl) shopEl.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } });
    const clearBtn = document.getElementById('search-clear'); clearBtn?.addEventListener('click', () => { if (window.innerWidth <= MOBILE_BREAKPOINT) setTimeout(() => document.body.classList.remove('search-open'), 120); });
  })();

  /* ======================= SMALL UX FIXES: checkout stacking & touch for hamburger ======================= */
  (function mobileUXFixes(){
    function ensureCheckoutStacking(modalId) {
      const modalEl = document.getElementById(modalId); if (!modalEl) return;
      const innerGrid = modalEl.querySelector('.modal-inner > div'); const aside = modalEl.querySelector('.modal-inner aside');
      if (window.innerWidth <= MOBILE_BREAKPOINT) {
        if (innerGrid) innerGrid.style.gridTemplateColumns = '1fr';
        if (aside) aside.style.width = '100%';
        modalEl.style.alignItems = 'flex-start';
      } else {
        if (innerGrid) innerGrid.style.removeProperty('grid-template-columns');
        if (aside) aside.style.removeProperty('width');
        modalEl.style.removeProperty('align-items');
      }
    }
    const observer = new MutationObserver((records) => {
      records.forEach(rec => {
        if (rec.type === 'attributes' && rec.target && rec.attributeName === 'class') {
          const el = rec.target;
          if (el.id === 'checkout-modal' || el.id === 'buynow-modal') ensureCheckoutStacking(el.id);
        }
      });
    });
    ['checkout-modal','buynow-modal'].forEach(id => { const el = document.getElementById(id); if (el) observer.observe(el, { attributes: true, attributeFilter: ['class'] }); });
    window.addEventListener('resize', () => { setTimeout(() => { ensureCheckoutStacking('checkout-modal'); ensureCheckoutStacking('buynow-modal'); }, 160); });
  })();

  /* ======================= TASK: remove size UI if present (keeps logic simple) ======================= */
  (function removeSizeUIIfWanted(){
    const modalSize = document.getElementById('modal-size'); const modalSizeLabel = document.querySelector('label[for="modal-size"]');
    if (modalSizeLabel) modalSizeLabel.style.display = 'none';
    if (modalSize) { modalSize.style.display = 'none'; modalSize.innerHTML = '<option value="">—</option>'; }
  })();

  /* ======================= INIT ======================= */
  function init() {
    document.getElementById('year') && (document.getElementById('year').textContent = new Date().getFullYear());
    renderProductsBatch(true);
    updateCartUI();
    document.querySelectorAll('a[href="admin.html"]').forEach(a => a.setAttribute('target','_blank'));
    const contactForm = $('#contact-form');
    contactForm?.addEventListener('submit', (e) => { e.preventDefault(); toast('Thanks! Message sent (client demo). Owner will need server/email to actually receive messages.'); contactForm.reset(); });
    $('#newsletter')?.addEventListener('submit', (e) => { e.preventDefault(); const em = $('#newsletter input[type="email"]')?.value; if (!em || !em.includes('@')) { toast('Provide a valid email'); return; } toast('Subscribed (demo). Add a backend to store emails.'); $('#newsletter').reset(); });
  }

  document.addEventListener('DOMContentLoaded', () => { init(); });

  /* ======================= Backwards-compatible PDF generator (used previously) ======================= */
  async function generateInvoicePDF(order) {
    // alias to fallback that opens+downloads (keeps existing usage)
    return generateInvoicePDFFallback(order);
  }

  /* Expose minimal debugging utilities */
  window._tinyThreads = {
    getState: () => ({ products, cart }),
    setPaystackKey: (k) => { if (k) { console.log('[app] overriding paystack key (dev)'); /* eslint-disable-next-line no-unused-expressions */ (PAYSTACK_PUBLIC_KEY = k); } }
  };

  console.log('[tinythreads] consolidated script initialized (Paystack key present? ', !!PAYSTACK_PUBLIC_KEY, ')');
})();
</script>


</body>
</html>
